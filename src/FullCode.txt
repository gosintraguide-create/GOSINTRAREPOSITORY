FILE: %i  
 


--- START OF FILE ImageWithFallback.tsx ---

import { useState, useEffect } from "react";

interface ImageWithFallbackProps
  extends React.ImgHTMLAttributes<HTMLImageElement> {
  src: string;
  alt: string;
  unsplashQuery?: string;
}

export function ImageWithFallback({
  src,
  alt,
  unsplashQuery,
  ...props
}: ImageWithFallbackProps) {
  const [imgSrc, setImgSrc] = useState(src);
  const [isLoading, setIsLoading] = useState(true);
  const [hasError, setHasError] = useState(false);

  useEffect(() => {
    if (!src && unsplashQuery) {
      // Fetch from Unsplash API
      fetch(
        `https://source.unsplash.com/1600x900/?${encodeURIComponent(unsplashQuery)}`,
      )
        .then((response) => {
          setImgSrc(response.url);
          setIsLoading(false);
        })
        .catch(() => {
          setHasError(true);
          setIsLoading(false);
        });
    } else {
      setImgSrc(src);
      setIsLoading(false);
    }
  }, [src, unsplashQuery]);

  if (isLoading) {
    return (
      <div
        className={props.className}
        style={{ backgroundColor: "#f0f0f0" }}
      />
    );
  }

  if (hasError) {
    return (
      <div
        className={props.className}
        style={{ backgroundColor: "#e0e0e0" }}
      />
    );
  }

  return (
    <img
      {...props}
      src={imgSrc}
      alt={alt}
      onError={() => setHasError(true)}
    />
  );
}


--- START OF FILE accordion.tsx ---

"use client";

import * as React from "react";
import * as AccordionPrimitive from "@radix-ui/react-accordion@1.2.3";
import { ChevronDownIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />;
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  );
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  );
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  );
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };


--- START OF FILE alert-dialog.tsx ---

"use client";

import * as React from "react";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog@1.1.6";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  );
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  );
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  );
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  );
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};


--- START OF FILE alert.tsx ---

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  );
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className,
      )}
      {...props}
    />
  );
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className,
      )}
      {...props}
    />
  );
}

export { Alert, AlertTitle, AlertDescription };


--- START OF FILE aspect-ratio.tsx ---

"use client";

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio@1.1.2";

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />;
}

export { AspectRatio };


--- START OF FILE avatar.tsx ---

"use client";

import * as React from "react";
import * as AvatarPrimitive from "@radix-ui/react-avatar@1.1.3";

import { cn } from "./utils";

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-10 shrink-0 overflow-hidden rounded-full",
        className,
      )}
      {...props}
    />
  );
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  );
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className,
      )}
      {...props}
    />
  );
}

export { Avatar, AvatarImage, AvatarFallback };


--- START OF FILE badge.tsx ---

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span";

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  );
}

export { Badge, badgeVariants };


--- START OF FILE breadcrumb.tsx ---

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { ChevronRight, MoreHorizontal } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className,
      )}
      {...props}
    />
  );
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  );
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  );
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  );
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  );
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  );
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};


--- START OF FILE button.tsx ---

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-2xl transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-lg",
        destructive:
          "bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 hover:shadow-lg",
        outline:
          "border-2 border-input bg-background shadow-sm hover:bg-accent/10 hover:text-accent hover:border-accent/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
        ghost: "hover:bg-accent/10 hover:text-accent",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-11 px-5 py-2.5",
        sm: "h-9 rounded-xl px-3.5",
        lg: "h-12 rounded-2xl px-8",
        icon: "h-11 w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

const Button = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> &
    VariantProps<typeof buttonVariants> & {
      asChild?: boolean;
    }
>(({ className, variant, size, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      ref={ref}
      {...props}
    />
  );
});

Button.displayName = "Button";

export { Button, buttonVariants };


--- START OF FILE calendar.tsx ---

"use client";

import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react@0.487.0";
import { DayPicker } from "react-day-picker@8.10.1";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: React.ComponentProps<typeof DayPicker>) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row gap-2",
        month: "flex flex-col gap-4",
        caption: "flex justify-center pt-1 relative items-center w-full",
        caption_label: "text-sm font-medium",
        nav: "flex items-center gap-1",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "size-7 bg-transparent p-0 opacity-50 hover:opacity-100",
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-x-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: cn(
          "relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",
          props.mode === "range"
            ? "[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md"
            : "[&:has([aria-selected])]:rounded-md",
        ),
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "size-8 p-0 font-normal aria-selected:opacity-100",
        ),
        day_range_start:
          "day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_range_end:
          "day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("size-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("size-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  );
}

export { Calendar };


--- START OF FILE card.tsx ---

import * as React from "react";

import { cn } from "./utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",
        className,
      )}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className,
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <h4
      data-slot="card-title"
      className={cn("leading-none", className)}
      {...props}
    />
  );
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <p
      data-slot="card-description"
      className={cn("text-muted-foreground", className)}
      {...props}
    />
  );
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className,
      )}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6 [&:last-child]:pb-6", className)}
      {...props}
    />
  );
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 pb-6 [.border-t]:pt-6", className)}
      {...props}
    />
  );
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
};


--- START OF FILE carousel.tsx ---

"use client";

import * as React from "react";
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react@8.6.0";
import { ArrowLeft, ArrowRight } from "lucide-react@0.487.0";

import { cn } from "./utils";
import { Button } from "./button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className,
      )}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
};


--- START OF FILE chart.tsx ---

"use client";

import * as React from "react";
import * as RechartsPrimitive from "recharts@2.15.2";

import { cn } from "./utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  );
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig;
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"];
}) {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color,
  );

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean;
    hideIndicator?: boolean;
    indicator?: "line" | "dot" | "dashed";
    nameKey?: string;
    labelKey?: string;
  }) {
  const { config } = useChart();

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null;
    }

    const [item] = payload;
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
    const itemConfig = getPayloadConfigFromPayload(config, item, key);
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label;

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      );
    }

    if (!value) {
      return null;
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>;
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ]);

  if (!active || !payload?.length) {
    return null;
  }

  const nestLabel = payload.length === 1 && indicator !== "dot";

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || "value"}`;
          const itemConfig = getPayloadConfigFromPayload(config, item, key);
          const indicatorColor = color || item.payload.fill || item.color;

          return (
            <div
              key={item.dataKey}
              className={cn(
                "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                indicator === "dot" && "items-center",
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                          {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent":
                              indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          },
                        )}
                        style={
                          {
                            "--color-bg": indicatorColor,
                            "--color-border": indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      "flex flex-1 justify-between leading-none",
                      nestLabel ? "items-end" : "items-center",
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

const ChartLegend = RechartsPrimitive.Legend;

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean;
    nameKey?: string;
  }) {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className,
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`;
        const itemConfig = getPayloadConfigFromPayload(config, item, key);

        return (
          <div
            key={item.value}
            className={cn(
              "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3",
            )}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        );
      })}
    </div>
  );
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string,
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string;
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config];
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
};


--- START OF FILE checkbox.tsx ---

"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox@1.1.4";
import { CheckIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
}

export { Checkbox };


--- START OF FILE collapsible.tsx ---

"use client";

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible@1.1.3";

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  );
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  );
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent };


--- START OF FILE command.tsx ---

"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk@1.1.1";
import { SearchIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "./dialog";

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent className="overflow-hidden p-0">
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className,
      )}
      {...props}
    />
  );
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  );
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};


--- START OF FILE context-menu.tsx ---

"use client";

import * as React from "react";
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu@2.2.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />;
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  );
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  );
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  );
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />;
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  );
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  );
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  );
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  );
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  );
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};


--- START OF FILE dialog.tsx ---

"use client";

import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog@1.1.6";
import { XIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => {
  return (
    <DialogPrimitive.Overlay
      ref={ref}
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
});
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName;

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        ref={ref}
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <XIcon />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
});
DialogContent.displayName = DialogPrimitive.Content.displayName;

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};


--- START OF FILE drawer.tsx ---

"use client";

import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul@1.1.2";

import { cn } from "./utils";

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />;
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};


--- START OF FILE dropdown-menu.tsx ---

"use client";

import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu@2.1.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  );
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  );
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  );
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  );
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  );
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  );
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  );
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  );
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
};


--- START OF FILE form.tsx ---

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label@2.1.2";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form@7.55.0";

import { cn } from "./utils";
import { Label } from "./label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  );
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  );
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};


--- START OF FILE hover-card.tsx ---

"use client";

import * as React from "react";
import * as HoverCardPrimitive from "@radix-ui/react-hover-card@1.1.6";

import { cn } from "./utils";

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />;
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  );
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  );
}

export { HoverCard, HoverCardTrigger, HoverCardContent };


--- START OF FILE input-otp.tsx ---

"use client";

import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp@1.4.2";
import { MinusIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string;
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName,
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  );
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center gap-1", className)}
      {...props}
    />
  );
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number;
}) {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {};

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm bg-input-background transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  );
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  );
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };


--- START OF FILE input.tsx ---

import * as React from "react";

import { cn } from "./utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };


--- START OF FILE label.tsx ---

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label@2.1.2";

import { cn } from "./utils";

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

export { Label };


--- START OF FILE menubar.tsx ---

"use client";

import * as React from "react";
import * as MenubarPrimitive from "@radix-ui/react-menubar@1.1.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className,
      )}
      {...props}
    />
  );
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />;
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />;
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />;
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  );
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className,
      )}
      {...props}
    />
  );
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  );
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  );
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  );
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  );
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
};


--- START OF FILE navigation-menu.tsx ---

import * as React from "react";
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu@1.2.5";
import { cva } from "class-variance-authority@0.7.1";
import { ChevronDownIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean;
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className,
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  );
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  );
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1",
);

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  );
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center",
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  );
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
};


--- START OF FILE pagination.tsx ---

import * as React from "react";
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react@0.487.0";

import { cn } from "./utils";
import { Button, buttonVariants } from "./button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  );
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};


--- START OF FILE popover.tsx ---

"use client";

import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover@1.1.6";

import { cn } from "./utils";

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };


--- START OF FILE progress.tsx ---

"use client";

import * as React from "react";
import * as ProgressPrimitive from "@radix-ui/react-progress@1.1.2";

import { cn } from "./utils";

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className,
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  );
}

export { Progress };


--- START OF FILE radio-group.tsx ---

"use client";

import * as React from "react";
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group@1.2.3";
import { CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  );
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem };


--- START OF FILE resizable.tsx ---

"use client";

import * as React from "react";
import { GripVerticalIcon } from "lucide-react@0.487.0";
import * as ResizablePrimitive from "react-resizable-panels@2.1.7";

import { cn } from "./utils";

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className,
      )}
      {...props}
    />
  );
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />;
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  );
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };


--- START OF FILE scroll-area.tsx ---

"use client";

import * as React from "react";
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area@1.2.3";

import { cn } from "./utils";

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  );
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  );
}

export { ScrollArea, ScrollBar };


--- START OF FILE select.tsx ---

"use client";

import * as React from "react";
import * as SelectPrimitive from "@radix-ui/react-select@2.1.6";
import {
  CheckIcon,
  ChevronDownIcon,
  ChevronUpIcon,
} from "lucide-react@0.487.0";

import { cn } from "./utils";

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};


--- START OF FILE separator.tsx ---

"use client";

import * as React from "react";
import * as SeparatorPrimitive from "@radix-ui/react-separator@1.1.2";

import { cn } from "./utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator-root"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };


--- START OF FILE sheet.tsx ---

"use client";

import * as React from "react";
import * as SheetPrimitive from "@radix-ui/react-dialog@1.1.6";
import { XIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => {
  return (
    <SheetPrimitive.Overlay
      ref={ref}
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
});
SheetOverlay.displayName = "SheetOverlay";

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};


--- START OF FILE sidebar.tsx ---

"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { VariantProps, cva } from "class-variance-authority@0.7.1";
import { PanelLeftIcon } from "lucide-react@0.487.0";

import { useIsMobile } from "./use-mobile";
import { cn } from "./utils";
import { Button } from "./button";
import { Input } from "./input";
import { Separator } from "./separator";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "./sheet";
import { Skeleton } from "./skeleton";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "./tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className,
        )}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};


--- START OF FILE skeleton.tsx ---

import { cn } from "./utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  );
}

export { Skeleton };


--- START OF FILE slider.tsx ---

"use client";

import * as React from "react";
import * as SliderPrimitive from "@radix-ui/react-slider@1.2.3";

import { cn } from "./utils";

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max],
  );

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5",
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full",
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  );
}

export { Slider };


--- START OF FILE sonner.tsx ---

"use client";

import { useTheme } from "next-themes@0.4.6";
import { Toaster as Sonner, ToasterProps } from "sonner@2.0.3";

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
        } as React.CSSProperties
      }
      {...props}
    />
  );
};

export { Toaster };


--- START OF FILE switch.tsx ---

"use client";

import * as React from "react";
import * as SwitchPrimitive from "@radix-ui/react-switch@1.1.3";

import { cn } from "./utils";

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0",
        )}
      />
    </SwitchPrimitive.Root>
  );
}

export { Switch };


--- START OF FILE table.tsx ---

"use client";

import * as React from "react";

import { cn } from "./utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  );
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  );
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className,
      )}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className,
      )}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  );
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};


--- START OF FILE tabs.tsx ---

"use client";

import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs@1.1.3";

import { cn } from "./utils";

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  );
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  );
}

export { Tabs, TabsList, TabsTrigger, TabsContent };


--- START OF FILE textarea.tsx ---

import * as React from "react";

import { cn } from "./utils";

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      ref={ref}
      data-slot="textarea"
      className={cn(
        "resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className,
      )}
      {...props}
    />
  );
});

Textarea.displayName = "Textarea";

export { Textarea };


--- START OF FILE toggle-group.tsx ---

"use client";

import * as React from "react";
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group@1.1.2";
import { type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";
import { toggleVariants } from "./toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
});

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };


--- START OF FILE toggle.tsx ---

"use client";

import * as React from "react";
import * as TogglePrimitive from "@radix-ui/react-toggle@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Toggle, toggleVariants };


--- START OF FILE tooltip.tsx ---

"use client";

import * as React from "react";
import * as TooltipPrimitive from "@radix-ui/react-tooltip@1.1.8";

import { cn } from "./utils";

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  );
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };


--- START OF FILE use-mobile.ts ---

import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(
    undefined,
  );

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}


--- START OF FILE utils.ts ---

import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}


--- START OF FILE AboutPage.tsx ---

import { Users, Mail, MapPin, Clock, Heart, Shield, Target, MessageSquare, ArrowRight, Car, Award, Camera } from "lucide-react";
import { Button } from "./ui/button";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { Textarea } from "./ui/textarea";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import { useState, useEffect } from "react";
import { loadContentWithLanguage, type WebsiteContent, DEFAULT_CONTENT } from "../lib/contentManager";
import { getUITranslation } from "../lib/translations";
import { motion } from "motion/react";

interface AboutPageProps {
  language?: string;
}

export function AboutPage({ language = "en" }: AboutPageProps) {
  const [content, setContent] = useState<WebsiteContent>(DEFAULT_CONTENT);
  const t = getUITranslation(language);

  useEffect(() => {
    setContent(loadContentWithLanguage(language));
  }, [language]);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    alert("Thank you for your message! We'll get back to you soon.");
  };

  const perks = [
    { icon: Users, title: "Small Groups", description: "Just 2-6 guests per vehicle for a cozy, personal experience" },
    { icon: Car, title: "Professional Guides", description: "Every driver is a certified local expert who loves Sintra" },
    { icon: Award, title: "Guaranteed Seats", description: "Pre-booked comfort with no waiting or standing" },
    { icon: Camera, title: "Your Pace", description: "Hop on & off as much as you want all day long" },
  ];

  return (
    <div className="flex-1">
      {/* Hero Section */}
      <section className="bg-primary py-16 sm:py-24">
        <div className="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
          <motion.div
            className="mb-6 flex justify-center"
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ duration: 0.5, type: "spring" }}
          >
            <div className="flex h-20 w-20 items-center justify-center rounded-2xl bg-white shadow-xl sm:h-24 sm:w-24">
              <Heart className="h-10 w-10 text-accent sm:h-12 sm:w-12" />
            </div>
          </motion.div>

          <motion.h1
            className="mb-4 text-white"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            {content.about.title}
          </motion.h1>

          <motion.p
            className="mx-auto max-w-2xl text-xl text-white/90"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
          >
            {content.about.subtitle}
          </motion.p>
        </div>
      </section>

      {/* Story Section */}
      <section className="py-16 sm:py-24">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="grid gap-12 lg:grid-cols-2 lg:items-center lg:gap-16">
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
            >
              <Badge className="mb-4">Our Journey</Badge>
              <h2 className="mb-6 text-foreground">How Hop On Sintra Was Born</h2>
              <div className="space-y-4 text-muted-foreground">
                {content.about.story.map((paragraph, index) => (
                  <p key={index}>{paragraph}</p>
                ))}
              </div>
            </motion.div>

            <motion.div
              className="overflow-hidden rounded-2xl shadow-2xl"
              initial={{ opacity: 0, x: 20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              whileHover={{ scale: 1.02 }}
            >
              <ImageWithFallback
                src="https://images.unsplash.com/photo-1668945306762-a31d14d8a940?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzaW50cmElMjBwb3J0dWdhbCUyMHBhbGFjZXxlbnwxfHx8fDE3NjAxNDAyMDB8MA&ixlib=rb-4.1.0&q=80&w=1080"
                alt="Sintra Palace"
                className="h-full w-full object-cover"
              />
            </motion.div>
          </div>
        </div>
      </section>

      {/* Mission Section */}
      <section className="border-y border-border bg-secondary/30 py-16 sm:py-24">
        <div className="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
          <Badge className="mb-4">Our Mission</Badge>
          <h2 className="mb-6 text-foreground">What Drives Us</h2>
          <p className="text-xl text-muted-foreground">
            {content.about.mission}
          </p>
        </div>
      </section>

      {/* Why Choose Us */}
      <section className="py-16 sm:py-24">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="mb-12 text-center">
            <Badge className="mb-4">What Makes Us Special</Badge>
            <h2 className="mb-4 text-foreground">The Hop On Sintra Difference</h2>
            <p className="mx-auto max-w-2xl text-muted-foreground">
              We've reimagined how you explore Sintrano crowded buses, no rigid schedules!
            </p>
          </div>

          <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
            {perks.map((perk, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ delay: index * 0.1 }}
              >
                <Card className="h-full p-6 transition-all hover:shadow-lg">
                  <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                    <perk.icon className="h-6 w-6 text-primary" />
                  </div>
                  <h3 className="mb-2 text-foreground">{perk.title}</h3>
                  <p className="text-sm text-muted-foreground">{perk.description}</p>
                </Card>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Values Section */}
      <section className="border-y border-border bg-secondary/30 py-16 sm:py-24">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="mb-16 text-center">
            <Badge className="mb-4">Our Values</Badge>
            <h2 className="mb-4 text-foreground">What We Stand For</h2>
            <p className="text-muted-foreground">Every decision we make is guided by these principles</p>
          </div>

          <div className="grid gap-8 md:grid-cols-3">
            {content.about.values.map((value, index) => {
              const IconComponent = 
                index === 0 ? Shield :
                index === 1 ? Heart :
                Target;
              
              return (
                <motion.div
                  key={index}
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  viewport={{ once: true }}
                  transition={{ delay: index * 0.15 }}
                >
                  <Card className="h-full p-8 text-center transition-all hover:shadow-lg">
                    <div className="mb-6 flex justify-center">
                      <div className="flex h-16 w-16 items-center justify-center rounded-xl bg-primary/10">
                        <IconComponent className="h-8 w-8 text-primary" />
                      </div>
                    </div>
                    <h3 className="mb-3 text-foreground">{value.title}</h3>
                    <p className="text-muted-foreground">{value.description}</p>
                  </Card>
                </motion.div>
              );
            })}
          </div>
        </div>
      </section>

      {/* Contact Section */}
      <section className="py-20 sm:py-28" id="contact">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="mb-16 text-center">
            <Badge className="mb-4">Get In Touch</Badge>
            <h2 className="mb-4 text-foreground">Let's Chat!</h2>
            <p className="text-muted-foreground">Questions? Ideas? We'd love to hear from you!</p>
          </div>

          <div className="grid gap-8 lg:grid-cols-3">
            {/* Contact Info Cards */}
            <div className="space-y-6">
              <Card className="p-6 transition-all hover:shadow-lg">
                <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                  <Mail className="h-6 w-6 text-primary" />
                </div>
                <h4 className="mb-2 text-foreground">Email Us</h4>
                <p className="text-muted-foreground">{content.company.email}</p>
                <p className="text-sm text-muted-foreground">Response within 24 hours</p>
              </Card>

              <Card className="p-6 transition-all hover:shadow-lg">
                <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                  <MapPin className="h-6 w-6 text-primary" />
                </div>
                <h4 className="mb-2 text-foreground">Find Us</h4>
                <p className="text-muted-foreground">{content.company.location}</p>
              </Card>

              <Card className="p-6 transition-all hover:shadow-lg">
                <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                  <Clock className="h-6 w-6 text-primary" />
                </div>
                <h4 className="mb-2 text-foreground">Hours</h4>
                <p className="text-muted-foreground">{content.company.operatingHours}</p>
              </Card>
            </div>

            {/* Contact Form */}
            <div className="lg:col-span-2">
              <Card className="p-8 shadow-xl">
                <div className="mb-6">
                  <div className="mb-3 flex items-center gap-3">
                    <div className="flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                      <MessageSquare className="h-6 w-6 text-primary" />
                    </div>
                    <h3 className="text-foreground">Send a Message</h3>
                  </div>
                </div>

                <form onSubmit={handleSubmit} className="space-y-6">
                  <div className="grid gap-6 sm:grid-cols-2">
                    <div>
                      <Label htmlFor="name">Name</Label>
                      <Input
                        id="name"
                        type="text"
                        placeholder="Your name"
                        className="mt-2"
                        required
                      />
                    </div>
                    <div>
                      <Label htmlFor="email">Email</Label>
                      <Input
                        id="email"
                        type="email"
                        placeholder="your.email@example.com"
                        className="mt-2"
                        required
                      />
                    </div>
                  </div>

                  <div>
                    <Label htmlFor="subject">Subject</Label>
                    <Input
                      id="subject"
                      type="text"
                      placeholder="How can we help?"
                      className="mt-2"
                      required
                    />
                  </div>

                  <div>
                    <Label htmlFor="message">Message</Label>
                    <Textarea
                      id="message"
                      placeholder="Tell us what's on your mind..."
                      className="mt-2 min-h-[150px]"
                      required
                    />
                  </div>

                  <Button
                    type="submit"
                    className="w-full sm:w-auto"
                    size="lg"
                  >
                    Send Message
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </form>
              </Card>
            </div>
          </div>
        </div>
      </section>

      {/* FAQ Section */}
      <section className="border-t border-border bg-secondary/30 py-20 sm:py-28">
        <div className="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
          <div className="mb-12 text-center">
            <Badge className="mb-4">FAQ</Badge>
            <h2 className="mb-4 text-foreground">Common Questions</h2>
            <p className="text-muted-foreground">Everything you need to know about Hop On Sintra</p>
          </div>

          <div className="space-y-4">
            {[
              {
                q: "What's included in the day pass?",
                a: "Unlimited rides on all participating vehicles (tuk-tuks, UMM jeeps) with professional driver-guides for one full day. Guaranteed seating in every vehicle. You can optionally add attraction entrance tickets and guided tours at 10 AM and 2 PM."
              },
              {
                q: "Can I buy attraction tickets with my pass?",
                a: "Yes! During booking, you can add entrance tickets to popular attractions like Pena Palace, Quinta da Regaleira, and more. This saves you time  no waiting in ticket lines."
              },
              {
                q: "What are guided tours?",
                a: "Our 10 AM and 2 PM departures offer guided tours where your professional driver-guide stops at key attractions to share expert commentary about Sintra's history and hidden gems. Just 5 extra per person."
              },
              {
                q: "How do I use my QR code?",
                a: "Simply show your QR code (sent via email) to any Hop On Sintra driver before boarding. They'll scan it to verify your pass."
              },
              {
                q: "How often do vehicles depart?",
                a: "Vehicles with professional driver-guides depart every 30 minutes from all major attractions during operating hours (9:00 AM - 7:00 PM)."
              }
            ].map((faq, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 10 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ delay: index * 0.05 }}
              >
                <Card className="p-6 transition-all hover:shadow-lg">
                  <h4 className="mb-2 text-foreground">{faq.q}</h4>
                  <p className="text-muted-foreground">{faq.a}</p>
                </Card>
              </motion.div>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}


--- START OF FILE AdminAccess.tsx ---

import { Settings, Users } from "lucide-react";

interface AdminAccessProps {
  onNavigate: (page: string) => void;
}

export function AdminAccess({ onNavigate }: AdminAccessProps) {
  return (
    <div className="fixed bottom-4 left-4 z-40 flex flex-col gap-2 sm:bottom-6 sm:left-6">
      {/* Admin Button */}
      <button
        onClick={() => onNavigate("admin")}
        className="flex h-10 w-10 items-center justify-center rounded-lg border border-border bg-card text-muted-foreground shadow-lg transition-all hover:scale-110 hover:border-primary hover:text-primary hover:shadow-xl"
        aria-label="Admin access"
        title="Admin Console"
      >
        <Settings className="h-5 w-5" />
      </button>

      {/* Operations Button - Navigate to driver login */}
      <button
        onClick={() => onNavigate("driver-login")}
        className="flex h-10 w-10 items-center justify-center rounded-lg border border-border bg-card text-muted-foreground shadow-lg transition-all hover:scale-110 hover:border-accent hover:text-accent hover:shadow-xl"
        aria-label="Driver login"
        title="Driver Login (Operations Portal)"
      >
        <Users className="h-5 w-5" />
      </button>
    </div>
  );
}


--- START OF FILE AdminPage.tsx ---

import { useState, useEffect, useMemo } from "react";
import {
  Settings,
  Lock,
  LogIn,
  Calendar as CalendarIcon,
  DollarSign,
  Users,
  Save,
  Eye,
  EyeOff,
  Package,
  QrCode,
  AlertCircle,
  CheckCircle2,
  Clock,
  TrendingUp,
  BarChart3,
  PieChart,
  Calendar as CalendarIconMetrics,
  MessageCircle,
  Send,
  UserCog,
  Navigation,
  RefreshCw,
  Tag,
  MoreHorizontal,
  FileText,
  Image,
  ArrowLeft,
  X,
  Trash2,
  Archive,
  ArchiveRestore,
} from "lucide-react";
import { DestinationTracker } from "./DestinationTracker";
import { Button } from "./ui/button";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { Card } from "./ui/card";
import { Switch } from "./ui/switch";
import {
  Tabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from "./ui/tabs";
import { Calendar } from "./ui/calendar";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "./ui/popover";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from "./ui/sheet";
import {
  loadContent,
  saveContent,
  saveContentAsync,
  DEFAULT_CONTENT,
  type WebsiteContent,
} from "../lib/contentManager";
import {
  projectId,
  publicAnonKey,
} from "../utils/supabase/info";
import { createClient } from "../utils/supabase/client";
import { toast } from "sonner@2.0.3";
import { safeJsonFetch } from "../lib/apiErrorHandler";
import { ContentEditor } from "./ContentEditor";
import { BlogEditor } from "./BlogEditor";
import { SEOTools } from "./SEOTools";
import { DriverManagement } from "./DriverManagementMobile";
import { PickupRequestsManagement } from "./PickupRequestsManagement";
import { TagManagement } from "./TagManagement";
import { ImageManager } from "./ImageManager";
import { CompactBookingsList } from "./CompactBookingsList";
import { FeatureFlagManager } from "./FeatureFlagManager";
import { DatabaseCleanup } from "./DatabaseCleanup";
import { BookingDiagnostics } from "./BookingDiagnostics";
import { SunsetSpecialManager } from "./SunsetSpecialManager";
import {
  LineChart,
  Line,
  BarChart,
  Bar,
  PieChart as RechartsPie,
  Pie,
  Cell,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts";

interface AdminPageProps {
  onNavigate: (page: string) => void;
}

interface PricingSettings {
  basePrice: number;
  guidedTourSurcharge: number;
  attractions: {
    [key: string]: { name: string; price: number };
  };
}

interface AvailabilitySettings {
  [date: string]: {
    [timeSlot: string]: number;
  };
}

const DEFAULT_PRICING: PricingSettings = {
  basePrice: 25,
  guidedTourSurcharge: 5,
  attractions: {
    "pena-palace-park": {
      name: "Pena Palace Park Only",
      price: 8,
    },
    "pena-palace-full": {
      name: "Pena Palace & Park",
      price: 14,
    },
    "quinta-regaleira": {
      name: "Quinta da Regaleira",
      price: 12,
    },
    "moorish-castle": { name: "Moorish Castle", price: 10 },
    "monserrate-palace": {
      name: "Monserrate Palace",
      price: 10,
    },
    "sintra-palace": {
      name: "Sintra National Palace",
      price: 10,
    },
    "convento-capuchos": {
      name: "Convento dos Capuchos",
      price: 8,
    },
    "cabo-da-roca": {
      name: "Cabo da Roca",
      price: 0,
    },
    "villa-sassetti": {
      name: "Villa Sassetti",
      price: 0,
    },
  },
};

const TIME_SLOTS = [
  "9:00",
  "10:00",
  "11:00",
  "12:00",
  "13:00",
  "14:00",
  "15:00",
  "16:00",
];
const CHART_COLORS = [
  "#0A4D5C",
  "#D97843",
  "#636e72",
  "#2ecc71",
  "#f39c12",
  "#e74c3c",
];

export function AdminPage({ onNavigate }: AdminPageProps) {
  // Block search engines from indexing this page
  useEffect(() => {
    const metaRobots = document.querySelector(
      'meta[name="robots"]',
    );
    if (metaRobots) {
      metaRobots.setAttribute("content", "noindex, nofollow");
    } else {
      const meta = document.createElement("meta");
      meta.name = "robots";
      meta.content = "noindex, nofollow";
      document.head.appendChild(meta);
    }
    document.title = "Admin Portal - Access Restricted";
  }, []);

  const [isAuthenticated, setIsAuthenticated] = useState(() => {
    // Check for existing session in localStorage (persistent across browser sessions)
    const session = localStorage.getItem("admin-session");
    return session === "authenticated";
  });
  const [password, setPassword] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [pricing, setPricing] =
    useState<PricingSettings>(DEFAULT_PRICING);
  const [availability, setAvailability] =
    useState<AvailabilitySettings>({});
  const [selectedDate, setSelectedDate] = useState(
    new Date().toISOString().split("T")[0],
  );
  const [calendarOpen, setCalendarOpen] = useState(false);
  const [error, setError] = useState("");
  const [content, setContent] = useState<WebsiteContent>({});
  const [bookings, setBookings] = useState<any[]>([]);
  const [loadingBookings, setLoadingBookings] = useState(false);
  const [savingAvailability, setSavingAvailability] =
    useState(false);
  const [conversations, setConversations] = useState<any[]>([]);
  const [selectedConversation, setSelectedConversation] =
    useState<string | null>(null);
  const [conversationMessages, setConversationMessages] =
    useState<any[]>([]);
  const [replyMessage, setReplyMessage] = useState("");
  const [loadingConversations, setLoadingConversations] =
    useState(false);
  const [
    showArchivedConversations,
    setShowArchivedConversations,
  ] = useState(false);
  const [activeTab, setActiveTab] = useState("pickups");
  const [moreMenuOpen, setMoreMenuOpen] = useState(false);
  const [ticketPurchasesEnabled, setTicketPurchasesEnabled] =
    useState(true);

  // Notification state
  const [lastPickupCount, setLastPickupCount] = useState(0);
  const [lastBookingCount, setLastBookingCount] = useState(0);
  const [lastMessageCount, setLastMessageCount] = useState(0);
  const [newPickupsCount, setNewPickupsCount] = useState(0);
  const [newBookingsCount, setNewBookingsCount] = useState(0);
  const [pickupRequests, setPickupRequests] = useState<any[]>(
    [],
  );
  const [notificationSound, setNotificationSound] = useState<HTMLAudioElement | null>(null);
  const [totalUnreadCount, setTotalUnreadCount] = useState(0);
  const [showMobileGuide, setShowMobileGuide] = useState(() => {
    return localStorage.getItem('hide-mobile-guide') !== 'true';
  });
  const [isIOS, setIsIOS] = useState(false);
  const [isAndroid, setIsAndroid] = useState(false);

  // Detect mobile device type
  useEffect(() => {
    const userAgent = window.navigator.userAgent.toLowerCase();
    setIsIOS(/iphone|ipad|ipod/.test(userAgent));
    setIsAndroid(/android/.test(userAgent));
  }, []);

  // Mobile notification helper function
  const sendMobileNotification = (type: 'booking' | 'message' | 'pickup', details: {
    title: string;
    body: string;
    id?: string;
  }) => {
    console.log(` Sending mobile notification: ${type}`, details);

    // Update page title with unread count
    const newTotal = newPickupsCount + newBookingsCount + (conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length);
    setTotalUnreadCount(newTotal + 1);
    document.title = newTotal > 0 ? `(${newTotal + 1}) Hop On Sintra Admin` : 'Hop On Sintra Admin';

    // 1. Play notification sound (works on all mobile browsers)
    if (notificationSound) {
      notificationSound.play().catch(e => console.log('Could not play sound:', e));
    }

    // 2. Vibrate device (works on Android and some iOS)
    if ('vibrate' in navigator) {
      navigator.vibrate([200, 100, 200]); // Vibrate pattern: 200ms, pause 100ms, 200ms
    }

    // 3. Show persistent toast notification (longer duration for mobile)
    const emoji = type === 'booking' ? '' : type === 'message' ? '' : '';
    toast.success(`${emoji} ${details.title}`, {
      duration: 10000, // 10 seconds for mobile
      description: details.body,
    });

    // 4. Try desktop notification (works on Android Chrome, not iOS)
    if ('Notification' in window && Notification.permission === 'granted') {
      try {
        new Notification(details.title, {
          body: details.body,
          icon: '/favicon.ico',
          tag: `${type}-notification`,
          requireInteraction: true, // Keeps notification visible until dismissed
        });
      } catch (e) {
        console.log('Desktop notification not supported:', e);
      }
    }
  };

  // Load settings from database and localStorage
  useEffect(() => {
    // Load pricing from database
    async function loadPricingFromDB() {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pricing`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        if (response.ok) {
          const data = await response.json();
          if (data.pricing) {
            setPricing({
              ...DEFAULT_PRICING,
              ...data.pricing,
              attractions: {
                ...DEFAULT_PRICING.attractions,
                ...data.pricing.attractions,
              },
            });
            localStorage.setItem(
              "admin-pricing",
              JSON.stringify(data.pricing),
            );
            console.log(" Loaded pricing from database");
          }
        } else {
          console.error("Failed to load pricing from database");
          const cached = localStorage.getItem("admin-pricing");
          if (cached) {
            const cachedPricing = JSON.parse(cached);
            setPricing({
              ...DEFAULT_PRICING,
              ...cachedPricing,
              attractions: {
                ...DEFAULT_PRICING.attractions,
                ...cachedPricing.attractions,
              },
            });
            console.log("Loaded pricing from localStorage");
          }
        }
      } catch (error) {
        console.error("Error loading pricing:", error);
        const cached = localStorage.getItem("admin-pricing");
        if (cached) {
          try {
            const cachedPricing = JSON.parse(cached);
            setPricing({
              ...DEFAULT_PRICING,
              ...cachedPricing,
              attractions: {
                ...DEFAULT_PRICING.attractions,
                ...cachedPricing.attractions,
              },
            });
            console.log("Loaded pricing from localStorage");
          } catch (e) {
            console.error("Error parsing cached pricing:", e);
          }
        }
      }
    }
    loadPricingFromDB();

    // Load ticket purchases enabled setting
    async function loadTicketPurchasesSetting() {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/settings/ticket-purchases-enabled`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        if (response.ok) {
          const data = await response.json();
          setTicketPurchasesEnabled(data.enabled !== false); // Default to true if not set
          console.log(
            " Loaded ticket purchases setting:",
            data.enabled,
          );
        }
      } catch (error) {
        console.error(
          "Error loading ticket purchases setting:",
          error,
        );
        // Default to true on error for safety
        setTicketPurchasesEnabled(true);
      }
    }
    loadTicketPurchasesSetting();
  }, []);

  // Initialize notification sound for mobile
  useEffect(() => {
    // Create notification sound (simple tone using Web Audio API)
    const createNotificationSound = () => {
      try {
        const audio = new Audio();
        // Use a data URI for a simple notification beep
        const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800; // Frequency in Hz
        gainNode.gain.value = 0.3; // Volume
        
        const beepSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBziR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeyQFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFApGn+DyvmwhBjiR1/PMeywFJHfH8N2RQAoUXrTp66hVFA');
        
        setNotificationSound(beepSound);
        console.log(' Notification sound initialized for mobile');
      } catch (e) {
        console.log('Could not initialize notification sound:', e);
      }
    };

    createNotificationSound();
  }, []);

  // Keep screen awake on mobile (helps maintain real-time connection)
  useEffect(() => {
    if (!isAuthenticated) return;
    
    let wakeLock: any = null;
    
    const requestWakeLock = async () => {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await (navigator as any).wakeLock.request('screen');
          console.log(' Screen wake lock activated - notifications will work while screen is on');
          
          wakeLock.addEventListener('release', () => {
            console.log(' Screen wake lock released');
          });
        }
      } catch (err) {
        console.log('Wake lock not supported or failed:', err);
      }
    };
    
    requestWakeLock();
    
    // Re-request wake lock when page becomes visible again
    const handleVisibilityChange = () => {
      if (wakeLock !== null && document.visibilityState === 'visible') {
        requestWakeLock();
      }
    };
    
    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange);
      if (wakeLock !== null) {
        wakeLock.release().catch(() => {});
      }
    };
  }, [isAuthenticated]);

  // Fetch bookings from server
  useEffect(() => {
    if (!isAuthenticated) return;

    async function fetchBookings() {
      setLoadingBookings(true);
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
          {
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
            },
          },
        );
        if (response.ok) {
          const data = await response.json();
          setBookings(data.bookings || []);
        }
      } catch (error) {
        console.error("Error fetching bookings:", error);
      } finally {
        setLoadingBookings(false);
      }
    }

    fetchBookings();

    // Set up realtime subscription for instant booking updates
    const supabase = createClient();
    const channel = supabase
      .channel("bookings-changes")
      .on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "kv_store_3bd0ade8",
          // Match booking IDs: AA-1234, AB-1234, etc. AND old booking_* format
          filter: "key=like.%-%",
        },
        async (payload) => {
          // Filter out non-booking keys (pickup requests, chat, etc.)
          const key = payload.new?.key;
          if (
            !key ||
            key.startsWith("PICKUP_") ||
            key.startsWith("chat_") ||
            key.startsWith("availability_") ||
            key.startsWith("checkin_")
          ) {
            return; // Ignore non-booking changes
          }
          console.log(
            " Realtime booking change detected:",
            payload,
          );

          // Check if this is a new booking (INSERT event)
          if (payload.eventType === "INSERT" && payload.new) {
            const today = new Date()
              .toISOString()
              .split("T")[0];
            const newBooking = payload.new.value;

            // Check if booking was created today
            if (newBooking?.createdAt) {
              const createdDate = new Date(newBooking.createdAt)
                .toISOString()
                .split("T")[0];

              if (createdDate === today) {
                // Increment badge counter
                setNewBookingsCount((prev) => prev + 1);

                // Send mobile-friendly notification
                sendMobileNotification('booking', {
                  title: 'New Booking Received!',
                  body: `Booking ${newBooking.id} from ${newBooking.passengers?.[0]?.firstName || "customer"}`,
                  id: newBooking.id
                });
              }
            }
          }

          // Reload bookings when any booking changes
          await fetchBookings();
        },
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [isAuthenticated]);

  // Set up realtime subscription for instant message notifications
  useEffect(() => {
    if (!isAuthenticated) return;

    const supabase = createClient();
    const messagesChannel = supabase
      .channel("messages-changes")
      .on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "kv_store_3bd0ade8",
          filter: "key=like.chat_%",
        },
        async (payload) => {
          console.log(
            " Realtime message change detected:",
            payload,
          );

          // Check if this is a new message or conversation update
          if (
            payload.eventType === "INSERT" ||
            payload.eventType === "UPDATE"
          ) {
            const key = payload.new?.key;

            // If it's a conversation update, check for new unread messages
            if (key?.startsWith("chat_conversation_")) {
              const conversation = payload.new?.value;

              if (conversation?.unreadByAdmin > 0) {
                // Send mobile-friendly notification
                sendMobileNotification('message', {
                  title: 'New Message Received!',
                  body: `Message from ${conversation.customerName || "customer"}`,
                  id: conversation.id
                });
              }
            }
          }

          // Reload conversations when any message-related change happens
          await loadConversations();
        },
      )
      .subscribe();

    return () => {
      supabase.removeChannel(messagesChannel);
    };
  }, [isAuthenticated]);

  // Set up realtime subscription for instant pickup request notifications
  useEffect(() => {
    if (!isAuthenticated) return;

    const supabase = createClient();
    const pickupsChannel = supabase
      .channel("pickups-changes")
      .on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "kv_store_3bd0ade8",
          filter: "key=like.PICKUP_%",
        },
        async (payload) => {
          console.log(
            " Realtime pickup request change detected:",
            payload,
          );

          // Check if this is a new pickup request (INSERT event)
          if (payload.eventType === "INSERT" && payload.new) {
            const today = new Date()
              .toISOString()
              .split("T")[0];
            const newPickup = payload.new.value;

            // Check if pickup was created today
            if (newPickup?.createdAt) {
              const createdDate = new Date(newPickup.createdAt)
                .toISOString()
                .split("T")[0];

              if (
                createdDate === today &&
                newPickup.status === "pending"
              ) {
                // Increment badge counter
                setNewPickupsCount((prev) => prev + 1);

                // Send mobile-friendly notification
                sendMobileNotification('pickup', {
                  title: 'New Pickup Request!',
                  body: `${newPickup.groupSize} passengers at ${newPickup.pickupLocation}`,
                  id: newPickup.id
                });
              }
            }
          }

          // Reload pickup requests from the PickupRequestsManagement component
          // It will handle its own data refresh
        },
      )
      .subscribe();

    return () => {
      supabase.removeChannel(pickupsChannel);
    };
  }, [isAuthenticated]);

  const loadAvailability = async () => {
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/availability`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success && result.availability) {
      setAvailability(result.availability);
    }
  };

  const handleLogin = () => {
    if (password === "Sintra2025") {
      setIsAuthenticated(true);
      localStorage.setItem("admin-session", "authenticated");
      setError("");
    } else {
      setError("Incorrect password");
    }
  };

  const saveSettings = async () => {
    try {
      localStorage.setItem(
        "admin-pricing",
        JSON.stringify(pricing),
      );

      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pricing`,
        {
          method: "POST",
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify(pricing),
        },
      );

      if (!response.ok) {
        throw new Error("Failed to save pricing to database");
      }

      toast.success("Settings saved successfully to database!");
    } catch (error) {
      console.error("Error saving settings:", error);
      toast.error(
        "Failed to save settings to database. Saved locally only.",
      );
    }
  };

  const toggleTicketPurchases = async (enabled: boolean) => {
    setTicketPurchasesEnabled(enabled);

    try {
      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/settings/ticket-purchases-enabled`,
        {
          method: "POST",
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ enabled }),
        },
      );

      if (!response.ok) {
        throw new Error("Failed to save setting to database");
      }

      toast.success(
        enabled
          ? " Ticket purchases enabled - Customers can now book!"
          : " Ticket purchases disabled - All dates show as sold out",
      );
    } catch (error) {
      console.error(
        "Error saving ticket purchases setting:",
        error,
      );
      toast.error("Failed to save setting");
      // Revert on error
      setTicketPurchasesEnabled(!enabled);
    }
  };

  const saveAvailability = async () => {
    setSavingAvailability(true);
    try {
      localStorage.setItem(
        "admin-availability",
        JSON.stringify(availability),
      );

      const dates = Object.keys(availability);
      for (const date of dates) {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/availability/${date}`,
          {
            method: "POST",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(availability[date]),
          },
        );

        const result = await response.json();
        if (!result.success) {
          console.error(
            `Failed to save availability for ${date}:`,
            result.error,
          );
        }
      }

      toast.success("Availability saved successfully!");
    } catch (error) {
      console.error("Error saving availability:", error);
      toast.error("Failed to save availability");
    } finally {
      setSavingAvailability(false);
    }
  };

  const saveContentSettings = async () => {
    try {
      const result = await saveContentAsync(content);

      if (result.success) {
        toast.success(
          "Content saved successfully to database!",
        );
      } else {
        toast.error(
          `Failed to save to database: ${result.error}. Saved locally only.`,
        );
      }
    } catch (error) {
      console.error("Error saving content:", error);
      toast.error("Failed to save content. Please try again.");
    }
  };

  const resetContent = async () => {
    if (
      confirm(
        "Are you sure you want to reset all content to defaults? This cannot be undone.",
      )
    ) {
      setContent(DEFAULT_CONTENT);

      try {
        const result = await saveContentAsync(DEFAULT_CONTENT);

        if (result.success) {
          toast.success(
            "Content reset to defaults and saved to database!",
          );
        } else {
          toast.error(
            `Content reset locally but database save failed: ${result.error}`,
          );
        }
      } catch (error) {
        console.error("Error resetting content:", error);
        toast.error(
          "Content reset locally but database save failed.",
        );
      }
    }
  };

  const updateAttractionPrice = (id: string, price: number) => {
    setPricing((prev) => ({
      ...prev,
      attractions: {
        ...prev.attractions,
        [id]: { ...prev.attractions[id], price },
      },
    }));
  };

  const updateAvailability = (
    date: string,
    timeSlot: string,
    seats: number,
  ) => {
    setAvailability((prev) => ({
      ...prev,
      [date]: {
        ...(prev[date] || {}),
        [timeSlot]: seats,
      },
    }));
  };

  const getAvailability = (
    date: string,
    timeSlot: string,
  ): number => {
    return availability[date]?.[timeSlot] ?? 50;
  };

  const setAllSlotsForDate = (date: string, seats: number) => {
    const dateAvailability: { [key: string]: number } = {};
    TIME_SLOTS.forEach((slot) => {
      dateAvailability[slot] = seats;
    });
    setAvailability((prev) => ({
      ...prev,
      [date]: dateAvailability,
    }));
  };

  const loadBookings = async () => {
    setLoadingBookings(true);

    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success && result.bookings) {
      const validBookings = result.bookings.filter(
        (booking: any) =>
          booking && booking.id && booking.selectedDate,
      );

      const bookingsWithCheckIns = await Promise.all(
        validBookings.map(async (booking: any) => {
          const checkIns = await loadCheckInsForBooking(
            booking.id,
            booking.passengers?.length || 0,
          );
          return { ...booking, checkIns };
        }),
      );

      setBookings(bookingsWithCheckIns);
      console.log(
        ` Loaded ${bookingsWithCheckIns.length} bookings with check-in data`,
      );
    } else {
      setBookings([]);
      console.log(" No bookings found");
    }

    setLoadingBookings(false);
  };

  const loadCheckInsForBooking = async (
    bookingId: string,
    passengerCount: number,
  ) => {
    const checkIns: any[] = [];

    for (let i = 0; i < passengerCount; i++) {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/checkins/${bookingId}/${i}`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        const result = await response.json();
        if (result.success && result.checkIns) {
          checkIns[i] = result.checkIns;
        } else {
          checkIns[i] = [];
        }
      } catch (error) {
        checkIns[i] = [];
      }
    }

    return checkIns;
  };

  const loadPickupRequests = async () => {
    try {
      const result = await safeJsonFetch<any>(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pickup-requests`,
        {
          method: "GET",
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
            "Content-Type": "application/json",
          },
        },
      );

      if (result?.success && result.requests) {
        setPickupRequests(result.requests);
        return result.requests;
      } else {
        setPickupRequests([]);
        return [];
      }
    } catch (error) {
      console.error("Error loading pickup requests:", error);
      setPickupRequests([]);
      return [];
    }
  };

  const checkForNewItems = async (showNotifications = true) => {
    // Load fresh data
    const [pickups, bookingsResult, conversationsResult] =
      await Promise.all([
        loadPickupRequests(),
        safeJsonFetch<any>(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        ),
        safeJsonFetch<any>(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/conversations`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        ),
      ]);

    // Count pending pickups (status !== 'completed' and status !== 'cancelled')
    const pendingPickups = pickups.filter(
      (p: any) =>
        p.status !== "completed" && p.status !== "cancelled",
    );
    const currentPickupCount = pendingPickups.length;

    // Count today's bookings
    const today = new Date().toISOString().split("T")[0];
    // Count bookings CREATED today (not scheduled for today)
    const todaysBookings =
      bookingsResult?.bookings?.filter((b: any) => {
        if (!b.createdAt) return false;
        const createdDate = new Date(b.createdAt)
          .toISOString()
          .split("T")[0];
        return createdDate === today;
      }) || [];
    const currentBookingCount = todaysBookings.length;

    // Count unread messages
    const unreadMessages =
      conversationsResult?.conversations?.filter(
        (c: any) => c.unreadByAdmin > 0 && !c.archived,
      ) || [];
    const currentMessageCount = unreadMessages.length;

    if (showNotifications) {
      // Check for new pickups
      if (
        currentPickupCount > lastPickupCount &&
        lastPickupCount > 0
      ) {
        const newCount = currentPickupCount - lastPickupCount;
        toast.info(
          ` ${newCount} new pickup request${newCount > 1 ? "s" : ""}!`,
          {
            duration: 5000,
          },
        );
        setNewPickupsCount((prev) => prev + newCount);

        // Browser notification
        if (
          "Notification" in window &&
          Notification.permission === "granted"
        ) {
          new Notification("New Pickup Request", {
            body: `${newCount} new pickup request${newCount > 1 ? "s" : ""} received`,
            icon: "/favicon.ico",
            tag: "pickup-notification",
          });
        }
      }

      // Check for new bookings
      if (
        currentBookingCount > lastBookingCount &&
        lastBookingCount > 0
      ) {
        const newCount = currentBookingCount - lastBookingCount;
        toast.success(
          ` ${newCount} new booking${newCount > 1 ? "s" : ""} today!`,
          {
            duration: 5000,
          },
        );
        setNewBookingsCount((prev) => prev + newCount);

        // Browser notification
        if (
          "Notification" in window &&
          Notification.permission === "granted"
        ) {
          new Notification("New Booking", {
            body: `${newCount} new booking${newCount > 1 ? "s" : ""} received today`,
            icon: "/favicon.ico",
            tag: "booking-notification",
          });
        }
      }

      // Check for new messages
      if (
        currentMessageCount > lastMessageCount &&
        lastMessageCount > 0
      ) {
        const newCount = currentMessageCount - lastMessageCount;
        toast.info(
          ` ${newCount} new message${newCount > 1 ? "s" : ""}!`,
          {
            duration: 5000,
          },
        );

        // Browser notification
        if (
          "Notification" in window &&
          Notification.permission === "granted"
        ) {
          new Notification("New Message", {
            body: `${newCount} new message${newCount > 1 ? "s" : ""} from customers`,
            icon: "/favicon.ico",
            tag: "message-notification",
          });
        }
      }
    }

    // Update counts
    setLastPickupCount(currentPickupCount);
    setLastBookingCount(currentBookingCount);
    setLastMessageCount(currentMessageCount);

    // Update main data
    if (bookingsResult?.success && bookingsResult.bookings) {
      const validBookings = bookingsResult.bookings.filter(
        (booking: any) =>
          booking && booking.id && booking.selectedDate,
      );
      const bookingsWithCheckIns = await Promise.all(
        validBookings.map(async (booking: any) => {
          const checkIns = await loadCheckInsForBooking(
            booking.id,
            booking.passengers?.length || 0,
          );
          return { ...booking, checkIns };
        }),
      );
      setBookings(bookingsWithCheckIns);
    }

    if (
      conversationsResult?.success &&
      conversationsResult.conversations
    ) {
      setConversations(conversationsResult.conversations);
    }
  };

  useEffect(() => {
    if (isAuthenticated) {
      // Request notification permission
      if (
        "Notification" in window &&
        Notification.permission === "default"
      ) {
        Notification.requestPermission().then((permission) => {
          if (permission === "granted") {
            toast.success("Browser notifications enabled!");
          }
        });
      }

      // Initial load without notifications
      checkForNewItems(false);
    }
  }, [isAuthenticated]);

  // Auto-refresh every 30 seconds
  useEffect(() => {
    if (!isAuthenticated) return;

    const interval = setInterval(() => {
      checkForNewItems(true);
    }, 30000); // 30 seconds

    return () => clearInterval(interval);
  }, [
    isAuthenticated,
    lastPickupCount,
    lastBookingCount,
    lastMessageCount,
  ]);

  // Update page title when notification counts change
  useEffect(() => {
    if (!isAuthenticated) return;
    
    const unreadMessages = conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length;
    const totalCount = newPickupsCount + newBookingsCount + unreadMessages;
    
    if (totalCount > 0) {
      document.title = `(${totalCount}) Hop On Sintra Admin`;
    } else {
      document.title = 'Hop On Sintra Admin';
    }
  }, [isAuthenticated, newPickupsCount, newBookingsCount, conversations]);

  const loadConversations = async () => {
    setLoadingConversations(true);

    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/conversations`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success && result.conversations) {
      setConversations(result.conversations);
    }

    setLoadingConversations(false);
  };

  const loadConversationMessages = async (
    conversationId: string,
  ) => {
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/${conversationId}/messages`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success && result.messages) {
      setConversationMessages(result.messages);
    }
  };

  const handleSendReply = async () => {
    if (!selectedConversation || !replyMessage.trim()) return;

    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/message`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          conversationId: selectedConversation,
          sender: "admin",
          senderName: "Hop On Sintra Team",
          message: replyMessage,
        }),
      },
    );

    if (result?.success) {
      setReplyMessage("");
      loadConversationMessages(selectedConversation);
      loadConversations();
    }
  };

  const handleCloseConversation = async (
    conversationId: string,
  ) => {
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/${conversationId}/close`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success) {
      loadConversations();
      if (selectedConversation === conversationId) {
        setSelectedConversation(null);
      }
    }
  };

  const handleArchiveConversation = async (
    conversationId: string,
  ) => {
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/${conversationId}/archive`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success) {
      toast.success("Conversation archived");
      loadConversations();
      if (selectedConversation === conversationId) {
        setSelectedConversation(null);
      }
    }
  };

  const handleUnarchiveConversation = async (
    conversationId: string,
  ) => {
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/chat/${conversationId}/unarchive`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${publicAnonKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (result?.success) {
      toast.success("Conversation restored");
      loadConversations();
    }
  };

  useEffect(() => {
    async function loadPricingFromDB() {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pricing`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        if (response.ok) {
          const data = await response.json();
          if (data.pricing) {
            setPricing({
              ...DEFAULT_PRICING,
              ...data.pricing,
              attractions: {
                ...DEFAULT_PRICING.attractions,
                ...data.pricing.attractions,
              },
            });
            localStorage.setItem(
              "admin-pricing",
              JSON.stringify(data.pricing),
            );
            console.log(" Loaded pricing from database");
            return;
          }
        }
      } catch (error) {
        // Silently handle error - backend may not be available
      }

      const savedPricing =
        localStorage.getItem("admin-pricing");
      if (savedPricing) {
        try {
          setPricing(JSON.parse(savedPricing));
          console.log(" Using saved pricing");
        } catch (e) {
          console.log(" Using default pricing");
        }
      }
    }

    loadPricingFromDB();

    // Load website content
    setContent(loadContent());
  }, []);

  // Load bookings when component mounts and user is authenticated
  useEffect(() => {
    if (isAuthenticated) {
      loadBookings();
      loadConversations();
    }
  }, [isAuthenticated]);

  // ====== METRICS & ANALYTICS CALCULATIONS ======
  const metrics = useMemo(() => {
    if (!bookings || bookings.length === 0) {
      return {
        totalRevenue: 0,
        totalBookings: 0,
        totalPassengers: 0,
        averageBookingValue: 0,
        checkInRate: 0,
        revenueByDate: [],
        bookingsByTicketType: [],
        popularAttractions: [],
        revenueByMonth: [],
        checkInStats: { checked: 0, pending: 0, partial: 0 },
        upcomingBookings: [],
        recentBookings: [],
        todaysBookings: [],
        todayStats: {
          totalBookings: 0,
          totalPassengers: 0,
          checkedIn: 0,
          pending: 0,
          revenue: 0,
          checkInRate: 0,
        },
      };
    }

    // Total metrics
    const totalRevenue = bookings.reduce(
      (sum, b) => sum + (b.totalPrice || 0),
      0,
    );
    const totalBookings = bookings.length;
    const totalPassengers = bookings.reduce(
      (sum, b) => sum + (b.passengers?.length || 0),
      0,
    );
    const averageBookingValue = totalRevenue / totalBookings;

    // Check-in statistics
    let totalCheckedIn = 0;
    let totalPending = 0;
    let fullyCheckedIn = 0;
    let partiallyCheckedIn = 0;

    bookings.forEach((booking) => {
      const total = booking.passengers?.length || 0;
      const checked = (booking.checkIns || []).filter(
        (checkInArray: any[]) =>
          checkInArray && checkInArray.length > 0,
      ).length;

      totalCheckedIn += checked;
      totalPending += total - checked;

      if (checked === total && total > 0) {
        fullyCheckedIn++;
      } else if (checked > 0) {
        partiallyCheckedIn++;
      }
    });

    const checkInRate =
      totalPassengers > 0
        ? (totalCheckedIn / totalPassengers) * 100
        : 0;

    // Today's stats
    const today = new Date().toISOString().split("T")[0];
    const todaysBookings = bookings.filter(
      (b) => b.selectedDate === today,
    );
    let todayCheckedIn = 0;
    let todayTotalPassengers = 0;
    let todayRevenue = 0;

    todaysBookings.forEach((booking) => {
      const total = booking.passengers?.length || 0;
      const checked = (booking.checkIns || []).filter(
        (checkInArray: any[]) =>
          checkInArray && checkInArray.length > 0,
      ).length;
      todayCheckedIn += checked;
      todayTotalPassengers += total;
      todayRevenue += booking.totalPrice || 0;
    });

    // Revenue by date (last 30 days)
    const last30Days: { date: string; revenue: number }[] = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      const dateStr = date.toISOString().split("T")[0];
      const dayRevenue = bookings
        .filter((b) => b.selectedDate === dateStr)
        .reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      last30Days.push({ date: dateStr, revenue: dayRevenue });
    }

    // Revenue by month (last 12 months)
    const revenueByMonth: {
      month: string;
      revenue: number;
    }[] = [];
    for (let i = 11; i >= 0; i--) {
      const date = new Date();
      date.setMonth(date.getMonth() - i);
      const monthStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}`;
      const monthRevenue = bookings
        .filter((b) => b.selectedDate?.startsWith(monthStr))
        .reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      revenueByMonth.push({
        month: monthStr,
        revenue: monthRevenue,
      });
    }

    // Bookings by ticket type
    const standardCount = bookings.filter(
      (b) => !b.isGuidedTour,
    ).length;
    const guidedCount = bookings.filter(
      (b) => b.isGuidedTour,
    ).length;
    const bookingsByTicketType = [
      { type: "Standard", count: standardCount },
      { type: "Guided", count: guidedCount },
    ];

    // Popular attractions
    const attractionCounts: { [key: string]: number } = {};
    bookings.forEach((booking) => {
      (booking.attractions || []).forEach((attr: string) => {
        attractionCounts[attr] =
          (attractionCounts[attr] || 0) + 1;
      });
    });
    const popularAttractions = Object.entries(attractionCounts)
      .map(([name, count]) => ({ name, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 5);

    // Upcoming bookings (next 7 days)
    const upcomingDate = new Date();
    upcomingDate.setDate(upcomingDate.getDate() + 7);
    const upcomingStr = upcomingDate
      .toISOString()
      .split("T")[0];
    const upcomingBookings = bookings
      .filter(
        (b) =>
          b.selectedDate >= today &&
          b.selectedDate <= upcomingStr,
      )
      .sort(
        (a, b) =>
          new Date(a.selectedDate).getTime() -
          new Date(b.selectedDate).getTime(),
      )
      .slice(0, 5);

    // Recent bookings
    const recentBookings = [...bookings]
      .sort(
        (a, b) =>
          new Date(b.createdAt || 0).getTime() -
          new Date(a.createdAt || 0).getTime(),
      )
      .slice(0, 5);

    return {
      totalRevenue,
      totalBookings,
      totalPassengers,
      averageBookingValue,
      checkInRate,
      revenueByDate: last30Days,
      bookingsByTicketType,
      popularAttractions,
      revenueByMonth,
      checkInStats: {
        checked: fullyCheckedIn,
        partial: partiallyCheckedIn,
        pending:
          totalBookings - fullyCheckedIn - partiallyCheckedIn,
      },
      upcomingBookings,
      recentBookings,
      todaysBookings,
      todayStats: {
        totalBookings: todaysBookings.length,
        totalPassengers: todayTotalPassengers,
        checkedIn: todayCheckedIn,
        pending: todayTotalPassengers - todayCheckedIn,
        revenue: todayRevenue,
        checkInRate:
          todayTotalPassengers > 0
            ? (todayCheckedIn / todayTotalPassengers) * 100
            : 0,
      },
    };
  }, [bookings]);

  // Login screen
  if (!isAuthenticated) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-secondary/30 px-4">
        <Card className="w-full max-w-md border-border p-8">
          <div className="mb-6 flex justify-center">
            <div className="flex h-16 w-16 items-center justify-center rounded-full bg-primary/10">
              <Lock className="h-8 w-8 text-primary" />
            </div>
          </div>

          <h1 className="mb-2 text-center text-foreground">
            Admin Console
          </h1>
          <p className="mb-6 text-center text-muted-foreground">
            Enter password to access admin settings
          </p>

          <div className="space-y-4">
            <div>
              <Label htmlFor="password">Password</Label>
              <div className="relative mt-2">
                <Input
                  id="password"
                  type={showPassword ? "text" : "password"}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  onKeyPress={(e) =>
                    e.key === "Enter" && handleLogin()
                  }
                  className="border-border pr-10"
                  placeholder="Enter admin password"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
                >
                  {showPassword ? (
                    <EyeOff className="h-4 w-4" />
                  ) : (
                    <Eye className="h-4 w-4" />
                  )}
                </button>
              </div>
              {error && (
                <p className="mt-2 text-destructive">{error}</p>
              )}
            </div>

            <Button
              onClick={handleLogin}
              className="w-full bg-primary hover:bg-primary/90"
            >
              <LogIn className="mr-2 h-4 w-4" />
              Sign In
            </Button>
          </div>
        </Card>
      </div>
    );
  }

  // Main admin dashboard
  return (
    <div className="flex-1 bg-secondary/30 py-6 sm:py-8 lg:py-12">
      <div className="mx-auto max-w-7xl px-3 sm:px-4 lg:px-8">
        {/* Header */}
        <div className="mb-6 sm:mb-8">
          <div className="flex flex-col gap-3 sm:gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <div className="mb-2 sm:mb-3 flex items-center gap-2 sm:gap-3">
                <div className="flex h-10 w-10 sm:h-12 sm:w-12 items-center justify-center rounded-lg bg-primary/10">
                  <Settings className="h-5 w-5 sm:h-6 sm:w-6 text-primary" />
                </div>
                <h1 className="text-foreground text-lg sm:text-xl lg:text-2xl">
                  Admin Console
                </h1>
              </div>
              <div className="h-1 w-16 sm:w-20 rounded-full bg-accent" />
            </div>
            <div className="flex flex-wrap gap-2">
              <Button
                variant="outline"
                onClick={() => {
                  setLoadingBookings(true);
                  checkForNewItems(false).finally(() =>
                    setLoadingBookings(false),
                  );
                }}
                disabled={loadingBookings}
                className="gap-1.5 sm:gap-2 text-xs sm:text-sm"
                size="sm"
              >
                <RefreshCw
                  className={`h-3.5 w-3.5 sm:h-4 sm:w-4 ${loadingBookings ? "animate-spin" : ""}`}
                />
                <span className="hidden md:inline">
                  Refresh Data
                </span>
                <span className="md:hidden">Refresh</span>
              </Button>
              <Button
                variant="outline"
                onClick={() => onNavigate("home")}
                className="gap-1.5 sm:gap-2 text-xs sm:text-sm"
                size="sm"
              >
                <span className="hidden sm:inline">
                  Back to Website
                </span>
                <span className="sm:hidden">Website</span>
              </Button>

              <Button
                variant="outline"
                onClick={() => onNavigate("diagnostics")}
                className="gap-1.5 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3"
                size="sm"
              >
                <AlertCircle className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                <span className="hidden lg:inline">
                  Diagnostics
                </span>
              </Button>
              <Button
                variant="outline"
                onClick={() => onNavigate("qr-scanner")}
                className="gap-1.5 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3"
                size="sm"
              >
                <QrCode className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                <span className="hidden lg:inline">
                  QR Scanner
                </span>
              </Button>
            </div>
          </div>
        </div>

        {/* Mobile-Friendly Notification Banner */}
        {(newPickupsCount > 0 || newBookingsCount > 0 || conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length > 0) && (
          <div className="mb-4 sm:mb-6 p-3 sm:p-4 bg-blue-500/10 border-2 border-blue-500 rounded-lg animate-pulse">
            <div className="flex items-center gap-2 sm:gap-3 text-blue-700 dark:text-blue-300">
              <div className="flex h-8 w-8 sm:h-10 sm:w-10 items-center justify-center rounded-full bg-blue-500 animate-bounce">
                <span className="text-white text-sm sm:text-base">
                  {newPickupsCount + newBookingsCount + conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length}
                </span>
              </div>
              <div className="flex-1">
                <p className="text-sm sm:text-base">
                  <strong>You have new notifications!</strong>
                </p>
                <p className="text-xs sm:text-sm opacity-90 mt-0.5">
                  {newPickupsCount > 0 && `${newPickupsCount} pickup${newPickupsCount > 1 ? 's' : ''} `}
                  {newBookingsCount > 0 && `${newBookingsCount} booking${newBookingsCount > 1 ? 's' : ''} `}
                  {conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length > 0 && `${conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length} message${conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length > 1 ? 's' : ''}`}
                </p>
              </div>
              <button
                onClick={() => {
                  // Cycle through tabs with notifications
                  if (newPickupsCount > 0) setActiveTab('pickups');
                  else if (newBookingsCount > 0) setActiveTab('bookings');
                  else if (conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length > 0) setActiveTab('messages');
                }}
                className="px-3 py-1.5 sm:px-4 sm:py-2 bg-blue-500 text-white rounded-md text-xs sm:text-sm hover:bg-blue-600 transition-colors"
              >
                View
              </button>
            </div>
          </div>
        )}

        {/* Mobile Setup Guide Banner */}
        {showMobileGuide && (isIOS || isAndroid || window.innerWidth < 768) && (
          <div className="mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-teal-500/10 to-orange-500/10 border border-teal-500/50 rounded-lg">
            <div className="flex items-start gap-2 sm:gap-3">
              <div className="flex-shrink-0 text-2xl"></div>
              <div className="flex-1">
                <h3 className="text-sm sm:text-base font-semibold text-foreground mb-1.5">
                  {isIOS ? 'iOS' : isAndroid ? 'Android' : 'Mobile'} Notifications Active!
                </h3>
                <div className="text-xs sm:text-sm text-muted-foreground space-y-1">
                  <p> Real-time push notifications enabled</p>
                  <p> Sound alerts for new bookings, messages & pickups</p>
                  {isAndroid && <p> Vibration enabled</p>}
                  {isIOS && (
                    <p className="text-amber-600 dark:text-amber-400">
                       iOS: Keep this tab active for notifications
                    </p>
                  )}
                  <p className="mt-2 text-xs opacity-75">
                     <strong>Tip:</strong> {isIOS ? 'Add to home screen for best experience' : 'Keep this tab open in background'}
                  </p>
                </div>
              </div>
              <button
                onClick={() => {
                  setShowMobileGuide(false);
                  localStorage.setItem('hide-mobile-guide', 'true');
                }}
                className="flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors"
              >
                <svg className="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        )}

        <Tabs
          defaultValue="pickups"
          value={activeTab}
          onValueChange={(tab) => {
            setActiveTab(tab);
            // Clear notification badges when tab is clicked
            if (tab === "pickups") {
              setNewPickupsCount(0);
            } else if (tab === "bookings") {
              setNewBookingsCount(0);
            }
            // Update page title to reflect cleared count
            const unreadMessages = conversations.filter(c => c.unreadByAdmin > 0 && !c.archived).length;
            const totalCount = newPickupsCount + newBookingsCount + unreadMessages;
            const clearedTotal = tab === "pickups" ? totalCount - newPickupsCount : tab === "bookings" ? totalCount - newBookingsCount : totalCount;
            document.title = clearedTotal > 0 ? `(${clearedTotal}) Hop On Sintra Admin` : 'Hop On Sintra Admin';
          }}
          className="w-full"
        >
          <div className="mb-4 sm:mb-8">
            <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
              <TabsList className="w-full sm:w-auto flex-wrap h-auto gap-1">
                <TabsTrigger
                  value="pickups"
                  className="flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 relative"
                >
                  <Navigation className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                  <span>Pickups</span>
                  {newPickupsCount > 0 && (
                    <span className="ml-1 flex h-4 w-4 sm:h-5 sm:w-5 items-center justify-center rounded-full bg-orange-500 text-xs text-white animate-pulse">
                      {newPickupsCount}
                    </span>
                  )}
                </TabsTrigger>
                <TabsTrigger
                  value="bookings"
                  className="flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 relative"
                >
                  <Package className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                  <span>Bookings</span>
                  {newBookingsCount > 0 && (
                    <span className="ml-1 flex h-4 w-4 sm:h-5 sm:w-5 items-center justify-center rounded-full bg-blue-500 text-xs text-white animate-pulse">
                      {newBookingsCount}
                    </span>
                  )}
                </TabsTrigger>
                <TabsTrigger
                  value="messages"
                  className="flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 relative"
                >
                  <MessageCircle className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                  <span>Messages</span>
                  {conversations.filter(
                    (c) => c.unreadByAdmin > 0 && !c.archived,
                  ).length > 0 && (
                    <span className="ml-1 flex h-4 w-4 sm:h-5 sm:w-5 items-center justify-center rounded-full bg-red-500 text-xs text-white">
                      {
                        conversations.filter(
                          (c) => c.unreadByAdmin > 0,
                        ).length
                      }
                    </span>
                  )}
                </TabsTrigger>
                <TabsTrigger
                  value="metrics"
                  className="flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3"
                >
                  <BarChart3 className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                  <span>Analytics</span>
                </TabsTrigger>
              </TabsList>

              <Sheet
                open={moreMenuOpen}
                onOpenChange={setMoreMenuOpen}
              >
                <SheetTrigger asChild>
                  <Button
                    variant="outline"
                    className="gap-2 text-xs sm:text-sm px-3 sm:px-4"
                  >
                    <MoreHorizontal className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                    More
                  </Button>
                </SheetTrigger>
                <SheetContent
                  side="right"
                  className="w-full sm:max-w-md overflow-y-auto"
                >
                  <SheetHeader>
                    <SheetTitle>More Options</SheetTitle>
                    <SheetDescription>
                      Access additional admin tools and settings
                    </SheetDescription>
                  </SheetHeader>
                  <div className="mt-6 space-y-2">
                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("drivers");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <UserCog className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Drivers</span>
                        <span className="text-xs text-muted-foreground">
                          Manage driver accounts
                        </span>
                      </div>
                    </Button>

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("settings");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <DollarSign className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Settings</span>
                        <span className="text-xs text-muted-foreground">
                          Pricing, availability & system
                          settings
                        </span>
                      </div>
                    </Button>

                    <div className="my-4 h-px bg-border" />

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("images");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <Image className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Images</span>
                        <span className="text-xs text-muted-foreground">
                          Upload and manage images
                        </span>
                      </div>
                    </Button>

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("content");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <Settings className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Content</span>
                        <span className="text-xs text-muted-foreground">
                          Edit website content
                        </span>
                      </div>
                    </Button>

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("blog");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <FileText className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Blog</span>
                        <span className="text-xs text-muted-foreground">
                          Manage blog articles
                        </span>
                      </div>
                    </Button>

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("seo");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <Tag className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>SEO</span>
                        <span className="text-xs text-muted-foreground">
                          SEO tools and settings
                        </span>
                      </div>
                    </Button>

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("tags");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <Tag className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Tags</span>
                        <span className="text-xs text-muted-foreground">
                          Manage blog tags
                        </span>
                      </div>
                    </Button>

                    <div className="my-4 h-px bg-border" />

                    <Button
                      variant="ghost"
                      className="w-full justify-start gap-3"
                      onClick={() => {
                        setActiveTab("cleanup");
                        setMoreMenuOpen(false);
                      }}
                    >
                      <Trash2 className="h-5 w-5" />
                      <div className="flex flex-col items-start">
                        <span>Database Cleanup</span>
                        <span className="text-xs text-muted-foreground">
                          Remove old data and optimize
                        </span>
                      </div>
                    </Button>
                  </div>
                </SheetContent>
              </Sheet>
            </div>
          </div>

          {/* ====== PICKUPS TAB ====== */}
          <TabsContent
            value="pickups"
            className="space-y-4 sm:space-y-6"
          >
            <PickupRequestsManagement />
          </TabsContent>

          {/* ====== BOOKINGS TAB ====== */}
          <TabsContent
            value="bookings"
            className="space-y-4 sm:space-y-6"
          >
            <CompactBookingsList
              bookings={bookings}
              onRefresh={loadBookings}
            />
          </TabsContent>

          {/* ====== MESSAGES TAB ====== */}
          <TabsContent
            value="messages"
            className="space-y-4 sm:space-y-6"
          >
            {/* WhatsApp-style layout */}
            <div className="flex h-[calc(100vh-200px)] md:h-[calc(100vh-200px)] overflow-hidden rounded-lg border border-border bg-background">
              {/* Left Sidebar - Conversations List */}
              <div
                className={`flex w-full flex-col border-r border-border md:w-[350px] ${selectedConversation ? "hidden md:flex" : "flex"}`}
              >
                {/* Sidebar Header */}
                <div className="border-b border-border bg-background p-4">
                  <div className="flex items-center justify-between mb-2">
                    <h2 className="text-foreground">
                      Messages
                    </h2>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() =>
                        setShowArchivedConversations(
                          !showArchivedConversations,
                        )
                      }
                      className="gap-2"
                    >
                      {showArchivedConversations ? (
                        <>
                          <MessageCircle className="h-4 w-4" />
                          <span className="hidden md:inline">
                            Active
                          </span>
                        </>
                      ) : (
                        <>
                          <Archive className="h-4 w-4" />
                          <span className="hidden md:inline">
                            Archived
                          </span>
                        </>
                      )}
                    </Button>
                  </div>
                  <p className="text-xs text-muted-foreground">
                    {showArchivedConversations
                      ? `${conversations.filter((c: any) => c.archived).length} archived`
                      : `${conversations.filter((c: any) => c.unreadByAdmin > 0 && !c.archived).length} unread`}
                  </p>
                </div>

                {/* Conversations List */}
                <div className="flex-1 overflow-y-auto">
                  {loadingConversations ? (
                    <div className="flex items-center justify-center py-12">
                      <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
                    </div>
                  ) : conversations.filter((c: any) =>
                      showArchivedConversations
                        ? c.archived
                        : !c.archived,
                    ).length === 0 ? (
                    <div className="flex flex-col items-center justify-center py-12 px-4">
                      <MessageCircle className="h-12 w-12 text-muted-foreground/50 mb-3" />
                      <p className="text-center text-muted-foreground">
                        {showArchivedConversations
                          ? "No archived conversations"
                          : "No conversations yet"}
                      </p>
                      <p className="text-xs text-center text-muted-foreground mt-1">
                        {showArchivedConversations
                          ? "Archived chats will appear here"
                          : "Customer messages will appear here"}
                      </p>
                    </div>
                  ) : (
                    <div>
                      {conversations
                        .filter((c: any) =>
                          showArchivedConversations
                            ? c.archived
                            : !c.archived,
                        )
                        .map((conv: any) => {
                          const lastMessage =
                            conv.lastMessage || "";
                          const lastMessageTime =
                            conv.lastMessageTime
                              ? new Date(conv.lastMessageTime)
                              : new Date(conv.createdAt);
                          const isToday =
                            new Date().toDateString() ===
                            lastMessageTime.toDateString();
                          const timeDisplay = isToday
                            ? lastMessageTime.toLocaleTimeString(
                                [],
                                {
                                  hour: "2-digit",
                                  minute: "2-digit",
                                },
                              )
                            : lastMessageTime.toLocaleDateString(
                                [],
                                {
                                  month: "short",
                                  day: "numeric",
                                },
                              );

                          return (
                            <button
                              key={conv.id}
                              onClick={() => {
                                setSelectedConversation(
                                  conv.id,
                                );
                                loadConversationMessages(
                                  conv.id,
                                );
                              }}
                              className={`w-full border-b border-border p-4 text-left transition-colors hover:bg-secondary/30 ${
                                selectedConversation === conv.id
                                  ? "bg-primary/5 border-l-4 border-l-primary"
                                  : ""
                              }`}
                            >
                              <div className="flex items-start gap-3">
                                {/* Avatar */}
                                <div className="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary">
                                  <span className="font-semibold">
                                    {(conv.name || "A")
                                      .charAt(0)
                                      .toUpperCase()}
                                  </span>
                                </div>

                                {/* Content */}
                                <div className="flex-1 overflow-hidden">
                                  <div className="flex items-start justify-between gap-2">
                                    <p
                                      className={`truncate ${conv.unreadByAdmin > 0 ? "font-semibold" : ""} text-foreground`}
                                    >
                                      {conv.name || "Anonymous"}
                                    </p>
                                    <span className="text-xs text-muted-foreground whitespace-nowrap">
                                      {timeDisplay}
                                    </span>
                                  </div>
                                  <div className="flex items-center justify-between gap-2 mt-1">
                                    <p
                                      className={`truncate text-sm ${conv.unreadByAdmin > 0 ? "text-foreground font-medium" : "text-muted-foreground"}`}
                                    >
                                      {lastMessage ||
                                        "No messages yet"}
                                    </p>
                                    {conv.unreadByAdmin > 0 && (
                                      <span className="flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-full bg-primary text-xs text-primary-foreground">
                                        {conv.unreadByAdmin}
                                      </span>
                                    )}
                                  </div>
                                </div>
                              </div>
                            </button>
                          );
                        })}
                    </div>
                  )}
                </div>
              </div>

              {/* Right Side - Chat Area */}
              <div
                className={`flex flex-1 flex-col ${selectedConversation ? "flex" : "hidden md:flex"}`}
              >
                {selectedConversation ? (
                  <>
                    {/* Chat Header */}
                    <div className="flex items-center justify-between border-b border-border bg-background p-4">
                      <div className="flex items-center gap-3">
                        {/* Back Button (Mobile) */}
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() =>
                            setSelectedConversation(null)
                          }
                          className="md:hidden p-2"
                        >
                          <ArrowLeft className="h-5 w-5" />
                        </Button>
                        {/* Avatar */}
                        <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary">
                          <span className="font-semibold">
                            {(
                              conversations.find(
                                (c: any) =>
                                  c.id === selectedConversation,
                              )?.name || "A"
                            )
                              .charAt(0)
                              .toUpperCase()}
                          </span>
                        </div>
                        {/* Info */}
                        <div className="flex-1 overflow-hidden">
                          <p className="font-medium text-foreground truncate">
                            {conversations.find(
                              (c: any) =>
                                c.id === selectedConversation,
                            )?.name || "Anonymous"}
                          </p>
                          <p className="text-xs text-muted-foreground truncate">
                            {conversations.find(
                              (c: any) =>
                                c.id === selectedConversation,
                            )?.email || ""}
                          </p>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        {conversations.find(
                          (c: any) =>
                            c.id === selectedConversation,
                        )?.archived ? (
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() =>
                              handleUnarchiveConversation(
                                selectedConversation,
                              )
                            }
                            className="gap-2"
                          >
                            <ArchiveRestore className="h-4 w-4" />
                            <span className="hidden md:inline">
                              Restore
                            </span>
                          </Button>
                        ) : (
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() =>
                              handleArchiveConversation(
                                selectedConversation,
                              )
                            }
                            className="gap-2"
                          >
                            <Archive className="h-4 w-4" />
                            <span className="hidden md:inline">
                              Archive
                            </span>
                          </Button>
                        )}
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={loadConversations}
                        >
                          <RefreshCw className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>

                    {/* Messages Area */}
                    <div className="flex-1 overflow-y-auto bg-secondary/5 p-4 space-y-3">
                      {conversationMessages.length === 0 ? (
                        <div className="flex h-full items-center justify-center">
                          <p className="text-muted-foreground">
                            No messages yet
                          </p>
                        </div>
                      ) : (
                        conversationMessages.map((msg: any) => (
                          <div
                            key={msg.id}
                            className={`flex ${
                              msg.sender === "admin"
                                ? "justify-end"
                                : "justify-start"
                            }`}
                          >
                            <div
                              className={`max-w-[70%] rounded-2xl px-4 py-2 ${
                                msg.sender === "admin"
                                  ? "bg-primary text-primary-foreground rounded-br-sm"
                                  : "bg-background border border-border text-foreground rounded-bl-sm"
                              }`}
                            >
                              <p className="text-sm leading-relaxed">
                                {msg.message}
                              </p>
                              <p
                                className={`mt-1 text-xs ${
                                  msg.sender === "admin"
                                    ? "text-primary-foreground/70"
                                    : "text-muted-foreground"
                                } text-right`}
                              >
                                {new Date(
                                  msg.createdAt,
                                ).toLocaleTimeString([], {
                                  hour: "2-digit",
                                  minute: "2-digit",
                                })}
                              </p>
                            </div>
                          </div>
                        ))
                      )}
                    </div>

                    {/* Message Input */}
                    <div className="border-t border-border bg-background p-4">
                      <div className="flex gap-2">
                        <Input
                          value={replyMessage}
                          onChange={(e) =>
                            setReplyMessage(e.target.value)
                          }
                          placeholder="Type a message..."
                          onKeyPress={(e) =>
                            e.key === "Enter" &&
                            handleSendReply()
                          }
                          className="flex-1"
                        />
                        <Button
                          onClick={handleSendReply}
                          disabled={!replyMessage.trim()}
                          className="gap-2"
                        >
                          <Send className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>
                  </>
                ) : (
                  <div className="hidden md:flex h-full flex-col items-center justify-center bg-secondary/5 p-8">
                    <MessageCircle className="h-20 w-20 text-muted-foreground/30 mb-4" />
                    <h3 className="font-medium text-foreground mb-2">
                      Select a conversation
                    </h3>
                    <p className="text-center text-sm text-muted-foreground max-w-sm">
                      Choose a conversation from the list to
                      view and respond to customer messages
                    </p>
                  </div>
                )}
              </div>
            </div>
          </TabsContent>

          {/* ====== METRICS TAB ====== */}
          <TabsContent
            value="metrics"
            className="space-y-4 sm:space-y-6"
          >
            {/* Today's Operations - Featured Section */}
            <Card className="border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-accent/5 p-4 sm:p-6">
              <div className="mb-4 sm:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                <div className="flex items-center gap-3">
                  <div className="flex h-10 w-10 sm:h-12 sm:w-12 items-center justify-center rounded-full bg-primary/10">
                    <CalendarIconMetrics className="h-5 w-5 sm:h-6 sm:w-6 text-primary" />
                  </div>
                  <div>
                    <h2 className="text-foreground text-sm sm:text-base">
                      Today's Operations
                    </h2>
                    <p className="text-muted-foreground text-xs sm:text-sm">
                      {new Date().toLocaleDateString("en-US", {
                        weekday: "long",
                        month: "long",
                        day: "numeric",
                        year: "numeric",
                      })}
                    </p>
                  </div>
                </div>
                <Button
                  onClick={() => {
                    setLoadingBookings(true);
                    checkForNewItems(false).finally(() =>
                      setLoadingBookings(false),
                    );
                  }}
                  variant="outline"
                  size="sm"
                  disabled={loadingBookings}
                  className="gap-1.5 sm:gap-2 text-xs sm:text-sm w-full sm:w-auto"
                >
                  {loadingBookings ? (
                    <>
                      <div className="h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin rounded-full border-2 border-primary border-t-transparent" />
                      <span className="hidden sm:inline">
                        Updating...
                      </span>
                      <span className="sm:hidden">
                        Loading...
                      </span>
                    </>
                  ) : (
                    <>
                      <Clock className="h-3.5 w-3.5 sm:h-4 sm:w-4" />
                      Refresh
                    </>
                  )}
                </Button>
              </div>

              {/* Today's Quick Stats */}
              <div className="mb-4 sm:mb-6 grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4">
                <div className="rounded-lg bg-white p-3 sm:p-4 shadow-sm">
                  <div className="flex items-center gap-1.5 sm:gap-2">
                    <Package className="h-4 w-4 sm:h-5 sm:w-5 text-primary" />
                    <p className="text-muted-foreground text-xs sm:text-sm">
                      Bookings
                    </p>
                  </div>
                  <p className="mt-1.5 sm:mt-2 text-foreground text-lg sm:text-2xl">
                    {metrics.todayStats.totalBookings}
                  </p>
                </div>

                <div className="rounded-lg bg-white p-3 sm:p-4 shadow-sm">
                  <div className="flex items-center gap-1.5 sm:gap-2">
                    <Users className="h-4 w-4 sm:h-5 sm:w-5 text-primary" />
                    <p className="text-muted-foreground text-xs sm:text-sm">
                      Passengers
                    </p>
                  </div>
                  <p className="mt-1.5 sm:mt-2 text-foreground text-lg sm:text-2xl">
                    {metrics.todayStats.totalPassengers}
                  </p>
                </div>

                <div className="rounded-lg bg-white p-3 sm:p-4 shadow-sm">
                  <div className="flex items-center gap-1.5 sm:gap-2">
                    <CheckCircle2 className="h-4 w-4 sm:h-5 sm:w-5 text-green-600" />
                    <p className="text-muted-foreground text-xs sm:text-sm">
                      Checked In
                    </p>
                  </div>
                  <p className="mt-1.5 sm:mt-2 text-foreground text-sm sm:text-base">
                    {metrics.todayStats.checkedIn} /{" "}
                    {metrics.todayStats.totalPassengers}
                  </p>
                  <div className="mt-1.5 sm:mt-2 h-2 w-full overflow-hidden rounded-full bg-muted">
                    <div
                      className="h-full bg-green-600 transition-all duration-500"
                      style={{
                        width: `${metrics.todayStats.checkInRate}%`,
                      }}
                    />
                  </div>
                </div>

                <div className="rounded-lg bg-white p-3 sm:p-4 shadow-sm">
                  <div className="flex items-center gap-1.5 sm:gap-2">
                    <DollarSign className="h-4 w-4 sm:h-5 sm:w-5 text-green-600" />
                    <p className="text-muted-foreground text-xs sm:text-sm">
                      Revenue
                    </p>
                  </div>
                  <p className="mt-1.5 sm:mt-2 text-primary text-lg sm:text-2xl">
                    {metrics.todayStats.revenue.toFixed(2)}
                  </p>
                </div>
              </div>

              {/* Today's Bookings List */}
              {metrics.todaysBookings.length > 0 ? (
                <div>
                  <h3 className="mb-3 text-foreground text-sm sm:text-base">
                    Today's Bookings (
                    {metrics.todaysBookings.length})
                  </h3>
                  <div className="space-y-2 sm:space-y-3">
                    {metrics.todaysBookings.map(
                      (booking: any) => {
                        const totalPassengers =
                          booking.passengers?.length || 0;
                        const checkedInCount = (
                          booking.checkIns || []
                        ).filter(
                          (checkInArray: any[]) =>
                            checkInArray &&
                            checkInArray.length > 0,
                        ).length;
                        const bookingIdShort =
                          booking.id.split("_")[1] ||
                          booking.id;

                        return (
                          <div
                            key={booking.id}
                            className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 rounded-lg border border-border bg-white p-3 sm:p-4 shadow-sm"
                          >
                            <div className="flex items-center gap-3 sm:gap-4">
                              <div className="flex flex-col">
                                <p className="font-mono text-primary text-xs sm:text-sm">
                                  #{bookingIdShort}
                                </p>
                                <p className="text-muted-foreground text-xs">
                                  {booking.timeSlot}
                                </p>
                              </div>
                              <div className="h-8 w-px bg-border hidden sm:block" />
                              <div>
                                <p className="text-foreground text-sm sm:text-base">
                                  {booking.contactInfo?.name ||
                                    "N/A"}
                                </p>
                                <p className="text-muted-foreground text-xs sm:text-sm">
                                  {totalPassengers}{" "}
                                  {totalPassengers === 1
                                    ? "passenger"
                                    : "passengers"}
                                </p>
                              </div>
                            </div>
                            <div className="flex items-center justify-between sm:justify-end gap-3 sm:gap-4">
                              <p className="text-primary text-sm sm:text-base">
                                
                                {booking.totalPrice?.toFixed(2)}
                              </p>
                              <div>
                                {checkedInCount === 0 ? (
                                  <div className="inline-flex items-center gap-1.5 rounded-full bg-muted px-3 py-1.5">
                                    <Clock className="h-3.5 w-3.5 text-muted-foreground" />
                                    <span className="text-muted-foreground">
                                      Pending
                                    </span>
                                  </div>
                                ) : checkedInCount ===
                                  totalPassengers ? (
                                  <div className="inline-flex items-center gap-1.5 rounded-full bg-green-100 px-3 py-1.5">
                                    <CheckCircle2 className="h-3.5 w-3.5 text-green-600" />
                                    <span className="text-green-600">
                                      Complete
                                    </span>
                                  </div>
                                ) : (
                                  <div className="inline-flex items-center gap-1.5 rounded-full bg-yellow-100 px-3 py-1.5">
                                    <AlertCircle className="h-3.5 w-3.5 text-yellow-600" />
                                    <span className="text-yellow-600">
                                      {checkedInCount}/
                                      {totalPassengers}
                                    </span>
                                  </div>
                                )}
                              </div>
                            </div>
                          </div>
                        );
                      },
                    )}
                  </div>
                </div>
              ) : (
                <div className="rounded-lg border-2 border-dashed border-border bg-white/50 p-8 text-center">
                  <CalendarIconMetrics className="mx-auto mb-3 h-12 w-12 text-muted-foreground" />
                  <h3 className="mb-2 text-foreground">
                    No Bookings Today
                  </h3>
                  <p className="text-muted-foreground">
                    No bookings scheduled for today yet.
                  </p>
                </div>
              )}
            </Card>

            {/* Summary Cards */}
            <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
              <Card className="border-border p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-muted-foreground">
                      Total Revenue
                    </p>
                    <h2 className="mt-2 text-foreground">
                      {metrics.totalRevenue.toFixed(2)}
                    </h2>
                  </div>
                  <div className="flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
                    <DollarSign className="h-6 w-6 text-green-600" />
                  </div>
                </div>
              </Card>

              <Card className="border-border p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-muted-foreground">
                      Total Bookings
                    </p>
                    <h2 className="mt-2 text-foreground">
                      {metrics.totalBookings}
                    </h2>
                  </div>
                  <div className="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100">
                    <Package className="h-6 w-6 text-blue-600" />
                  </div>
                </div>
              </Card>

              <Card className="border-border p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-muted-foreground">
                      Total Passengers
                    </p>
                    <h2 className="mt-2 text-foreground">
                      {metrics.totalPassengers}
                    </h2>
                  </div>
                  <div className="flex h-12 w-12 items-center justify-center rounded-full bg-purple-100">
                    <Users className="h-6 w-6 text-purple-600" />
                  </div>
                </div>
              </Card>

              <Card className="border-border p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-muted-foreground">
                      Avg Booking Value
                    </p>
                    <h2 className="mt-2 text-foreground">
                      {metrics.averageBookingValue.toFixed(2)}
                    </h2>
                  </div>
                  <div className="flex h-12 w-12 items-center justify-center rounded-full bg-orange-100">
                    <TrendingUp className="h-6 w-6 text-orange-600" />
                  </div>
                </div>
              </Card>
            </div>

            {/* Charts Row */}
            <div className="grid gap-4 sm:gap-6 lg:grid-cols-2">
              {/* Revenue Trend */}
              <Card className="border-border p-4 sm:p-6">
                <div className="mb-4 sm:mb-6">
                  <h3 className="text-foreground text-sm sm:text-base">
                    Revenue Trend (Last 14 Days)
                  </h3>
                  <p className="text-muted-foreground text-xs sm:text-sm">
                    Daily revenue overview
                  </p>
                </div>
                {metrics.revenueByDate.length > 0 ? (
                  <ResponsiveContainer
                    width="100%"
                    height={250}
                  >
                    <LineChart data={metrics.revenueByDate}>
                      <CartesianGrid
                        strokeDasharray="3 3"
                        stroke="#f0e9e3"
                      />
                      <XAxis dataKey="date" stroke="#6b7280" />
                      <YAxis stroke="#6b7280" />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: "#fff",
                          border: "1px solid #f0e9e3",
                        }}
                        formatter={(value: number) =>
                          `${(value || 0).toFixed(2)}`
                        }
                      />
                      <Line
                        type="monotone"
                        dataKey="revenue"
                        stroke="#0A4D5C"
                        strokeWidth={2}
                        dot={{ fill: "#0A4D5C" }}
                      />
                    </LineChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="flex h-[300px] items-center justify-center">
                    <p className="text-muted-foreground">
                      No revenue data yet
                    </p>
                  </div>
                )}
              </Card>

              {/* Ticket Type Distribution */}
              <Card className="border-border p-4 sm:p-6">
                <div className="mb-4 sm:mb-6">
                  <h3 className="text-foreground text-sm sm:text-base">
                    Ticket Type Distribution
                  </h3>
                  <p className="text-muted-foreground text-xs sm:text-sm">
                    Standard vs Guided
                  </p>
                </div>
                {metrics.bookingsByTicketType.length > 0 &&
                metrics.totalBookings > 0 ? (
                  <ResponsiveContainer
                    width="100%"
                    height={250}
                  >
                    <RechartsPie>
                      <Pie
                        data={metrics.bookingsByTicketType}
                        cx="50%"
                        cy="50%"
                        labelLine={false}
                        label={(entry) =>
                          `${entry.type}: ${entry.count}`
                        }
                        outerRadius={100}
                        fill="#8884d8"
                        dataKey="count"
                      >
                        {metrics.bookingsByTicketType.map(
                          (entry, index) => (
                            <Cell
                              key={`cell-${index}`}
                              fill={
                                CHART_COLORS[
                                  index % CHART_COLORS.length
                                ]
                              }
                            />
                          ),
                        )}
                      </Pie>
                      <Tooltip
                        formatter={(
                          value: number,
                          name: string,
                          props: any,
                        ) => [
                          `${value} bookings (${props.payload?.percentage?.toFixed(1) || "0.0"}%)`,
                          name,
                        ]}
                      />
                    </RechartsPie>
                  </ResponsiveContainer>
                ) : (
                  <div className="flex h-[300px] items-center justify-center">
                    <p className="text-muted-foreground">
                      No ticket data yet
                    </p>
                  </div>
                )}
              </Card>
            </div>

            {/* Popular Attractions & Check-in Stats */}
            <div className="grid gap-6 lg:grid-cols-2">
              {/* Popular Attractions */}
              <Card className="border-border p-6">
                <div className="mb-6">
                  <h3 className="text-foreground">
                    Popular Attractions
                  </h3>
                  <p className="text-muted-foreground">
                    Most booked add-ons
                  </p>
                </div>
                {metrics.popularAttractions.length > 0 ? (
                  <ResponsiveContainer
                    width="100%"
                    height={300}
                  >
                    <BarChart
                      data={metrics.popularAttractions}
                      layout="vertical"
                    >
                      <CartesianGrid
                        strokeDasharray="3 3"
                        stroke="#f0e9e3"
                      />
                      <XAxis type="number" stroke="#6b7280" />
                      <YAxis
                        dataKey="name"
                        type="category"
                        width={150}
                        stroke="#6b7280"
                      />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: "#fff",
                          border: "1px solid #f0e9e3",
                        }}
                      />
                      <Bar dataKey="count" fill="#D97843" />
                    </BarChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="flex h-[300px] items-center justify-center">
                    <p className="text-muted-foreground">
                      No attraction data yet
                    </p>
                  </div>
                )}
              </Card>

              {/* Check-in Status */}
              <Card className="border-border p-6">
                <div className="mb-6">
                  <h3 className="text-foreground">
                    Check-in Overview
                  </h3>
                  <p className="text-muted-foreground">
                    Overall check-in rate:{" "}
                    {metrics.checkInRate.toFixed(1)}%
                  </p>
                </div>
                <div className="space-y-4">
                  <div className="flex items-center justify-between rounded-lg bg-green-50 p-4">
                    <div className="flex items-center gap-3">
                      <CheckCircle2 className="h-6 w-6 text-green-600" />
                      <div>
                        <p className="text-foreground">
                          Fully Checked In
                        </p>
                        <p className="text-muted-foreground">
                          All passengers checked in
                        </p>
                      </div>
                    </div>
                    <p className="text-green-600">
                      {metrics.checkInStats.checked}
                    </p>
                  </div>

                  <div className="flex items-center justify-between rounded-lg bg-yellow-50 p-4">
                    <div className="flex items-center gap-3">
                      <AlertCircle className="h-6 w-6 text-yellow-600" />
                      <div>
                        <p className="text-foreground">
                          Partially Checked In
                        </p>
                        <p className="text-muted-foreground">
                          Some passengers checked in
                        </p>
                      </div>
                    </div>
                    <p className="text-yellow-600">
                      {metrics.checkInStats.partial}
                    </p>
                  </div>

                  <div className="flex items-center justify-between rounded-lg bg-gray-50 p-4">
                    <div className="flex items-center gap-3">
                      <Clock className="h-6 w-6 text-gray-600" />
                      <div>
                        <p className="text-foreground">
                          Not Checked In
                        </p>
                        <p className="text-muted-foreground">
                          Awaiting check-in
                        </p>
                      </div>
                    </div>
                    <p className="text-gray-600">
                      {metrics.checkInStats.pending}
                    </p>
                  </div>
                </div>
              </Card>
            </div>

            {/* Monthly Revenue */}
            {metrics.revenueByMonth.length > 0 && (
              <Card className="border-border p-6">
                <div className="mb-6">
                  <h3 className="text-foreground">
                    Monthly Revenue
                  </h3>
                  <p className="text-muted-foreground">
                    Revenue by month
                  </p>
                </div>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={metrics.revenueByMonth}>
                    <CartesianGrid
                      strokeDasharray="3 3"
                      stroke="#f0e9e3"
                    />
                    <XAxis dataKey="month" stroke="#6b7280" />
                    <YAxis stroke="#6b7280" />
                    <Tooltip
                      contentStyle={{
                        backgroundColor: "#fff",
                        border: "1px solid #f0e9e3",
                      }}
                      formatter={(value: number) =>
                        `${(value || 0).toFixed(2)}`
                      }
                    />
                    <Bar dataKey="revenue" fill="#0A4D5C" />
                  </BarChart>
                </ResponsiveContainer>
              </Card>
            )}

            {/* Upcoming Bookings Preview */}
            {metrics.upcomingBookings.length > 0 && (
              <Card className="border-border p-6">
                <div className="mb-6">
                  <h3 className="text-foreground">
                    Upcoming Bookings
                  </h3>
                  <p className="text-muted-foreground">
                    Next 5 scheduled bookings
                  </p>
                </div>
                <div className="space-y-3">
                  {metrics.upcomingBookings.map(
                    (booking: any) => (
                      <div
                        key={booking.id}
                        className="flex items-center justify-between rounded-lg border border-border bg-white p-4"
                      >
                        <div className="flex items-center gap-3">
                          <CalendarIconMetrics className="h-5 w-5 text-primary" />
                          <div>
                            <p className="text-foreground">
                              {new Date(
                                booking.selectedDate,
                              ).toLocaleDateString("en-US", {
                                month: "short",
                                day: "numeric",
                                year: "numeric",
                              })}
                            </p>
                            <p className="text-muted-foreground">
                              {booking.contactInfo?.name ||
                                "N/A"}{" "}
                              {" "}
                              {booking.passengers?.length || 0}{" "}
                              passengers
                            </p>
                          </div>
                        </div>
                        <p className="text-primary">
                          {booking.totalPrice?.toFixed(2)}
                        </p>
                      </div>
                    ),
                  )}
                </div>
              </Card>
            )}
          </TabsContent>

          {/* ====== SETTINGS TAB ====== */}
          <TabsContent
            value="settings"
            className="space-y-4 sm:space-y-6"
          >
            {/* Feature Flags */}
            <FeatureFlagManager />

            {/* Sunset Special Manager */}
            <SunsetSpecialManager />

            {/* Pricing & Availability - moved from old location */}
            <Card className="border-border p-4 sm:p-6 lg:p-8">
              <div className="mb-4 sm:mb-6">
                <h2 className="mb-2 text-foreground text-sm sm:text-base">
                  Pricing Settings
                </h2>
                <div className="h-1 w-16 rounded-full bg-accent" />
              </div>

              <div className="space-y-6">
                {/* Ticket Purchases Master Toggle */}
                <div
                  className={`rounded-lg border-2 p-4 transition-colors ${
                    ticketPurchasesEnabled
                      ? "border-green-200 bg-green-50"
                      : "border-red-200 bg-red-50"
                  }`}
                >
                  <div className="flex items-center justify-between gap-4">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <Label
                          htmlFor="ticket-purchases-toggle"
                          className="text-base cursor-pointer"
                        >
                          Enable Ticket Purchases
                        </Label>
                        {ticketPurchasesEnabled ? (
                          <CheckCircle2 className="h-5 w-5 text-green-600" />
                        ) : (
                          <Lock className="h-5 w-5 text-red-600" />
                        )}
                      </div>
                      <p
                        className={`text-sm ${
                          ticketPurchasesEnabled
                            ? "text-green-700"
                            : "text-red-700"
                        }`}
                      >
                        {ticketPurchasesEnabled
                          ? " Customers can purchase tickets and make bookings"
                          : " All dates show as SOLD OUT - Safe for testing"}
                      </p>
                    </div>
                    <Switch
                      id="ticket-purchases-toggle"
                      checked={ticketPurchasesEnabled}
                      onCheckedChange={toggleTicketPurchases}
                    />
                  </div>
                </div>

                <div className="grid gap-4 md:grid-cols-2">
                  <div>
                    <Label htmlFor="basePrice">
                      Base Day Pass Price ()
                    </Label>
                    <Input
                      id="basePrice"
                      type="number"
                      min="0"
                      step="0.01"
                      value={pricing.basePrice}
                      onChange={(e) =>
                        setPricing({
                          ...pricing,
                          basePrice:
                            parseFloat(e.target.value) || 0,
                        })
                      }
                      className="mt-2 border-border"
                    />
                  </div>

                  <div>
                    <Label htmlFor="guidedSurcharge">
                      Guided Tour Surcharge ()
                    </Label>
                    <Input
                      id="guidedSurcharge"
                      type="number"
                      min="0"
                      step="0.01"
                      value={pricing.guidedTourSurcharge}
                      onChange={(e) =>
                        setPricing({
                          ...pricing,
                          guidedTourSurcharge:
                            parseFloat(e.target.value) || 0,
                        })
                      }
                      className="mt-2 border-border"
                    />
                  </div>
                </div>

                <div className="rounded-lg bg-secondary/50 p-4">
                  <p className="text-muted-foreground">
                    Preview: Day pass will cost{" "}
                    <strong className="text-foreground">
                      {pricing.basePrice.toFixed(2)}
                    </strong>{" "}
                    per person. With guided commentary:{" "}
                    <strong className="text-foreground">
                      
                      {(
                        pricing.basePrice +
                        pricing.guidedTourSurcharge
                      ).toFixed(2)}
                    </strong>
                  </p>
                </div>

                <Button
                  onClick={saveSettings}
                  className="bg-primary hover:bg-primary/90"
                >
                  <Save className="mr-2 h-4 w-4" />
                  Save Pricing
                </Button>

                {/* Wallet Payments Info */}
                <div className="mt-6 rounded-lg border border-blue-200 bg-blue-50 p-4">
                  <div className="flex items-start gap-3">
                    <AlertCircle className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <div className="space-y-2">
                      <p className="text-sm text-blue-900">
                        <strong>
                          Enable Apple Pay & Google Pay
                        </strong>
                      </p>
                      <p className="text-xs text-blue-800">
                        To allow customers to pay with Apple Pay
                        and Google Pay, enable these payment
                        methods in your Stripe Dashboard:
                      </p>
                      <ol className="text-xs text-blue-800 list-decimal list-inside space-y-1 ml-2">
                        <li>
                          Go to{" "}
                          <a
                            href="https://dashboard.stripe.com/settings/payment_methods"
                            target="_blank"
                            rel="noopener noreferrer"
                            className="underline font-medium"
                          >
                            Stripe Dashboard  Settings 
                            Payment methods
                          </a>
                        </li>
                        <li>
                          Enable "Apple Pay" and "Google Pay"
                        </li>
                        <li>
                          For Apple Pay: Add and verify your
                          domain
                        </li>
                        <li>
                          Wallet buttons will automatically
                          appear for compatible devices
                        </li>
                      </ol>
                    </div>
                  </div>
                </div>
              </div>
            </Card>

            {/* Attraction Ticket Prices */}
            <Card className="border-border p-8">
              <div className="mb-6">
                <h2 className="mb-2 text-foreground">
                  Attraction Ticket Prices
                </h2>
                <div className="h-1 w-16 rounded-full bg-accent" />
              </div>

              <div className="space-y-4">
                {Object.entries(pricing.attractions).map(
                  ([id, attraction]) => (
                    <div
                      key={id}
                      className="flex items-center gap-4 rounded-lg border border-border bg-white p-4"
                    >
                      <div className="flex-1">
                        <p className="text-foreground">
                          {attraction.name}
                        </p>
                      </div>
                      <div className="w-32">
                        <Input
                          type="number"
                          min="0"
                          step="0.01"
                          value={attraction.price}
                          onChange={(e) =>
                            updateAttractionPrice(
                              id,
                              parseFloat(e.target.value) || 0,
                            )
                          }
                          className="border-border"
                        />
                      </div>
                    </div>
                  ),
                )}
              </div>

              <div className="mt-6">
                <Button
                  onClick={saveSettings}
                  className="bg-primary hover:bg-primary/90"
                >
                  <Save className="mr-2 h-4 w-4" />
                  Save Attraction Prices
                </Button>
              </div>
            </Card>

            {/* Availability Management */}
            <Card className="border-border p-8">
              <div className="mb-6">
                <h2 className="mb-2 text-foreground">
                  Availability Management
                </h2>
                <div className="h-1 w-16 rounded-full bg-accent" />
              </div>

              <div className="space-y-6">
                <div>
                  <Label>Select Date</Label>
                  <Popover
                    open={calendarOpen}
                    onOpenChange={setCalendarOpen}
                  >
                    <PopoverTrigger asChild>
                      <Button
                        variant="outline"
                        className="mt-2 w-full justify-start border-border text-left"
                      >
                        <CalendarIcon className="mr-2 h-4 w-4" />
                        {new Date(
                          selectedDate,
                        ).toLocaleDateString("en-US", {
                          weekday: "long",
                          year: "numeric",
                          month: "long",
                          day: "numeric",
                        })}
                      </Button>
                    </PopoverTrigger>
                    <PopoverContent className="w-auto p-0">
                      <Calendar
                        mode="single"
                        selected={new Date(selectedDate)}
                        onSelect={(date) => {
                          if (date) {
                            setSelectedDate(
                              date.toISOString().split("T")[0],
                            );
                            setCalendarOpen(false);
                          }
                        }}
                        disabled={(date) =>
                          date <
                          new Date(
                            new Date().setHours(0, 0, 0, 0),
                          )
                        }
                        initialFocus
                      />
                    </PopoverContent>
                  </Popover>
                </div>

                <div className="rounded-lg border border-border bg-white p-6">
                  <div className="mb-4 flex items-center justify-between">
                    <h3 className="text-foreground">
                      Time Slots for{" "}
                      {new Date(
                        selectedDate,
                      ).toLocaleDateString("en-US", {
                        month: "short",
                        day: "numeric",
                        year: "numeric",
                      })}
                    </h3>
                    <div className="flex gap-2">
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() =>
                          setAllSlotsForDate(selectedDate, 50)
                        }
                      >
                        Set All to 50
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() =>
                          setAllSlotsForDate(selectedDate, 0)
                        }
                      >
                        Set All to 0
                      </Button>
                    </div>
                  </div>

                  <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                    {TIME_SLOTS.map((slot) => (
                      <div
                        key={slot}
                        className="rounded-lg border border-border p-4"
                      >
                        <Label
                          htmlFor={`slot-${slot}`}
                          className="text-foreground"
                        >
                          {slot}
                        </Label>
                        <Input
                          id={`slot-${slot}`}
                          type="number"
                          min="0"
                          max="50"
                          value={
                            availability[selectedDate]?.[
                              slot
                            ] ?? 50
                          }
                          onChange={(e) =>
                            updateAvailability(
                              selectedDate,
                              slot,
                              parseInt(e.target.value) || 0,
                            )
                          }
                          className="mt-2 border-border"
                        />
                      </div>
                    ))}
                  </div>

                  <div className="mt-6">
                    <Button
                      onClick={saveSettings}
                      className="bg-primary hover:bg-primary/90"
                    >
                      <Save className="mr-2 h-4 w-4" />
                      Save Availability
                    </Button>
                  </div>
                </div>
              </div>
            </Card>
          </TabsContent>

          {/* ====== DRIVERS TAB ====== */}
          <TabsContent
            value="drivers"
            className="space-y-4 sm:space-y-6"
          >
            <DriverManagement />
          </TabsContent>

          {/* ====== IMAGES TAB ====== */}
          <TabsContent value="images" className="space-y-6">
            <ImageManager />
          </TabsContent>

          {/* ====== CONTENT TAB ====== */}
          <TabsContent value="content" className="space-y-6">
            <ContentEditor />
          </TabsContent>

          {/* ====== BLOG TAB ====== */}
          <TabsContent value="blog" className="space-y-6">
            <BlogEditor />
          </TabsContent>

          {/* ====== SEO TAB ====== */}
          <TabsContent value="seo" className="space-y-6">
            <SEOTools />
          </TabsContent>

          {/* ====== TAGS TAB ====== */}
          <TabsContent value="tags" className="space-y-6">
            <TagManagement />
          </TabsContent>

          {/* ====== CLEANUP TAB ====== */}
          <TabsContent value="cleanup" className="space-y-6">
            <BookingDiagnostics />
            <DatabaseCleanup adminPassword="Sintra2025" />
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

export default AdminPage;


--- START OF FILE AdminTabsMobile.tsx ---

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from './ui/tabs';
import { 
  BarChart3, 
  MessageCircle, 
  Package, 
  UserCog, 
  DollarSign, 
  Users, 
  Settings 
} from 'lucide-react';

interface AdminTabsMobileProps {
  children: React.ReactNode;
  conversations: any[];
}

export function AdminTabsMobile({ children, conversations }: AdminTabsMobileProps) {
  const [activeTab, setActiveTab] = useState("metrics");

  const tabs = [
    { value: "metrics", icon: BarChart3, label: "Analytics" },
    { value: "messages", icon: MessageCircle, label: "Messages", unread: conversations.filter(c => c.unreadByAdmin > 0).length },
    { value: "bookings", icon: Package, label: "Bookings" },
    { value: "drivers", icon: UserCog, label: "Drivers" },
    { value: "pricing", icon: DollarSign, label: "Pricing" },
    { value: "availability", icon: Users, label: "Availability" },
    { value: "settings", icon: Settings, label: "Settings" },
    { value: "content", icon: Settings, label: "Content" },
    { value: "blog", icon: Package, label: "Blog" },
    { value: "seo", icon: Settings, label: "SEO" },
  ];

  return (
    <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
      <div className="overflow-x-auto mb-8 -mx-4 px-4 sm:mx-0 sm:px-0">
        <TabsList className="inline-flex w-auto min-w-full sm:grid sm:w-full sm:grid-cols-10">
          {tabs.map(({ value, icon: Icon, label, unread }) => (
            <TabsTrigger key={value} value={value} className="flex items-center gap-2 relative">
              <Icon className="h-4 w-4 flex-shrink-0" />
              <span className={activeTab === value ? "" : "hidden sm:inline"}>{label}</span>
              {unread && unread > 0 && (
                <span className="ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs text-white">
                  {unread}
                </span>
              )}
            </TabsTrigger>
          ))}
        </TabsList>
      </div>
      {children}
    </Tabs>
  );
}


--- START OF FILE AnalyticsPage.tsx ---

import { useState, useEffect, useMemo } from "react";
import { ArrowLeft, TrendingUp, TrendingDown, DollarSign, Users, Calendar, Package, CheckCircle2, Clock, Download, Filter, BarChart3, LineChart as LineChartIcon, PieChart as PieChartIcon, RefreshCw } from "lucide-react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Label } from "./ui/label";
import { Select } from "./ui/select";
import { projectId, publicAnonKey } from '../utils/supabase/info';
import { toast } from "sonner@2.0.3";
import { safeJsonFetch } from '../lib/apiErrorHandler';
import {
  LineChart,
  Line,
  BarChart,
  Bar,
  PieChart as RechartsPie,
  Pie,
  Cell,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Area,
  AreaChart,
} from "recharts";

interface AnalyticsPageProps {
  onNavigate: (page: string) => void;
}

type TimeFrame = "7days" | "30days" | "3months" | "6months" | "1year" | "all" | "custom";

const CHART_COLORS = ["#0A4D5C", "#D97843", "#636e72", "#2ecc71", "#f39c12", "#e74c3c", "#9b59b6", "#3498db"];

export function AnalyticsPage({ onNavigate }: AnalyticsPageProps) {
  // Block search engines from indexing this page
  useEffect(() => {
    const metaRobots = document.querySelector('meta[name="robots"]');
    if (metaRobots) {
      metaRobots.setAttribute('content', 'noindex, nofollow');
    } else {
      const meta = document.createElement('meta');
      meta.name = 'robots';
      meta.content = 'noindex, nofollow';
      document.head.appendChild(meta);
    }
    document.title = 'Analytics - Access Restricted';
  }, []);

  const [bookings, setBookings] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [timeFrame, setTimeFrame] = useState<TimeFrame>("30days");
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");

  useEffect(() => {
    loadBookings();
  }, []);

  const loadBookings = async () => {
    setLoading(true);
    
    const result = await safeJsonFetch<any>(
      `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
      {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${publicAnonKey}`,
          'Content-Type': 'application/json',
        },
      }
    );
    
    if (result?.success && result.bookings) {
      const validBookings = result.bookings.filter(
        (booking: any) => booking && booking.id && booking.selectedDate
      );
      
      // Load check-in data for each booking
      const bookingsWithCheckIns = await Promise.all(
        validBookings.map(async (booking: any) => {
          const checkIns = await loadCheckInsForBooking(booking.id, booking.passengers?.length || 0);
          return { ...booking, checkIns };
        })
      );
      
      setBookings(bookingsWithCheckIns);
    } else if (!result) {
      // Only show error if we're in development or this is the first load
      if (window.location.hostname === 'localhost' && bookings.length === 0) {
        toast.error("Server unavailable. Analytics will be empty until server is deployed.");
      }
    }
    
    setLoading(false);
  };

  const loadCheckInsForBooking = async (bookingId: string, passengerCount: number) => {
    try {
      const checkIns = [];
      for (let i = 0; i < passengerCount; i++) {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/checkin-status/${bookingId}_${i}`,
          {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${publicAnonKey}`,
              'Content-Type': 'application/json',
            },
          }
        );
        const result = await response.json();
        checkIns.push(result.checkIns || []);
      }
      return checkIns;
    } catch (error) {
      console.error(`Error loading check-ins for ${bookingId}:`, error);
      return [];
    }
  };

  // Filter bookings by time frame
  const filteredBookings = useMemo(() => {
    if (bookings.length === 0) return [];

    const now = new Date();
    let startFilterDate: Date;

    switch (timeFrame) {
      case "7days":
        startFilterDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        break;
      case "30days":
        startFilterDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        break;
      case "3months":
        startFilterDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
        break;
      case "6months":
        startFilterDate = new Date(now.getTime() - 180 * 24 * 60 * 60 * 1000);
        break;
      case "1year":
        startFilterDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
        break;
      case "custom":
        if (!startDate || !endDate) return bookings;
        return bookings.filter(b => {
          const bookingDate = new Date(b.selectedDate);
          return bookingDate >= new Date(startDate) && bookingDate <= new Date(endDate);
        });
      case "all":
      default:
        return bookings;
    }

    return bookings.filter(b => {
      const bookingDate = new Date(b.selectedDate);
      return bookingDate >= startFilterDate;
    });
  }, [bookings, timeFrame, startDate, endDate]);

  // Calculate comprehensive analytics
  const analytics = useMemo(() => {
    if (filteredBookings.length === 0) {
      return {
        totalRevenue: 0,
        totalBookings: 0,
        totalPassengers: 0,
        avgBookingValue: 0,
        checkInRate: 0,
        revenueByDay: [],
        revenueByMonth: [],
        bookingsByDay: [],
        bookingsByTicketType: [],
        bookingsByTimeSlot: [],
        attractionSales: [],
        revenueGrowth: 0,
        bookingGrowth: 0,
        topDays: [],
        passengerTypeDistribution: [],
        hourlyDistribution: [],
        weekdayDistribution: [],
        guidedVsStandard: [],
      };
    }

    const totalRevenue = filteredBookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
    const totalBookings = filteredBookings.length;
    const totalPassengers = filteredBookings.reduce((sum, b) => sum + (b.passengers?.length || 0), 0);
    const avgBookingValue = totalBookings > 0 ? totalRevenue / totalBookings : 0;

    // Check-in rate
    const totalCheckedIn = filteredBookings.reduce((sum, b) => {
      return sum + (b.checkIns || []).filter((ci: any[]) => ci && ci.length > 0).length;
    }, 0);
    const checkInRate = totalPassengers > 0 ? (totalCheckedIn / totalPassengers) * 100 : 0;

    // Revenue by day
    const revenueByDayMap: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const date = new Date(b.selectedDate).toISOString().split('T')[0];
      revenueByDayMap[date] = (revenueByDayMap[date] || 0) + (b.totalPrice || 0);
    });
    const revenueByDay = Object.entries(revenueByDayMap)
      .map(([date, revenue]) => ({ date, revenue }))
      .sort((a, b) => a.date.localeCompare(b.date));

    // Revenue by month
    const revenueByMonthMap: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const date = new Date(b.selectedDate);
      const month = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
      revenueByMonthMap[month] = (revenueByMonthMap[month] || 0) + (b.totalPrice || 0);
    });
    const revenueByMonth = Object.entries(revenueByMonthMap)
      .map(([month, revenue]) => ({ month, revenue }))
      .sort((a, b) => a.month.localeCompare(b.month));

    // Bookings by day
    const bookingsByDayMap: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const date = new Date(b.selectedDate).toISOString().split('T')[0];
      bookingsByDayMap[date] = (bookingsByDayMap[date] || 0) + 1;
    });
    const bookingsByDay = Object.entries(bookingsByDayMap)
      .map(([date, count]) => ({ date, count }))
      .sort((a, b) => a.date.localeCompare(b.date));

    // Bookings by ticket type
    const ticketTypeCounts: { [key: string]: { count: number; revenue: number } } = {};
    filteredBookings.forEach(b => {
      b.passengers?.forEach((p: any) => {
        const type = p.type || 'Unknown';
        if (!ticketTypeCounts[type]) {
          ticketTypeCounts[type] = { count: 0, revenue: 0 };
        }
        ticketTypeCounts[type].count++;
        ticketTypeCounts[type].revenue += (b.totalPrice || 0) / (b.passengers?.length || 1);
      });
    });
    const bookingsByTicketType = Object.entries(ticketTypeCounts).map(([type, data]) => ({
      type,
      count: data.count,
      revenue: data.revenue,
    }));

    // Bookings by time slot
    const timeSlotCounts: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const slot = b.timeSlot || 'Unknown';
      timeSlotCounts[slot] = (timeSlotCounts[slot] || 0) + 1;
    });
    const bookingsByTimeSlot = Object.entries(timeSlotCounts)
      .map(([slot, count]) => ({ slot, count }))
      .sort((a, b) => a.slot.localeCompare(b.slot));

    // Attraction sales
    const attractionCounts: { [key: string]: { count: number; revenue: number } } = {};
    filteredBookings.forEach(b => {
      b.attractions?.forEach((a: any) => {
        if (!attractionCounts[a.id]) {
          attractionCounts[a.id] = { count: 0, revenue: 0 };
        }
        attractionCounts[a.id].count++;
        attractionCounts[a.id].revenue += a.price || 0;
      });
    });
    const attractionSales = Object.entries(attractionCounts).map(([id, data]) => ({
      name: id.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
      count: data.count,
      revenue: data.revenue,
    }));

    // Growth calculations (compare first half vs second half)
    const midPoint = Math.floor(filteredBookings.length / 2);
    const firstHalf = filteredBookings.slice(0, midPoint);
    const secondHalf = filteredBookings.slice(midPoint);
    
    const firstHalfRevenue = firstHalf.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
    const secondHalfRevenue = secondHalf.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
    const revenueGrowth = firstHalfRevenue > 0 
      ? ((secondHalfRevenue - firstHalfRevenue) / firstHalfRevenue) * 100 
      : 0;

    const bookingGrowth = firstHalf.length > 0
      ? ((secondHalf.length - firstHalf.length) / firstHalf.length) * 100
      : 0;

    // Top performing days
    const topDays = Object.entries(revenueByDayMap)
      .map(([date, revenue]) => ({ date, revenue }))
      .sort((a, b) => b.revenue - a.revenue)
      .slice(0, 5);

    // Passenger type distribution
    const passengerTypeDist: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      b.passengers?.forEach((p: any) => {
        const type = p.type || 'Unknown';
        passengerTypeDist[type] = (passengerTypeDist[type] || 0) + 1;
      });
    });
    const passengerTypeDistribution = Object.entries(passengerTypeDist).map(([type, count]) => ({
      type,
      count,
      percentage: totalPassengers > 0 ? (count / totalPassengers) * 100 : 0,
    }));

    // Hourly distribution
    const hourlyDist: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const hour = b.timeSlot?.split(':')[0] || 'Unknown';
      hourlyDist[hour] = (hourlyDist[hour] || 0) + 1;
    });
    const hourlyDistribution = Object.entries(hourlyDist)
      .map(([hour, count]) => ({ hour: `${hour}:00`, count }))
      .sort((a, b) => a.hour.localeCompare(b.hour));

    // Weekday distribution
    const weekdayDist: { [key: string]: number } = {};
    filteredBookings.forEach(b => {
      const date = new Date(b.selectedDate);
      const weekday = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()];
      weekdayDist[weekday] = (weekdayDist[weekday] || 0) + 1;
    });
    const weekdayDistribution = Object.entries(weekdayDist).map(([day, count]) => ({ day, count }));

    // Guided vs Standard
    const guidedCount = filteredBookings.filter(b => b.guidedTour).length;
    const standardCount = filteredBookings.length - guidedCount;
    const guidedVsStandard = [
      { type: 'Guided Tour', count: guidedCount },
      { type: 'Standard Pass', count: standardCount },
    ];

    return {
      totalRevenue,
      totalBookings,
      totalPassengers,
      avgBookingValue,
      checkInRate,
      revenueByDay,
      revenueByMonth,
      bookingsByDay,
      bookingsByTicketType,
      bookingsByTimeSlot,
      attractionSales,
      revenueGrowth,
      bookingGrowth,
      topDays,
      passengerTypeDistribution,
      hourlyDistribution,
      weekdayDistribution,
      guidedVsStandard,
    };
  }, [filteredBookings]);

  const exportData = () => {
    const data = {
      timeFrame,
      generatedAt: new Date().toISOString(),
      summary: {
        totalRevenue: analytics.totalRevenue,
        totalBookings: analytics.totalBookings,
        totalPassengers: analytics.totalPassengers,
        avgBookingValue: analytics.avgBookingValue,
        checkInRate: analytics.checkInRate,
        revenueGrowth: analytics.revenueGrowth,
        bookingGrowth: analytics.bookingGrowth,
      },
      detailedData: {
        revenueByDay: analytics.revenueByDay,
        bookingsByTicketType: analytics.bookingsByTicketType,
        attractionSales: analytics.attractionSales,
        topDays: analytics.topDays,
      },
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `analytics-${timeFrame}-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    toast.success("Analytics data exported successfully!");
  };

  if (loading) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-secondary/30">
        <div className="text-center">
          <div className="h-12 w-12 mx-auto animate-spin rounded-full border-4 border-primary border-t-transparent mb-4" />
          <p className="text-muted-foreground">Loading analytics...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-secondary/30 py-8">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-8">
          <Button
            variant="outline"
            onClick={() => onNavigate("admin")}
            className="mb-4"
          >
            <ArrowLeft className="mr-2 h-4 w-4" />
            Back to Admin
          </Button>

          <div className="flex items-center justify-between">
            <div>
              <div className="mb-3 flex items-center gap-3">
                <div className="flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10">
                  <BarChart3 className="h-6 w-6 text-primary" />
                </div>
                <h1 className="text-foreground">Advanced Analytics</h1>
              </div>
              <div className="h-1 w-20 rounded-full bg-accent" />
            </div>
            <div className="flex gap-2">
              <Button 
                onClick={loadBookings} 
                variant="outline" 
                className="gap-2"
                disabled={loading}
              >
                <RefreshCw className={`h-4 w-4 ${loading ? 'animate-spin' : ''}`} />
                Refresh Data
              </Button>
              <Button onClick={exportData} variant="outline" className="gap-2">
                <Download className="h-4 w-4" />
                Export Data
              </Button>
            </div>
          </div>
        </div>

        {/* Time Frame Filter */}
        <Card className="mb-6 border-border p-6">
          <div className="flex items-center gap-2 mb-4">
            <Filter className="h-5 w-5 text-primary" />
            <h3 className="text-foreground">Time Frame</h3>
          </div>
          
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
            <div>
              <Label className="text-foreground">Select Period</Label>
              <select
                value={timeFrame}
                onChange={(e) => setTimeFrame(e.target.value as TimeFrame)}
                className="mt-2 w-full rounded-md border border-border bg-input-background px-3 py-2 text-foreground"
              >
                <option value="7days">Last 7 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="3months">Last 3 Months</option>
                <option value="6months">Last 6 Months</option>
                <option value="1year">Last Year</option>
                <option value="all">All Time</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>

            {timeFrame === "custom" && (
              <>
                <div>
                  <Label className="text-foreground">Start Date</Label>
                  <input
                    type="date"
                    value={startDate}
                    onChange={(e) => setStartDate(e.target.value)}
                    className="mt-2 w-full rounded-md border border-border bg-input-background px-3 py-2 text-foreground"
                  />
                </div>
                <div>
                  <Label className="text-foreground">End Date</Label>
                  <input
                    type="date"
                    value={endDate}
                    onChange={(e) => setEndDate(e.target.value)}
                    className="mt-2 w-full rounded-md border border-border bg-input-background px-3 py-2 text-foreground"
                  />
                </div>
              </>
            )}
          </div>
        </Card>

        {/* Key Metrics */}
        <div className="mb-6 grid gap-4 md:grid-cols-2 lg:grid-cols-4">
          <Card className="border-border p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-muted-foreground">Total Revenue</p>
                <p className="mt-2 text-foreground text-3xl">{analytics.totalRevenue.toFixed(2)}</p>
                <div className="mt-2 flex items-center gap-1 text-sm">
                  {analytics.revenueGrowth >= 0 ? (
                    <TrendingUp className="h-4 w-4 text-green-600" />
                  ) : (
                    <TrendingDown className="h-4 w-4 text-red-600" />
                  )}
                  <span className={analytics.revenueGrowth >= 0 ? "text-green-600" : "text-red-600"}>
                    {Math.abs(analytics.revenueGrowth).toFixed(1)}%
                  </span>
                </div>
              </div>
              <div className="flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
                <DollarSign className="h-6 w-6 text-green-600" />
              </div>
            </div>
          </Card>

          <Card className="border-border p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-muted-foreground">Total Bookings</p>
                <p className="mt-2 text-foreground text-3xl">{analytics.totalBookings}</p>
                <div className="mt-2 flex items-center gap-1 text-sm">
                  {analytics.bookingGrowth >= 0 ? (
                    <TrendingUp className="h-4 w-4 text-green-600" />
                  ) : (
                    <TrendingDown className="h-4 w-4 text-red-600" />
                  )}
                  <span className={analytics.bookingGrowth >= 0 ? "text-green-600" : "text-red-600"}>
                    {Math.abs(analytics.bookingGrowth).toFixed(1)}%
                  </span>
                </div>
              </div>
              <div className="flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
                <Package className="h-6 w-6 text-primary" />
              </div>
            </div>
          </Card>

          <Card className="border-border p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-muted-foreground">Total Passengers</p>
                <p className="mt-2 text-foreground text-3xl">{analytics.totalPassengers}</p>
                <p className="mt-2 text-sm text-muted-foreground">
                  Avg: {(analytics.totalPassengers / (analytics.totalBookings || 1)).toFixed(1)} per booking
                </p>
              </div>
              <div className="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100">
                <Users className="h-6 w-6 text-blue-600" />
              </div>
            </div>
          </Card>

          <Card className="border-border p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-muted-foreground">Avg Booking Value</p>
                <p className="mt-2 text-foreground text-3xl">{analytics.avgBookingValue.toFixed(2)}</p>
                <p className="mt-2 text-sm text-muted-foreground">
                  Check-in rate: {analytics.checkInRate.toFixed(1)}%
                </p>
              </div>
              <div className="flex h-12 w-12 items-center justify-center rounded-full bg-accent/10">
                <CheckCircle2 className="h-6 w-6 text-accent" />
              </div>
            </div>
          </Card>
        </div>

        {/* Revenue Trends */}
        <div className="mb-6 grid gap-6 lg:grid-cols-2">
          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <LineChartIcon className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Revenue Over Time</h3>
            </div>
            <ResponsiveContainer width="100%" height={300}>
              <AreaChart data={analytics.revenueByDay}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0e9e3" />
                <XAxis dataKey="date" stroke="#6b7280" style={{ fontSize: '12px' }} />
                <YAxis stroke="#6b7280" style={{ fontSize: '12px' }} />
                <Tooltip 
                  contentStyle={{ 
                    backgroundColor: '#ffffff', 
                    border: '1px solid #f0e9e3',
                    borderRadius: '8px' 
                  }} 
                />
                <Area type="monotone" dataKey="revenue" stroke="#0A4D5C" fill="#0A4D5C" fillOpacity={0.2} />
              </AreaChart>
            </ResponsiveContainer>
          </Card>

          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <BarChart3 className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Bookings Over Time</h3>
            </div>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={analytics.bookingsByDay}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0e9e3" />
                <XAxis dataKey="date" stroke="#6b7280" style={{ fontSize: '12px' }} />
                <YAxis stroke="#6b7280" style={{ fontSize: '12px' }} />
                <Tooltip 
                  contentStyle={{ 
                    backgroundColor: '#ffffff', 
                    border: '1px solid #f0e9e3',
                    borderRadius: '8px' 
                  }} 
                />
                <Bar dataKey="count" fill="#D97843" />
              </BarChart>
            </ResponsiveContainer>
          </Card>
        </div>

        {/* Ticket Types & Time Slots */}
        <div className="mb-6 grid gap-6 lg:grid-cols-2">
          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <PieChartIcon className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Passenger Types</h3>
            </div>
            <ResponsiveContainer width="100%" height={300}>
              <RechartsPie>
                <Pie
                  data={analytics.passengerTypeDistribution}
                  dataKey="count"
                  nameKey="type"
                  cx="50%"
                  cy="50%"
                  outerRadius={100}
                  label={(entry) => `${entry.type}: ${entry.percentage.toFixed(0)}%`}
                >
                  {analytics.passengerTypeDistribution.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={CHART_COLORS[index % CHART_COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip />
              </RechartsPie>
            </ResponsiveContainer>
          </Card>

          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <Clock className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Popular Time Slots</h3>
            </div>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={analytics.bookingsByTimeSlot}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0e9e3" />
                <XAxis dataKey="slot" stroke="#6b7280" style={{ fontSize: '12px' }} />
                <YAxis stroke="#6b7280" style={{ fontSize: '12px' }} />
                <Tooltip 
                  contentStyle={{ 
                    backgroundColor: '#ffffff', 
                    border: '1px solid #f0e9e3',
                    borderRadius: '8px' 
                  }} 
                />
                <Bar dataKey="count" fill="#0A4D5C" />
              </BarChart>
            </ResponsiveContainer>
          </Card>
        </div>

        {/* Attraction Sales & Weekday Distribution */}
        <div className="mb-6 grid gap-6 lg:grid-cols-2">
          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <Package className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Attraction Ticket Sales</h3>
            </div>
            <div className="space-y-3">
              {analytics.attractionSales.length > 0 ? (
                analytics.attractionSales.map((attr, index) => (
                  <div key={index} className="flex items-center justify-between rounded-lg bg-secondary/50 p-3">
                    <div>
                      <p className="text-foreground">{attr.name}</p>
                      <p className="text-sm text-muted-foreground">{attr.count} tickets sold</p>
                    </div>
                    <p className="text-primary">{attr.revenue.toFixed(2)}</p>
                  </div>
                ))
              ) : (
                <p className="text-center text-muted-foreground py-8">No attraction tickets sold yet</p>
              )}
            </div>
          </Card>

          <Card className="border-border p-6">
            <div className="mb-4 flex items-center gap-2">
              <Calendar className="h-5 w-5 text-primary" />
              <h3 className="text-foreground">Bookings by Weekday</h3>
            </div>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={analytics.weekdayDistribution}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0e9e3" />
                <XAxis dataKey="day" stroke="#6b7280" style={{ fontSize: '12px' }} />
                <YAxis stroke="#6b7280" style={{ fontSize: '12px' }} />
                <Tooltip 
                  contentStyle={{ 
                    backgroundColor: '#ffffff', 
                    border: '1px solid #f0e9e3',
                    borderRadius: '8px' 
                  }} 
                />
                <Bar dataKey="count" fill="#D97843" />
              </BarChart>
            </ResponsiveContainer>
          </Card>
        </div>

        {/* Top Performing Days */}
        <Card className="mb-6 border-border p-6">
          <div className="mb-4 flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-primary" />
            <h3 className="text-foreground">Top 5 Revenue Days</h3>
          </div>
          <div className="space-y-3">
            {analytics.topDays.map((day, index) => (
              <div key={index} className="flex items-center justify-between rounded-lg bg-secondary/50 p-4">
                <div className="flex items-center gap-4">
                  <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10">
                    <span className="text-primary">#{index + 1}</span>
                  </div>
                  <div>
                    <p className="text-foreground">
                      {new Date(day.date).toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                      })}
                    </p>
                  </div>
                </div>
                <p className="text-primary text-xl">{day.revenue.toFixed(2)}</p>
              </div>
            ))}
          </div>
        </Card>

        {/* Guided vs Standard */}
        <Card className="border-border p-6">
          <div className="mb-4 flex items-center gap-2">
            <Users className="h-5 w-5 text-primary" />
            <h3 className="text-foreground">Guided Tour vs Standard Pass</h3>
          </div>
          <ResponsiveContainer width="100%" height={300}>
            <RechartsPie>
              <Pie
                data={analytics.guidedVsStandard}
                dataKey="count"
                nameKey="type"
                cx="50%"
                cy="50%"
                outerRadius={100}
                label
              >
                {analytics.guidedVsStandard.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={CHART_COLORS[index]} />
                ))}
              </Pie>
              <Tooltip />
              <Legend />
            </RechartsPie>
          </ResponsiveContainer>
        </Card>
      </div>
    </div>
  );
}

export default AnalyticsPage;


--- START OF FILE ArticleFAQ.tsx ---

import { useEffect } from "react";
import { ChevronDown } from "lucide-react";
import { Card } from "./ui/card";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "./ui/accordion";

export interface FAQItem {
  question: string;
  answer: string;
}

interface ArticleFAQProps {
  faqs: FAQItem[];
  articleUrl: string;
}

export function ArticleFAQ({ faqs, articleUrl }: ArticleFAQProps) {
  useEffect(() => {
    // Add FAQ schema
    const faqSchema = {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": faqs.map(faq => ({
        "@type": "Question",
        "name": faq.question,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": faq.answer
        }
      }))
    };

    // Check if FAQ schema already exists
    let faqSchemaElement = document.querySelector('script[type="application/ld+json"][data-faq="true"]');
    if (!faqSchemaElement) {
      faqSchemaElement = document.createElement("script");
      faqSchemaElement.setAttribute("type", "application/ld+json");
      faqSchemaElement.setAttribute("data-faq", "true");
      document.head.appendChild(faqSchemaElement);
    }

    faqSchemaElement.textContent = JSON.stringify(faqSchema);

    return () => {
      // Cleanup on unmount
      if (faqSchemaElement && faqSchemaElement.parentNode) {
        faqSchemaElement.parentNode.removeChild(faqSchemaElement);
      }
    };
  }, [faqs, articleUrl]);

  if (faqs.length === 0) return null;

  return (
    <Card className="p-6">
      <h2 className="mb-6 text-foreground">Frequently Asked Questions</h2>
      <Accordion type="single" collapsible className="w-full">
        {faqs.map((faq, index) => (
          <AccordionItem key={index} value={`item-${index}`}>
            <AccordionTrigger className="text-left">
              {faq.question}
            </AccordionTrigger>
            <AccordionContent className="text-muted-foreground">
              {faq.answer}
            </AccordionContent>
          </AccordionItem>
        ))}
      </Accordion>
    </Card>
  );
}


--- START OF FILE AttractionDetailPage.tsx ---

import { Clock, MapPin, ArrowLeft, Star, Check, Lightbulb, ChevronRight, Calendar, Ticket, ShoppingCart, Camera } from "lucide-react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import { useState, useEffect } from "react";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { loadComprehensiveContent, type ComprehensiveContent, DEFAULT_COMPREHENSIVE_CONTENT } from "../lib/comprehensiveContent";
import { motion } from "motion/react";

interface AttractionDetailPageProps {
  onNavigate: (page: string) => void;
  attractionId: string;
}

export function AttractionDetailPage({ onNavigate, attractionId }: AttractionDetailPageProps) {
  const [content, setContent] = useState<ComprehensiveContent>(DEFAULT_COMPREHENSIVE_CONTENT);
  const [ticketQuantity, setTicketQuantity] = useState(1);
  const [selectedOption, setSelectedOption] = useState("");

  // Fallback images for attractions without uploaded images
  const attractionFallbackImages: { [key: string]: string } = {
    "pena-palace": "https://images.unsplash.com/photo-1585208798174-6cedd86e019a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwZW5hJTIwcGFsYWNlJTIwc2ludHJhfGVufDF8fHx8MTc2MDE0MDYwMnww&ixlib=rb-4.1.0&q=80&w=1080",
    "quinta-regaleira": "https://images.unsplash.com/photo-1668377298351-3f7a745a56fe?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxxdWludGElMjBkYSUyMHJlZ2FsZWlyYSUyMHNpbnRyYXxlbnwxfHx8fDE3NjMxNjg3Njl8MA&ixlib=rb-4.1.0&q=80&w=1080",
    "moorish-castle": "https://images.unsplash.com/photo-1651520011190-6f37b5213684?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtb29yaXNoJTIwY2FzdGxlJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2ODc2OXww&ixlib=rb-4.1.0&q=80&w=1080",
    "monserrate-palace": "https://images.unsplash.com/photo-1609137144813-7d9921338f24?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtb25zZXJyYXRlJTIwcGFsYWNlJTIwc2ludHJhfGVufDF8fHx8MTc2MDE0MDYwM3ww&ixlib=rb-4.1.0&q=80&w=1080",
    "sintra-palace": "https://images.unsplash.com/photo-1668945306762-a31d14d8a940?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHNpbnRyYSUyMHBvcnR1Z2FsJTIwcGFsYWNlfGVufDF8fHx8MTc2MDE0MDIwMHww&ixlib=rb-4.1.0&q=80&w=1080",
    "convento-capuchos": "https://images.unsplash.com/photo-1672692921041-f676e2cae79a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb252ZW50byUyMGNhcHVjaG9zJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2NjU5OHww&ixlib=rb-4.1.0&q=80&w=1080",
    "cabo-da-roca": "https://images.unsplash.com/photo-1700739745973-bbd552072e98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjYWJvJTIwZGElMjByb2NhJTIwbGlnaHRob3VzZXxlbnwxfHx8fDE3NjMxNjY2MDN8MA&ixlib=rb-4.1.0&q=80&w=1080",
    "villa-sassetti": "https://images.unsplash.com/photo-1670060434149-220a5fce89da?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx2aWxsYSUyMHNhc3NldHRpJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2NjYwNnww&ixlib=rb-4.1.0&q=80&w=1080",
  };

  useEffect(() => {
    setContent(loadComprehensiveContent());
  }, []);

  const attraction = content.attractions.attractionDetails[attractionId];

  if (!attraction) {
    return (
      <div className="flex min-h-screen items-center justify-center">
        <div className="text-center">
          <h2 className="mb-4 text-foreground">Attraction not found</h2>
          <Button onClick={() => onNavigate("attractions")}>
            Back to Attractions
          </Button>
        </div>
      </div>
    );
  }

  useEffect(() => {
    if (attraction.parkOnlyPrice && !selectedOption) {
      setSelectedOption("full");
    }
  }, [attraction, selectedOption]);

  const getCurrentPrice = () => {
    if (attraction.parkOnlyPrice) {
      return selectedOption === "parkOnly" ? attraction.parkOnlyPrice : attraction.price;
    }
    return attraction.price;
  };

  const handlePurchase = () => {
    alert(`Booking ${ticketQuantity} ticket(s) for ${attraction.name}. Total: ${getCurrentPrice() * ticketQuantity}`);
  };

  return (
    <div className="flex-1">
      {/* Back Button */}
      <div className="border-b border-border bg-white">
        <div className="mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8">
          <Button
            variant="ghost"
            onClick={() => onNavigate("attractions")}
            className="gap-2"
          >
            <ArrowLeft className="h-4 w-4" />
            Back to All Attractions
          </Button>
        </div>
      </div>

      {/* Hero Section */}
      <section className="relative h-[60vh] min-h-[500px] overflow-hidden">
        <ImageWithFallback
          src={attraction.heroImage || attractionFallbackImages[attractionId] || "https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=1920&h=1080&fit=crop"}
          alt={attraction.name}
          className="h-full w-full object-cover"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-black/20" />

        <div className="absolute inset-0 flex items-end">
          <div className="w-full pb-12 sm:pb-16">
            <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
              <motion.div
                className="mb-4 flex flex-wrap gap-3"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2 }}
              >
                <div className="flex items-center gap-2 rounded-full bg-white/20 px-4 py-2 backdrop-blur-sm">
                  <Ticket className="h-4 w-4 text-white" />
                  <span className="text-white">{getCurrentPrice()}</span>
                </div>
                <div className="flex items-center gap-2 rounded-full bg-white/20 px-4 py-2 backdrop-blur-sm">
                  <Clock className="h-4 w-4 text-white" />
                  <span className="text-white">{attraction.duration}</span>
                </div>
                <div className="flex items-center gap-2 rounded-full bg-white/20 px-4 py-2 backdrop-blur-sm">
                  <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                  <span className="text-white">Must-See!</span>
                </div>
              </motion.div>

              <motion.h1
                className="mb-4 text-white"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
              >
                {attraction.name}
              </motion.h1>

              <motion.p
                className="max-w-3xl text-xl text-white/90"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4 }}
              >
                {attraction.shortDescription}
              </motion.p>
            </div>
          </div>
        </div>
      </section>

      {/* Main Content */}
      <section className="py-16 sm:py-20">
        <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
          <div className="grid gap-8 lg:grid-cols-3">
            {/* Left Column - Information */}
            <div className="space-y-8 lg:col-span-2">
              {/* Description */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
              >
                <Badge className="mb-4">About This Gem</Badge>
                <h2 className="mb-4 text-foreground">What Makes It Special</h2>
                <p className="text-lg text-muted-foreground">
                  {attraction.longDescription}
                </p>
              </motion.div>

              {/* Opening Hours & Ticket Info - Mobile Only */}
              <div className="space-y-6 lg:hidden">
                {/* Opening Hours Card - Mobile */}
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  viewport={{ once: true }}
                  transition={{ delay: 0.1 }}
                >
                  <Card className="p-6 shadow-xl">
                    <div className="mb-3 flex items-center gap-2">
                      <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10">
                        <Clock className="h-5 w-5 text-primary" />
                      </div>
                      <h4 className="text-foreground">Opening Hours</h4>
                    </div>
                    <p className="text-muted-foreground">{attraction.hours}</p>
                  </Card>
                </motion.div>

                {/* Ticket Information Card - Mobile */}
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  viewport={{ once: true }}
                  transition={{ delay: 0.15 }}
                >
                  <Card className="p-6 shadow-xl">
                    <div className="mb-6 flex items-center gap-3">
                      <div className="flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                        <Ticket className="h-6 w-6 text-primary" />
                      </div>
                      <h3 className="text-foreground">Ticket Information</h3>
                    </div>

                    <div className="mb-6 rounded-xl bg-secondary/30 p-6 text-center">
                      <div className="mb-2 text-sm text-muted-foreground">Entrance Ticket</div>
                      <div className="mb-4 text-3xl text-foreground">
                        {attraction.parkOnlyPrice ? attraction.parkOnlyPrice : attraction.price}
                      </div>
                      <Badge variant="outline" className="text-muted-foreground">
                        Online Booking Coming Soon
                      </Badge>
                    </div>

                    <div className="mb-6 space-y-2 rounded-xl bg-primary/5 p-4">
                      <p className="text-sm text-muted-foreground">
                        Attraction tickets are not yet available for online purchase. You can buy tickets at the entrance.
                      </p>
                    </div>

                    <div className="rounded-xl border border-accent/30 bg-accent/5 p-4">
                      <h4 className="mb-2 flex items-center gap-2 text-foreground">
                         Get There Easily!
                      </h4>
                      <p className="mb-3 text-sm text-muted-foreground">
                        Book a Hop On Sintra day pass for unlimited transport between all attractions with professional driver-guides!
                      </p>
                      <Button
                        size="lg"
                        className="w-full"
                        onClick={() => onNavigate("buy-ticket")}
                      >
                        Get Day Pass
                        <ChevronRight className="ml-2 h-4 w-4" />
                      </Button>
                    </div>
                  </Card>
                </motion.div>
              </div>

              {/* Highlights */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ delay: 0.1 }}
              >
                <Badge className="mb-4">Highlights</Badge>
                <h3 className="mb-4 text-foreground">Don't Miss These!</h3>
                <div className="grid gap-3">
                  {attraction.highlights.map((highlight, index) => (
                    <motion.div
                      key={index}
                      className="flex items-start gap-3 rounded-xl border bg-white p-4 transition-all hover:shadow-lg"
                      initial={{ opacity: 0, x: -20 }}
                      whileInView={{ opacity: 1, x: 0 }}
                      viewport={{ once: true }}
                      transition={{ delay: index * 0.05 }}
                    >
                      <div className="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary">
                        <Check className="h-4 w-4 text-white" />
                      </div>
                      <span className="text-foreground">{highlight}</span>
                    </motion.div>
                  ))}
                </div>
              </motion.div>

              {/* Visitor Tips */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ delay: 0.2 }}
              >
                <Badge className="mb-4">Pro Tips</Badge>
                <h3 className="mb-4 text-foreground">Insider Advice</h3>
                <div className="grid gap-3">
                  {attraction.tips.map((tip, index) => (
                    <motion.div
                      key={index}
                      className="rounded-xl border bg-secondary/30 p-4 transition-all hover:shadow-lg"
                      initial={{ opacity: 0, x: -20 }}
                      whileInView={{ opacity: 1, x: 0 }}
                      viewport={{ once: true }}
                      transition={{ delay: index * 0.05 }}
                    >
                      <div className="flex items-start gap-3">
                        <Lightbulb className="mt-0.5 h-5 w-5 flex-shrink-0 text-accent" />
                        <p className="text-foreground">{tip}</p>
                      </div>
                    </motion.div>
                  ))}
                </div>
              </motion.div>

              {/* Time Needed - Mobile Only */}
              <motion.div
                className="lg:hidden"
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ delay: 0.3 }}
              >
                <Card className="p-6 transition-all hover:shadow-lg">
                  <div className="mb-3 flex items-center gap-2">
                    <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-accent/10">
                      <Camera className="h-5 w-5 text-accent" />
                    </div>
                    <h4 className="text-foreground">Time Needed</h4>
                  </div>
                  <p className="text-muted-foreground">{attraction.duration}</p>
                </Card>
              </motion.div>
            </div>

            {/* Right Column - Ticket Info Card (Desktop Only) */}
            <motion.div
              className="hidden lg:col-span-1 lg:block"
              initial={{ opacity: 0, x: 20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
            >
              <div className="sticky top-24 space-y-6">
                {/* Opening Hours Card */}
                <Card className="p-6 shadow-xl">
                  <div className="mb-3 flex items-center gap-2">
                    <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10">
                      <Clock className="h-5 w-5 text-primary" />
                    </div>
                    <h4 className="text-foreground">Opening Hours</h4>
                  </div>
                  <p className="text-muted-foreground">{attraction.hours}</p>
                </Card>

                {/* Ticket Information Card */}
                <Card className="p-6 shadow-xl">
                  <div className="mb-6 flex items-center gap-3">
                    <div className="flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                      <Ticket className="h-6 w-6 text-primary" />
                    </div>
                    <h3 className="text-foreground">Ticket Information</h3>
                  </div>

                  <div className="mb-6 rounded-xl bg-secondary/30 p-6 text-center">
                    <div className="mb-2 text-sm text-muted-foreground">Entrance Ticket</div>
                    <div className="mb-4 text-3xl text-foreground">
                      {attraction.parkOnlyPrice ? attraction.parkOnlyPrice : attraction.price}
                    </div>
                    <Badge variant="outline" className="text-muted-foreground">
                      Online Booking Coming Soon
                    </Badge>
                  </div>

                  <div className="mb-6 space-y-2 rounded-xl bg-primary/5 p-4">
                    <p className="text-sm text-muted-foreground">
                      Attraction tickets are not yet available for online purchase. You can buy tickets at the entrance.
                    </p>
                  </div>

                  <div className="rounded-xl border border-accent/30 bg-accent/5 p-4">
                    <h4 className="mb-2 flex items-center gap-2 text-foreground">
                       Get There Easily!
                    </h4>
                    <p className="mb-3 text-sm text-muted-foreground">
                      Book a Hop On Sintra day pass for unlimited transport between all attractions with professional driver-guides!
                    </p>
                    <Button
                      size="lg"
                      className="w-full"
                      onClick={() => onNavigate("buy-ticket")}
                    >
                      Get Day Pass
                      <ChevronRight className="ml-2 h-4 w-4" />
                    </Button>
                  </div>
                </Card>
              </div>
            </motion.div>
          </div>
        </div>
      </section>
    </div>
  );
}


--- START OF FILE AttractionsPage.tsx ---

import { useState, useEffect, useRef } from "react";
import {
  Star,
  Clock,
  MapPin,
  Search,
  BookOpen,
  TrendingUp,
  ChevronRight,
  ArrowRight,
} from "lucide-react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { Input } from "./ui/input";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import {
  loadComprehensiveContent,
  type ComprehensiveContent,
  DEFAULT_COMPREHENSIVE_CONTENT,
} from "../lib/comprehensiveContent";
import { getUITranslation } from "../lib/translations";
import {
  searchArticles,
  type BlogArticle,
} from "../lib/blogManager";
import { motion } from "motion/react";

interface AttractionsPageProps {
  onNavigate: (page: string, data?: any) => void;
  language?: string;
}

export function AttractionsPage({
  onNavigate,
  language = "en",
}: AttractionsPageProps) {
  const [content, setContent] = useState<ComprehensiveContent>(
    DEFAULT_COMPREHENSIVE_CONTENT,
  );
  const [searchQuery, setSearchQuery] = useState("");
  const [searchResults, setSearchResults] = useState<
    BlogArticle[]
  >([]);
  const [showResults, setShowResults] = useState(false);
  const searchRef = useRef<HTMLDivElement>(null);
  const t = getUITranslation(language);

  useEffect(() => {
    setContent(loadComprehensiveContent());
  }, [language]);

  useEffect(() => {
    if (searchQuery.trim().length > 1) {
      const results = searchArticles(searchQuery);
      setSearchResults(results.slice(0, 5));
      setShowResults(true);
    } else {
      setSearchResults([]);
      setShowResults(false);
    }
  }, [searchQuery]);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        searchRef.current &&
        !searchRef.current.contains(event.target as Node)
      ) {
        setShowResults(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () =>
      document.removeEventListener(
        "mousedown",
        handleClickOutside,
      );
  }, []);

  const attractions = Object.entries(
    content.attractions.attractionDetails,
  ).map(([id, attr]) => ({
    id,
    name: attr.name,
    description: attr.shortDescription,
    duration: attr.duration,
    price: attr.price,
    parkOnlyPrice: attr.parkOnlyPrice,
    cardImage: attr.cardImage,
    heroImage: attr.heroImage,
  }));

  // Fallback images for attractions without uploaded images
  const attractionFallbackImages: { [key: string]: string } = {
    "pena-palace":
      "https://images.unsplash.com/photo-1585208798174-6cedd86e019a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwZW5hJTIwcGFsYWNlJTIwc2ludHJhfGVufDF8fHx8MTc2MDE0MDYwMnww&ixlib=rb-4.1.0&q=80&w=1080",
    "quinta-regaleira":
      "https://images.unsplash.com/photo-1668377298351-3f7a745a56fe?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxxdWludGElMjBkYSUyMHJlZ2FsZWlyYSUyMHNpbnRyYXxlbnwxfHx8fDE3NjMxNjg3Njl8MA&ixlib=rb-4.1.0&q=80&w=1080",
    "moorish-castle":
      "https://images.unsplash.com/photo-1651520011190-6f37b5213684?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtb29yaXNoJTIwY2FzdGxlJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2ODc2OXww&ixlib=rb-4.1.0&q=80&w=1080",
    "monserrate-palace":
      "https://images.unsplash.com/photo-1609137144813-7d9921338f24?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtb25zZXJyYXRlJTIwcGFsYWNlJTIwc2ludHJhfGVufDF8fHx8MTc2MDE0MDYwM3ww&ixlib=rb-4.1.0&q=80&w=1080",
    "sintra-palace":
      "https://images.unsplash.com/photo-1668945306762-a31d14d8a940?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzaW50cmElMjBwb3J0dWdhbCUyMHBhbGFjZXxlbnwxfHx8fDE3NjAxNDAyMDB8MA&ixlib=rb-4.1.0&q=80&w=1080",
    "convento-capuchos":
      "https://images.unsplash.com/photo-1672692921041-f676e2cae79a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb252ZW50byUyMGNhcHVjaG9zJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2NjU5OHww&ixlib=rb-4.1.0&q=80&w=1080",
    "cabo-da-roca":
      "https://images.unsplash.com/photo-1700739745973-bbd552072e98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjYWJvJTIwZGElMjByb2NhJTIwbGlnaHRob3VzZXxlbnwxfHx8fDE3NjMxNjY2MDN8MA&ixlib=rb-4.1.0&q=80&w=1080",
    "villa-sassetti":
      "https://images.unsplash.com/photo-1670060434149-220a5fce89da?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx2aWxsYSUyMHNhc3NldHRpJTIwc2ludHJhfGVufDF8fHx8MTc2MzE2NjYwNnww&ixlib=rb-4.1.0&q=80&w=1080",
  };

  return (
    <div className="flex-1">
      {/* Header Section */}
      <section className="border-b border-border bg-white py-12">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="mb-6 text-center">
            <h1 className="mb-3 text-foreground">
              {t.attractionsPageTitle}
            </h1>
            <p className="mx-auto max-w-2xl text-lg text-muted-foreground">
              {t.attractionsPageSubtitle}
            </p>
          </div>

          {/* Search Bar with Live Recommendations */}
          <div
            ref={searchRef}
            className="relative mx-auto max-w-2xl"
          >
            <div className="relative">
              <Search className="absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground" />
              <Input
                type="text"
                placeholder={t.searchTravelGuidesPlaceholder}
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onFocus={() =>
                  searchQuery.trim().length > 1 &&
                  setShowResults(true)
                }
                className="h-12 rounded-xl bg-secondary/30 pl-12 pr-4"
              />
            </div>

            {/* Live Search Results Dropdown */}
            {showResults && searchResults.length > 0 && (
              <motion.div
                className="absolute top-full z-50 mt-2 w-full rounded-xl border border-border bg-white shadow-xl"
                initial={{ opacity: 0, y: -10 }}
                animate={{ opacity: 1, y: 0 }}
              >
                <div className="p-2">
                  <div className="mb-2 flex items-center gap-2 px-3 py-2 text-sm text-muted-foreground">
                    <TrendingUp className="h-4 w-4" />
                    {t.travelGuideRecommendations}
                  </div>
                  {searchResults.map((article) => (
                    <button
                      key={article.id}
                      onClick={() => {
                        onNavigate("blog-article", {
                          slug: article.slug,
                        });
                        setShowResults(false);
                        setSearchQuery("");
                      }}
                      className="flex w-full items-start gap-3 rounded-lg p-3 text-left transition-colors hover:bg-secondary"
                    >
                      <BookOpen className="mt-1 h-5 w-5 flex-shrink-0 text-primary" />
                      <div className="flex-1 overflow-hidden">
                        <div className="truncate">
                          {article.title}
                        </div>
                        <div className="truncate text-sm text-muted-foreground">
                          {article.excerpt}
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
              </motion.div>
            )}

            {showResults &&
              searchResults.length === 0 &&
              searchQuery.trim().length > 1 && (
                <motion.div
                  className="absolute top-full z-50 mt-2 w-full rounded-xl border border-border bg-white p-4 text-center shadow-xl"
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                >
                  <p className="text-muted-foreground">
                    {t.noArticlesFoundTryDifferent}
                  </p>
                </motion.div>
              )}
          </div>
        </div>
      </section>

      {/* Attractions Grid */}
      <section className="py-12 sm:py-16">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {attractions.map((attraction) => (
              <Card
                key={attraction.id}
                className="group h-full cursor-pointer overflow-hidden border bg-white shadow-md transition-all hover:shadow-xl"
                onClick={() => onNavigate(attraction.id)}
              >
                {/* Image - Larger, more prominent */}
                <div className="relative aspect-[16/10] overflow-hidden">
                  <ImageWithFallback
                    src={
                      attraction.cardImage ||
                      attractionFallbackImages[
                        attraction.id
                      ] ||
                      "https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=800&h=600&fit=crop"
                    }
                    alt={attraction.name}
                    className="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                  />
                  <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />

                  {/* Title on image */}
                  <div className="absolute bottom-0 left-0 right-0 p-6">
                    <h3 className="text-white">
                      {attraction.name}
                    </h3>
                  </div>
                </div>

                {/* Minimal Content */}
                <div className="p-5">
                  <p className="mb-4 line-clamp-2 text-sm text-muted-foreground">
                    {attraction.description}
                  </p>

                  <div className="flex items-center justify-between text-sm">
                    <div className="flex items-center gap-1 text-muted-foreground">
                      <Clock className="h-4 w-4" />
                      {attraction.duration}
                    </div>
                    <div className="flex items-center gap-2 text-primary">
                      <span>{t.learnMore}</span>
                      <ArrowRight className="h-4 w-4 transition-transform group-hover:translate-x-2" />
                    </div>
                  </div>
                </div>
              </Card>
            ))}
          </div>
        </div>
      </section>

      {/* Bottom Info Section */}
      <section className="border-t border-border bg-secondary/20 py-12">
        <div className="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
          <h2 className="mb-4 text-foreground">
            {t.planningYourVisit}
          </h2>
          <p className="mb-6 text-muted-foreground">
            {t.browseTravelGuidesDescription}
          </p>
          <Button
            variant="outline"
            size="lg"
            onClick={() => onNavigate("blog")}
          >
            <BookOpen className="mr-2 h-5 w-5" />
            {t.readTravelGuides}
          </Button>
        </div>
      </section>
    </div>
  );
}


--- START OF FILE BackendStatusIndicator.tsx ---

import { useState, useEffect } from "react";
import { AlertCircle, CheckCircle, Loader2 } from "lucide-react";
import { Alert, AlertDescription } from "./ui/alert";
import { Button } from "./ui/button";
import { projectId, publicAnonKey } from "../utils/supabase/info";

export function BackendStatusIndicator() {
  const [status, setStatus] = useState<"checking" | "online" | "offline" | null>(null);
  const [errorDetails, setErrorDetails] = useState<string>("");
  const [showDetails, setShowDetails] = useState(false);

  useEffect(() => {
    checkBackendStatus();
  }, []);

  const checkBackendStatus = async () => {
    setStatus("checking");
    setErrorDetails("");

    try {
      console.log(" Checking backend status...");
      
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/health`,
        {
          method: "GET",
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
          signal: controller.signal,
        }
      );

      clearTimeout(timeoutId);

      if (response.ok) {
        const data = await response.json();
        console.log(" Backend is online:", data);
        setStatus("online");
      } else {
        console.error(" Backend returned error:", response.status);
        setStatus("offline");
        setErrorDetails(
          `Backend returned ${response.status}. ${
            response.status === 404
              ? "Edge Function may not be deployed."
              : "Backend service error."
          }`
        );
      }
    } catch (error) {
      console.error(" Backend check failed:", error);
      setStatus("offline");
      
      if (error instanceof Error) {
        if (error.name === 'AbortError') {
          setErrorDetails("Backend timeout. Service may be starting up or not deployed.");
        } else if (error.message.includes("Failed to fetch")) {
          setErrorDetails("Cannot reach backend. Edge Function may not be deployed.");
        } else {
          setErrorDetails(error.message);
        }
      } else {
        setErrorDetails("Unknown connection error");
      }
    }
  };

  // Don't show anything if checking or online
  if (status === "checking" || status === "online" || status === null) {
    return null;
  }

  // Only show alert if offline
  return (
    <div className="fixed bottom-4 right-4 z-50 max-w-md">
      <Alert className="bg-red-50 border-red-200 shadow-lg">
        <AlertCircle className="h-4 w-4 text-red-600" />
        <AlertDescription className="text-red-900">
          <div className="flex items-start justify-between gap-2">
            <div className="flex-1">
              <strong className="block mb-1"> Backend Service Offline</strong>
              <p className="text-sm mb-2">
                Bookings and payments won't work until the backend is deployed.
              </p>
              {showDetails && errorDetails && (
                <p className="text-xs bg-red-100 p-2 rounded mb-2 font-mono">
                  {errorDetails}
                </p>
              )}
              <div className="flex gap-2">
                <Button
                  size="sm"
                  variant="outline"
                  onClick={checkBackendStatus}
                  className="h-7 text-xs"
                >
                  <Loader2 className="h-3 w-3 mr-1" />
                  Retry
                </Button>
                <Button
                  size="sm"
                  variant="outline"
                  onClick={() => setShowDetails(!showDetails)}
                  className="h-7 text-xs"
                >
                  {showDetails ? "Hide" : "Details"}
                </Button>
                <Button
                  size="sm"
                  variant="outline"
                  onClick={() => window.open("/diagnostics", "_blank")}
                  className="h-7 text-xs"
                >
                  Diagnostics
                </Button>
              </div>
            </div>
            <button
              onClick={() => setStatus(null)}
              className="text-red-600 hover:text-red-800 text-lg leading-none"
              aria-label="Dismiss"
            >
              
            </button>
          </div>
        </AlertDescription>
      </Alert>
    </div>
  );
}


--- START OF FILE BlogArticlePage.tsx ---

import { useState, useEffect } from "react";
import {
  ArrowLeft,
  Calendar,
  Clock,
  Tag,
  Share2,
  Facebook,
  Twitter,
  Mail,
  RefreshCw,
} from "lucide-react";
import { Button } from "./ui/button";
import { Badge } from "./ui/badge";
import { Card } from "./ui/card";
import { Separator } from "./ui/separator";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import {
  getArticleBySlug,
  loadCategories,
  getPublishedArticles,
  type BlogArticle,
} from "../lib/blogManager";
import ReactMarkdown from "react-markdown";
import { BlogSEO } from "./BlogSEO";
import { Breadcrumbs } from "./Breadcrumbs";
import { TableOfContents } from "./TableOfContents";
import { ReadingProgress } from "./ReadingProgress";
import { ArticleFAQ } from "./ArticleFAQ";

import { loadContentWithLanguage } from "../lib/contentManager";

interface BlogArticlePageProps {
  onNavigate: (page: string, data?: any) => void;
  slug: string;
  language: string;
}

export function BlogArticlePage({
  onNavigate,
  slug,
  language,
}: BlogArticlePageProps) {
  const content = loadContentWithLanguage(language);
  const [article, setArticle] = useState<BlogArticle | null>(
    null,
  );
  const [relatedArticles, setRelatedArticles] = useState<
    BlogArticle[]
  >([]);
  const [otherArticles, setOtherArticles] = useState<
    BlogArticle[]
  >([]);
  const [showShareMenu, setShowShareMenu] = useState(false);
  const [categoryName, setCategoryName] = useState("");

  useEffect(() => {
    const foundArticle = getArticleBySlug(slug);
    setArticle(foundArticle || null);

    if (foundArticle) {
      // Get category name
      const categories = loadCategories();
      const category = categories.find(
        (cat) => cat.slug === foundArticle.category,
      );
      const translatedCategoryName =
        content.blog.categories[
          foundArticle.category as keyof typeof content.blog.categories
        ];
      setCategoryName(
        category?.name ||
          translatedCategoryName ||
          foundArticle.category,
      );

      // Find related articles (same category, excluding current)
      const allArticles = getPublishedArticles();
      const related = allArticles
        .filter(
          (a) =>
            a.category === foundArticle.category &&
            a.id !== foundArticle.id,
        )
        .slice(0, 3);
      setRelatedArticles(related);

      // Get other articles for sidebar (excluding current article)
      const otherArts = allArticles
        .filter((a) => a.id !== foundArticle.id)
        .slice(0, 5);
      setOtherArticles(otherArts);

      // Scroll to top when article loads
      window.scrollTo(0, 0);

      // Add IDs to headings for TOC navigation
      setTimeout(() => {
        const headings = document.querySelectorAll(
          ".article-content h1, .article-content h2, .article-content h3",
        );
        headings.forEach((heading) => {
          const id =
            heading.textContent
              ?.toLowerCase()
              .replace(/[^a-z0-9]+/g, "-")
              .replace(/^-+|-+$/g, "") || "";
          heading.id = id;
        });
      }, 100);
    }
  }, [slug]);

  if (!article) {
    return (
      <div className="flex min-h-screen items-center justify-center">
        <div className="text-center">
          <h2 className="mb-4 text-foreground">
            {content.blog.articleNotFound}
          </h2>
          <Button onClick={() => onNavigate("blog")}>
            <ArrowLeft className="mr-2 h-4 w-4" />
            {content.blog.backToBlog}
          </Button>
        </div>
      </div>
    );
  }

  const formatDateForDisplay = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      month: "long",
      day: "numeric",
      year: "numeric",
    });
  };

  const isArticleUpdated = () => {
    if (!article) return false;
    const published = new Date(article.publishDate);
    const modified = new Date(article.lastModified);
    const diffDays = Math.floor(
      (modified.getTime() - published.getTime()) /
        (1000 * 60 * 60 * 24),
    );
    return diffDays > 1; // Show if updated more than 1 day after publishing
  };

  const handleShare = (platform: string) => {
    const url = window.location.href;
    const title = article.title;

    switch (platform) {
      case "facebook":
        window.open(
          `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
          "_blank",
        );
        break;
      case "twitter":
        window.open(
          `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`,
          "_blank",
        );
        break;
      case "email":
        window.location.href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(url)}`;
        break;
    }
    setShowShareMenu(false);
  };

  return (
    <div className="flex-1">
      {/* Reading Progress Bar */}
      <ReadingProgress />

      {/* SEO Meta Tags and Structured Data */}
      {article && (
        <BlogSEO
          article={article}
          categoryName={categoryName}
        />
      )}

      {/* Back Button */}
      <div className="border-b border-border bg-white py-4">
        <div className="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
          <Button
            variant="ghost"
            onClick={() => onNavigate("blog")}
            className="gap-2"
          >
            <ArrowLeft className="h-4 w-4" />
            {content.blog.backToBlog}
          </Button>
        </div>
      </div>

      {/* Article Header - Clean & Simple */}
      <section className="border-b border-border bg-white py-6 sm:py-8">
        <div className="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
          {/* Breadcrumbs */}
          <Breadcrumbs
            items={[
              {
                label: content.blog.breadcrumbHome,
                onClick: () => onNavigate("home"),
              },
              {
                label: content.blog.breadcrumbTravelGuide,
                onClick: () => onNavigate("blog"),
              },
              {
                label: categoryName,
                onClick: () =>
                  onNavigate("blog", {
                    category: article.category,
                  }),
              },
              { label: article.title },
            ]}
          />

          {/* Category Badge */}
          <Badge className="mb-3 bg-primary text-white">
            {categoryName}
          </Badge>

          {/* Meta Info - Above Image */}
          <div className="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
            <div className="flex items-center gap-1.5">
              <Calendar className="h-3.5 w-3.5" />
              <time dateTime={article.publishDate}>
                {formatDateForDisplay(article.publishDate)}
              </time>
            </div>
            {isArticleUpdated() && (
              <div className="flex items-center gap-1.5">
                <RefreshCw className="h-3.5 w-3.5" />
                <time dateTime={article.lastModified}>
                  {formatDateForDisplay(article.lastModified)}
                </time>
              </div>
            )}
            <div className="flex items-center gap-1.5">
              <Clock className="h-3.5 w-3.5" />
              {article.readTimeMinutes} {content.blog.minRead}
            </div>
            {article.author && (
              <div className="flex items-center gap-1.5">
                {content.blog.byAuthor} {article.author}
              </div>
            )}
          </div>
        </div>
      </section>

      {/* Featured Image */}
      {(article.heroImage || article.featuredImage) && (
        <section className="mx-auto max-w-4xl px-4 py-6 sm:px-6 lg:px-8">
          <div className="overflow-hidden rounded-lg shadow-lg">
            <ImageWithFallback
              src={
                article.heroImage || article.featuredImage || ""
              }
              alt={article.title}
              className="aspect-[21/9] w-full object-cover sm:aspect-video"
            />
          </div>
        </section>
      )}

      {/* Tags and Share - Below Image */}
      <div className="mx-auto max-w-4xl px-4 pb-6 sm:px-6 lg:px-8">
        <div className="flex flex-wrap items-center justify-between gap-4">
          {/* Tags */}
          {article.tags.length > 0 && (
            <div className="flex flex-wrap gap-2">
              {article.tags.map((tag) => (
                <Badge
                  key={tag}
                  variant="outline"
                  className="gap-1 text-xs"
                >
                  <Tag className="h-3 w-3" />
                  {tag}
                </Badge>
              ))}
            </div>
          )}

          {/* Share Button - Small & Subtle */}
          <div className="relative">
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setShowShareMenu(!showShareMenu)}
              className="gap-1.5 text-xs text-muted-foreground hover:text-foreground"
            >
              <Share2 className="h-3.5 w-3.5" />
              {content.blog.share}
            </Button>

            {showShareMenu && (
              <Card className="absolute right-0 top-10 z-10 p-2 shadow-lg">
                <div className="flex flex-col gap-1">
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => handleShare("facebook")}
                    className="justify-start gap-2 text-xs"
                  >
                    <Facebook className="h-3.5 w-3.5" />
                    Facebook
                  </Button>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => handleShare("twitter")}
                    className="justify-start gap-2 text-xs"
                  >
                    <Twitter className="h-3.5 w-3.5" />
                    Twitter
                  </Button>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => handleShare("email")}
                    className="justify-start gap-2 text-xs"
                  >
                    <Mail className="h-3.5 w-3.5" />
                    Email
                  </Button>
                </div>
              </Card>
            )}
          </div>
        </div>
      </div>

      {/* Article Content with TOC */}
      <div className="mx-auto max-w-6xl px-4 py-12 sm:px-6 lg:px-8">
        <div className="grid gap-8 lg:grid-cols-[1fr_300px]">
          {/* Main Content */}
          <article className="article-content">
            <div className="prose prose-lg max-w-none">
              <ReactMarkdown
                components={{
                  h1: ({ node, ...props }) => (
                    <h1
                      className="mb-8 mt-2 text-foreground"
                      {...props}
                    />
                  ),
                  h2: ({ node, ...props }) => (
                    <h2
                      className="mb-4 mt-8 text-foreground"
                      {...props}
                    />
                  ),
                  h3: ({ node, ...props }) => (
                    <h3
                      className="mb-3 mt-6 text-foreground"
                      {...props}
                    />
                  ),
                  p: ({ node, ...props }) => (
                    <p
                      className="mb-4 text-muted-foreground leading-relaxed"
                      {...props}
                    />
                  ),
                  ul: ({ node, ...props }) => (
                    <ul
                      className="mb-4 ml-6 list-disc space-y-2 text-muted-foreground"
                      {...props}
                    />
                  ),
                  ol: ({ node, ...props }) => (
                    <ol
                      className="mb-4 ml-6 list-decimal space-y-2 text-muted-foreground"
                      {...props}
                    />
                  ),
                  li: ({ node, ...props }) => (
                    <li
                      className="leading-relaxed"
                      {...props}
                    />
                  ),
                  strong: ({ node, ...props }) => (
                    <strong
                      className="text-foreground"
                      {...props}
                    />
                  ),
                  a: ({ node, ...props }) => (
                    <a
                      className="text-primary underline hover:text-primary/80"
                      {...props}
                    />
                  ),
                  blockquote: ({ node, ...props }) => (
                    <blockquote
                      className="border-l-4 border-primary pl-4 italic text-muted-foreground"
                      {...props}
                    />
                  ),
                }}
              >
                {article.content}
              </ReactMarkdown>
            </div>
          </article>

          {/* Sidebar - Desktop Only */}
          <aside className="hidden space-y-6 lg:block">
            <div className="sticky top-24 space-y-6">
              <TableOfContents
                content={article.content}
                language={language}
              />

              {/* Other Articles Card - Desktop */}
              {otherArticles.length > 0 && (
                <Card className="overflow-hidden border-border">
                  <div className="border-b border-border bg-gradient-to-br from-primary/5 to-accent/5 p-4">
                    <h3 className="text-foreground">
                      {content.blog.moreFromTravelGuide}
                    </h3>
                  </div>
                  <div className="divide-y divide-border">
                    {otherArticles
                      .slice(0, 3)
                      .map((otherArticle) => (
                        <div
                          key={otherArticle.id}
                          className="group cursor-pointer transition-all hover:bg-secondary/30"
                          onClick={() =>
                            onNavigate("blog-article", {
                              slug: otherArticle.slug,
                            })
                          }
                        >
                          {(otherArticle.thumbnailImage || otherArticle.featuredImage) && (
                            <div className="relative aspect-video overflow-hidden">
                              <ImageWithFallback
                                src={
                                  otherArticle.thumbnailImage ||
                                  otherArticle.featuredImage
                                }
                                alt={otherArticle.title}
                                className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                              />
                            </div>
                          )}
                          <div className="p-4">
                            <h4 className="mb-2 line-clamp-2 transition-colors group-hover:text-primary">
                              {otherArticle.title}
                            </h4>
                            <div className="flex items-center gap-1 text-xs text-muted-foreground">
                              <Clock className="h-3 w-3" />
                              {
                                otherArticle.readTimeMinutes
                              }{" "}
                              {content.blog.minRead}
                            </div>
                          </div>
                        </div>
                      ))}
                  </div>
                  <div className="border-t border-border p-4">
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={() => onNavigate("blog")}
                      className="w-full"
                    >
                      {content.blog.viewAllArticles}
                    </Button>
                  </div>
                </Card>
              )}
            </div>
          </aside>
        </div>
      </div>

      {/* Mobile Table of Contents */}
      <div className="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:hidden">
        <TableOfContents
          content={article.content}
          language={language}
        />
      </div>

      <Separator className="mx-auto max-w-6xl" />

      {/* Mobile - More from Travel Guide */}
      {otherArticles.length > 0 && (
        <section className="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:hidden">
          <h2 className="mb-6 text-foreground">
            {content.blog.moreFromTravelGuide}
          </h2>
          <div className="grid gap-6 sm:grid-cols-2">
            {otherArticles.slice(0, 4).map((otherArticle) => (
              <Card
                key={otherArticle.id}
                className="group cursor-pointer overflow-hidden border-border transition-all hover:shadow-lg"
                onClick={() =>
                  onNavigate("blog-article", {
                    slug: otherArticle.slug,
                  })
                }
              >
                {otherArticle.featuredImage && (
                  <div className="relative aspect-video overflow-hidden">
                    <ImageWithFallback
                      src={otherArticle.featuredImage}
                      alt={otherArticle.title}
                      className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                    />
                  </div>
                )}
                <div className="p-4">
                  <h3 className="mb-2 line-clamp-2 transition-colors group-hover:text-primary">
                    {otherArticle.title}
                  </h3>
                  <div className="flex items-center gap-1 text-sm text-muted-foreground">
                    <Clock className="h-4 w-4" />
                    {otherArticle.readTimeMinutes}{" "}
                    {content.blog.minRead}
                  </div>
                </div>
              </Card>
            ))}
          </div>
          <div className="mt-6 text-center">
            <Button
              variant="outline"
              onClick={() => onNavigate("blog")}
            >
              {content.blog.viewAllArticles}
            </Button>
          </div>
        </section>
      )}

      <Separator className="mx-auto max-w-6xl lg:hidden" />

      {/* FAQ Section */}
      {article.faqs && article.faqs.length > 0 && (
        <section className="mx-auto max-w-4xl px-4 py-12 sm:px-6 lg:px-8">
          <ArticleFAQ
            faqs={article.faqs}
            articleUrl={`https://www.hoponsintra.com/blog/${article.slug}`}
          />
        </section>
      )}

      {article.faqs && article.faqs.length > 0 && (
        <Separator className="mx-auto max-w-6xl" />
      )}

      {/* CTA Section */}
      <section className="mx-auto max-w-6xl px-4 py-12 sm:px-6 lg:px-8">
        <Card className="border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-accent/5 p-8 text-center">
          <h3 className="mb-3 text-foreground">
            {content.blog.readyToExperience}
          </h3>
          <p className="mb-6 text-muted-foreground">
            {content.blog.bookFlexibleDayPass}
          </p>
          <Button
            size="lg"
            onClick={() => onNavigate("buy-ticket")}
            className="gap-2"
          >
            {content.blog.bookDayPassNow}
          </Button>
        </Card>
      </section>

      {/* Related Articles */}
      {relatedArticles.length > 0 && (
        <section className="border-t border-border bg-secondary/30 py-16">
          <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
            <h2 className="mb-8 text-center text-foreground">
              {content.blog.relatedArticles}
            </h2>
            <div className="grid gap-8 md:grid-cols-3">
              {relatedArticles.map((relatedArticle) => (
                <Card
                  key={relatedArticle.id}
                  className="group cursor-pointer overflow-hidden border-border transition-all hover:shadow-xl"
                  onClick={() =>
                    onNavigate("blog-article", {
                      slug: relatedArticle.slug,
                    })
                  }
                >
                  {relatedArticle.featuredImage && (
                    <div className="relative aspect-video overflow-hidden">
                      <ImageWithFallback
                        src={relatedArticle.featuredImage}
                        alt={relatedArticle.title}
                        className="h-full w-full object-cover transition-transform group-hover:scale-110"
                      />
                    </div>
                  )}
                  <div className="p-6">
                    <div className="mb-2 flex items-center gap-2 text-sm text-muted-foreground">
                      <Clock className="h-4 w-4" />
                      {relatedArticle.readTimeMinutes}{" "}
                      {content.blog.minRead}
                    </div>
                    <h3 className="text-foreground transition-colors group-hover:text-primary">
                      {relatedArticle.title}
                    </h3>
                  </div>
                </Card>
              ))}
            </div>
          </div>
        </section>
      )}
    </div>
  );
}


--- START OF FILE BlogEditor.tsx ---

import { useState, useEffect, useRef } from "react";
import { Save, Plus, Trash2, Edit, Eye, EyeOff, Calendar, Tag as TagIcon } from "lucide-react";
import { Button } from "./ui/button";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { Textarea } from "./ui/textarea";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { Switch } from "./ui/switch";
import { Alert, AlertDescription } from "./ui/alert";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "./ui/select";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from "./ui/dialog";
import { toast } from "sonner@2.0.3";
import {
  loadArticles,
  loadCategories,
  saveArticles,
  generateSlug,
  estimateReadTime,
  type BlogArticle,
  DEFAULT_ARTICLES,
} from "../lib/blogManager";
import { InternalLinkHelper } from "./InternalLinkHelper";
import { loadBlogTags } from "../lib/blogTags";
import { ImageSelector } from "./ImageSelector";

export function BlogEditor() {
  const [articles, setArticles] = useState<BlogArticle[]>([]);
  const [categories, setCategories] = useState<any[]>([]);
  const [isEditing, setIsEditing] = useState(false);
  const [editingArticle, setEditingArticle] = useState<BlogArticle | null>(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [articleToDelete, setArticleToDelete] = useState<string | null>(null);
  const [availableTags, setAvailableTags] = useState<string[]>([]);
  const [tagSearchQuery, setTagSearchQuery] = useState("");
  const contentTextareaRef = useRef<HTMLTextAreaElement>(null);

  useEffect(() => {
    setArticles(loadArticles());
    setCategories(loadCategories());
    setAvailableTags(loadBlogTags());
  }, []);

  const createNewArticle = (): BlogArticle => {
    return {
      id: `article-${Date.now()}`,
      title: "",
      slug: "",
      excerpt: "",
      content: "",
      author: "Hop On Sintra Team",
      publishDate: new Date().toISOString().split('T')[0],
      lastModified: new Date().toISOString().split('T')[0],
      featuredImage: "",
      category: categories[0]?.slug || "",
      tags: [],
      isPublished: false,
      readTimeMinutes: 1,
      seo: {
        title: "",
        description: "",
        keywords: "",
      },
    };
  };

  const handleCreateNew = () => {
    setEditingArticle(createNewArticle());
    setIsEditing(true);
  };

  const handleEdit = (article: BlogArticle) => {
    setEditingArticle({ ...article });
    setIsEditing(true);
  };

  const handleSave = () => {
    if (!editingArticle) return;

    // Validation
    if (!editingArticle.title.trim()) {
      toast.error("Title is required");
      return;
    }

    if (!editingArticle.content.trim()) {
      toast.error("Content is required");
      return;
    }

    // Generate slug if not set
    if (!editingArticle.slug) {
      editingArticle.slug = generateSlug(editingArticle.title);
    }

    // Calculate read time
    editingArticle.readTimeMinutes = estimateReadTime(editingArticle.content);

    // Update last modified
    editingArticle.lastModified = new Date().toISOString().split('T')[0];

    // Auto-generate SEO fields if empty
    if (!editingArticle.seo.title) {
      editingArticle.seo.title = editingArticle.title;
    }
    if (!editingArticle.seo.description) {
      editingArticle.seo.description = editingArticle.excerpt;
    }

    // Save to articles list
    const existingIndex = articles.findIndex(a => a.id === editingArticle.id);
    let newArticles;
    
    if (existingIndex >= 0) {
      // Update existing
      newArticles = [...articles];
      newArticles[existingIndex] = editingArticle;
    } else {
      // Add new
      newArticles = [...articles, editingArticle];
    }

    setArticles(newArticles);
    saveArticles(newArticles);
    setIsEditing(false);
    setEditingArticle(null);
    toast.success("Article saved successfully!");
  };

  const handleDelete = (id: string) => {
    setArticleToDelete(id);
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    if (!articleToDelete) return;

    const newArticles = articles.filter(a => a.id !== articleToDelete);
    setArticles(newArticles);
    saveArticles(newArticles);
    setShowDeleteConfirm(false);
    setArticleToDelete(null);
    toast.success("Article deleted");
  };

  const handleAddTag = (tag: string) => {
    if (!editingArticle) return;

    const normalizedTag = tag.trim().toLowerCase();
    if (!normalizedTag) return;
    
    if (!editingArticle.tags.includes(normalizedTag)) {
      setEditingArticle({
        ...editingArticle,
        tags: [...editingArticle.tags, normalizedTag],
      });
      setTagSearchQuery("");
    } else {
      toast.error("Tag already added to this article");
    }
  };

  const handleRemoveTag = (tag: string) => {
    if (!editingArticle) return;
    setEditingArticle({
      ...editingArticle,
      tags: editingArticle.tags.filter(t => t !== tag),
    });
  };

  const getFilteredTags = () => {
    if (!editingArticle) return [];
    
    const query = tagSearchQuery.toLowerCase();
    const selectedTags = editingArticle.tags || [];
    
    return availableTags
      .filter(tag => !selectedTags.includes(tag))
      .filter(tag => !query || tag.includes(query))
      .slice(0, 20); // Limit to 20 suggestions
  };

  const handleResetToDefaults = () => {
    if (confirm("This will reset all articles to the default set. Are you sure?")) {
      setArticles(DEFAULT_ARTICLES);
      saveArticles(DEFAULT_ARTICLES);
      toast.success("Articles reset to defaults");
    }
  };

  const handleInsertLink = (markdown: string) => {
    if (!editingArticle || !contentTextareaRef.current) return;

    const textarea = contentTextareaRef.current;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = editingArticle.content;
    const before = text.substring(0, start);
    const after = text.substring(end);

    const newContent = before + markdown + after;
    setEditingArticle({ ...editingArticle, content: newContent });

    // Set cursor position after inserted link
    setTimeout(() => {
      textarea.focus();
      const newPosition = start + markdown.length;
      textarea.setSelectionRange(newPosition, newPosition);
    }, 0);

    toast.success("Link inserted!");
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-foreground">Blog Articles Manager</h2>
          <p className="text-muted-foreground">
            Create and manage travel guides and articles about Sintra
          </p>
        </div>
        <div className="flex gap-2">
          <Button variant="outline" onClick={handleResetToDefaults}>
            Reset to Defaults
          </Button>
          <Button onClick={handleCreateNew} className="gap-2">
            <Plus className="h-4 w-4" />
            New Article
          </Button>
        </div>
      </div>

      {/* Articles List */}
      <div className="space-y-4">
        {articles.length === 0 ? (
          <Card className="p-12 text-center">
            <p className="mb-4 text-muted-foreground">No articles yet</p>
            <Button onClick={handleCreateNew}>Create Your First Article</Button>
          </Card>
        ) : (
          articles.map((article) => (
            <Card key={article.id} className="p-6">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="mb-2 flex items-center gap-2">
                    <h3 className="text-foreground">{article.title}</h3>
                    {article.isPublished ? (
                      <Badge className="bg-green-500">Published</Badge>
                    ) : (
                      <Badge variant="outline">Draft</Badge>
                    )}
                  </div>
                  <p className="mb-3 line-clamp-2 text-muted-foreground">
                    {article.excerpt}
                  </p>
                  <div className="flex flex-wrap gap-4 text-sm text-muted-foreground">
                    <div className="flex items-center gap-1">
                      <Calendar className="h-4 w-4" />
                      {new Date(article.publishDate).toLocaleDateString()}
                    </div>
                    <div className="flex items-center gap-1">
                      <TagIcon className="h-4 w-4" />
                      {categories.find(c => c.slug === article.category)?.name || article.category}
                    </div>
                    <div>
                      {article.readTimeMinutes} min read
                    </div>
                    <div>
                      {article.tags.length} tags
                    </div>
                  </div>
                </div>
                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => handleEdit(article)}
                  >
                    <Edit className="h-4 w-4" />
                  </Button>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => handleDelete(article.id)}
                  >
                    <Trash2 className="h-4 w-4" />
                  </Button>
                </div>
              </div>
            </Card>
          ))
        )}
      </div>

      {/* Edit Dialog */}
      <Dialog open={isEditing} onOpenChange={setIsEditing}>
        <DialogContent className="max-h-[90vh] max-w-4xl overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {editingArticle?.id.startsWith('article-') ? 'Create New Article' : 'Edit Article'}
            </DialogTitle>
            <DialogDescription>
              {editingArticle?.id.startsWith('article-') 
                ? 'Create and publish a new blog article for your travel guide' 
                : 'Edit your blog article content, SEO settings, and publishing options'}
            </DialogDescription>
          </DialogHeader>

          {editingArticle && (
            <div className="space-y-6">
              {/* Basic Info */}
              <div className="space-y-4">
                <div>
                  <Label>Title *</Label>
                  <Input
                    value={editingArticle.title}
                    onChange={(e) =>
                      setEditingArticle({
                        ...editingArticle,
                        title: e.target.value,
                        slug: generateSlug(e.target.value),
                      })
                    }
                    placeholder="e.g., How to Get to Sintra from Lisbon"
                  />
                </div>

                <div>
                  <Label>URL Slug</Label>
                  <Input
                    value={editingArticle.slug}
                    onChange={(e) =>
                      setEditingArticle({ ...editingArticle, slug: e.target.value })
                    }
                    placeholder="auto-generated from title"
                  />
                  <p className="mt-1 text-sm text-muted-foreground">
                    URL: /blog/{editingArticle.slug}
                  </p>
                </div>

                <div>
                  <Label>Excerpt *</Label>
                  <Textarea
                    value={editingArticle.excerpt}
                    onChange={(e) =>
                      setEditingArticle({ ...editingArticle, excerpt: e.target.value })
                    }
                    placeholder="Brief summary of the article (2-3 sentences)"
                    rows={3}
                  />
                </div>

                <div className="grid gap-4 md:grid-cols-2">
                  <div>
                    <Label>Category *</Label>
                    <Select
                      value={editingArticle.category}
                      onValueChange={(value) =>
                        setEditingArticle({ ...editingArticle, category: value })
                      }
                    >
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {categories.map((cat) => (
                          <SelectItem key={cat.id} value={cat.slug}>
                            {cat.name}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div>
                    <Label>Author</Label>
                    <Input
                      value={editingArticle.author}
                      onChange={(e) =>
                        setEditingArticle({ ...editingArticle, author: e.target.value })
                      }
                    />
                  </div>

                  <div>
                    <Label>Publish Date</Label>
                    <Input
                      type="date"
                      value={editingArticle.publishDate}
                      onChange={(e) =>
                        setEditingArticle({
                          ...editingArticle,
                          publishDate: e.target.value,
                        })
                      }
                    />
                  </div>

                  <div className="flex items-center gap-2">
                    <Switch
                      checked={editingArticle.isPublished}
                      onCheckedChange={(checked) =>
                        setEditingArticle({ ...editingArticle, isPublished: checked })
                      }
                    />
                    <Label>Published</Label>
                  </div>
                </div>

                <div className="space-y-4 rounded-lg border border-border p-4">
                  <h4 className="font-medium">Images</h4>
                  <ImageSelector
                    label="Hero Image"
                    description="Large image shown at the top of the article page"
                    value={editingArticle.heroImage || ""}
                    onChange={(url) =>
                      setEditingArticle({
                        ...editingArticle,
                        heroImage: url,
                      })
                    }
                  />
                  <ImageSelector
                    label="Thumbnail Image"
                    description="Small image shown in blog post listings and cards"
                    value={editingArticle.thumbnailImage || ""}
                    onChange={(url) =>
                      setEditingArticle({
                        ...editingArticle,
                        thumbnailImage: url,
                      })
                    }
                  />
                  <div>
                    <Label>Featured Image URL (Legacy - Optional)</Label>
                    <Input
                      value={editingArticle.featuredImage || ""}
                      onChange={(e) =>
                        setEditingArticle({
                          ...editingArticle,
                          featuredImage: e.target.value,
                        })
                      }
                      placeholder="https://images.unsplash.com/..."
                    />
                    <p className="mt-1 text-xs text-muted-foreground">
                      For backwards compatibility or external image URLs
                    </p>
                  </div>
                </div>
              </div>

              {/* Tags */}
              <div>
                <Label>Tags</Label>
                <p className="mb-2 text-sm text-muted-foreground">
                  Select tags from the predefined list for better SEO consistency
                </p>
                
                {/* Search/Filter Tags */}
                <div className="mb-3">
                  <Input
                    value={tagSearchQuery}
                    onChange={(e) => setTagSearchQuery(e.target.value)}
                    placeholder="Search available tags..."
                    className="mb-2"
                  />
                  
                  {/* Available Tags to Add */}
                  {tagSearchQuery && (
                    <div className="max-h-40 overflow-y-auto rounded-md border border-border bg-background p-2">
                      {getFilteredTags().length > 0 ? (
                        <div className="flex flex-wrap gap-1">
                          {getFilteredTags().map((tag) => (
                            <Badge
                              key={tag}
                              variant="outline"
                              className="cursor-pointer hover:bg-primary hover:text-primary-foreground"
                              onClick={() => handleAddTag(tag)}
                            >
                              + {tag}
                            </Badge>
                          ))}
                        </div>
                      ) : (
                        <p className="py-2 text-center text-sm text-muted-foreground">
                          No matching tags found
                        </p>
                      )}
                    </div>
                  )}
                </div>

                {/* Selected Tags */}
                <div>
                  <div className="mb-2 text-sm text-muted-foreground">
                    Selected Tags ({editingArticle.tags.length})
                  </div>
                  <div className="flex min-h-[60px] flex-wrap gap-2 rounded-md border border-border p-3">
                    {editingArticle.tags.length === 0 ? (
                      <p className="w-full text-center text-sm text-muted-foreground">
                        No tags selected. Search above to add tags.
                      </p>
                    ) : (
                      editingArticle.tags.map((tag) => (
                        <Badge key={tag} variant="default" className="gap-2">
                          {tag}
                          <button
                            onClick={() => handleRemoveTag(tag)}
                            className="ml-1 hover:text-destructive"
                          >
                            
                          </button>
                        </Badge>
                      ))
                    )}
                  </div>
                </div>

                {/* Quick Add Popular Tags */}
                <div className="mt-2">
                  <p className="mb-2 text-sm text-muted-foreground">Quick add:</p>
                  <div className="flex flex-wrap gap-1">
                    {["sintra", "travel-tips", "planning", "attractions", "guide", "lisbon"]
                      .filter(tag => !editingArticle.tags.includes(tag))
                      .map((tag) => (
                        <Badge
                          key={tag}
                          variant="outline"
                          className="cursor-pointer text-xs hover:bg-primary/10"
                          onClick={() => handleAddTag(tag)}
                        >
                          + {tag}
                        </Badge>
                      ))}
                  </div>
                </div>
              </div>

              {/* Content */}
              <div>
                <div className="mb-2 flex items-center justify-between">
                  <Label>Article Content * (Markdown supported)</Label>
                  <InternalLinkHelper onInsertLink={handleInsertLink} />
                </div>
                
                <Alert className="mb-3 border-primary/30 bg-primary/5">
                  <AlertDescription className="text-sm">
                     <strong>Tip:</strong> Use the "Insert Internal Link" button to easily link to other blog articles, attractions, or pages. Click it to browse all available content!
                  </AlertDescription>
                </Alert>

                <Textarea
                  ref={contentTextareaRef}
                  value={editingArticle.content}
                  onChange={(e) =>
                    setEditingArticle({ ...editingArticle, content: e.target.value })
                  }
                  placeholder="Write your article content here using Markdown formatting...&#10;&#10;# Your Article Title&#10;&#10;Start writing your content here. Use the 'Insert Internal Link' button above to easily add links to other articles and attractions.&#10;&#10;## Section Heading&#10;&#10;Write more content..."
                  rows={15}
                  className="font-mono"
                />
                <p className="mt-1 text-sm text-muted-foreground">
                  Supports Markdown: # Heading, ## Subheading, **bold**, *italic*, [link](url), etc.
                </p>
              </div>

              {/* SEO */}
              <div className="space-y-4 rounded-lg border border-border p-4">
                <h4 className="text-foreground">SEO Settings</h4>
                <div>
                  <Label>SEO Title</Label>
                  <Input
                    value={editingArticle.seo.title}
                    onChange={(e) =>
                      setEditingArticle({
                        ...editingArticle,
                        seo: { ...editingArticle.seo, title: e.target.value },
                      })
                    }
                    placeholder="Auto-filled from article title"
                  />
                </div>
                <div>
                  <Label>SEO Description</Label>
                  <Textarea
                    value={editingArticle.seo.description}
                    onChange={(e) =>
                      setEditingArticle({
                        ...editingArticle,
                        seo: { ...editingArticle.seo, description: e.target.value },
                      })
                    }
                    placeholder="Auto-filled from excerpt"
                    rows={2}
                  />
                </div>
                <div>
                  <Label>SEO Keywords</Label>
                  <Input
                    value={editingArticle.seo.keywords}
                    onChange={(e) =>
                      setEditingArticle({
                        ...editingArticle,
                        seo: { ...editingArticle.seo, keywords: e.target.value },
                      })
                    }
                    placeholder="keyword1, keyword2, keyword3"
                  />
                </div>
              </div>
            </div>
          )}

          <DialogFooter>
            <Button variant="outline" onClick={() => setIsEditing(false)}>
              Cancel
            </Button>
            <Button onClick={handleSave}>
              <Save className="mr-2 h-4 w-4" />
              Save Article
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Delete Confirmation */}
      <Dialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Delete Article?</DialogTitle>
            <DialogDescription>
              This action cannot be undone. The article will be permanently deleted.
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowDeleteConfirm(false)}>
              Cancel
            </Button>
            <Button variant="destructive" onClick={confirmDelete}>
              Delete
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}


--- START OF FILE BlogPage.tsx ---

import { useState, useEffect } from "react";
import {
  Search,
  Clock,
  Calendar,
  Tag,
  BookOpen,
  ArrowRight,
  Filter,
  Compass,
} from "lucide-react";
import { SEOHead } from "./SEOHead";
import { Button } from "./ui/button";
import { Input } from "./ui/input";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import {
  loadArticles,
  loadCategories,
  getPublishedArticles,
  getArticlesByCategory,
  searchArticles,
  type BlogArticle,
  type BlogCategory,
} from "../lib/blogManager";
import { loadContentWithLanguage } from "../lib/contentManager";
import { motion } from "motion/react";

interface BlogPageProps {
  onNavigate: (page: string, data?: any) => void;
  language: string;
}

export function BlogPage({
  onNavigate,
  language,
}: BlogPageProps) {
  const content = loadContentWithLanguage(language);
  const [articles, setArticles] = useState<BlogArticle[]>([]);
  const [categories, setCategories] = useState<BlogCategory[]>(
    [],
  );
  const [filteredArticles, setFilteredArticles] = useState<
    BlogArticle[]
  >([]);
  const [selectedCategory, setSelectedCategory] =
    useState<string>("all");
  const [searchQuery, setSearchQuery] = useState("");

  useEffect(() => {
    const loadedArticles = getPublishedArticles();
    const loadedCategories = loadCategories();
    setArticles(loadedArticles);
    setCategories(loadedCategories);
    setFilteredArticles(loadedArticles);
  }, []);

  useEffect(() => {
    let filtered = articles;

    if (selectedCategory !== "all") {
      filtered = getArticlesByCategory(selectedCategory);
    }

    if (searchQuery.trim()) {
      filtered = searchArticles(searchQuery);
    }

    filtered = [...filtered].sort(
      (a, b) =>
        new Date(b.publishDate).getTime() -
        new Date(a.publishDate).getTime(),
    );

    setFilteredArticles(filtered);
  }, [selectedCategory, searchQuery, articles]);

  const handleArticleClick = (article: BlogArticle) => {
    onNavigate("blog-article", { slug: article.slug });
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    // Map language codes to locale strings
    const localeMap: Record<string, string> = {
      en: "en-US",
      pt: "pt-PT",
      es: "es-ES",
      fr: "fr-FR",
      de: "de-DE",
      nl: "nl-NL",
      it: "it-IT",
    };
    const locale = localeMap[language] || "en-US";
    return date.toLocaleDateString(locale, {
      month: "long",
      day: "numeric",
      year: "numeric",
    });
  };

  const getCategoryName = (categorySlug: string) => {
    const category = categories.find(
      (cat) => cat.slug === categorySlug,
    );
    if (category?.name) return category.name;
    // Fallback to translated category name
    return (
      content.blog.categories[
        categorySlug as keyof typeof content.blog.categories
      ] || categorySlug
    );
  };

  return (
    <div className="flex-1">
      <SEOHead
        title={
          content.seo?.blog?.title ||
          "Sintra Travel Guide & Blog - Expert Tips, Guides & Itineraries"
        }
        description={
          content.seo?.blog?.description ||
          "Comprehensive travel guides for visiting Sintra, Portugal. Expert tips on transportation, attractions, planning your trip, and making the most of your Sintra adventure."
        }
        keywords={
          content.seo?.blog?.keywords ||
          "Sintra travel guide, Sintra blog, visit Sintra, Sintra tips, Pena Palace guide, Sintra itinerary, how to visit Sintra, Sintra Portugal"
        }
        canonicalPath="/blog"
        language={language}
        structuredDataType="article"
        ogImage="https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=1200&h=630&fit=crop"
      />

      {/* Hero Section */}
      <section className="border-b border-border bg-white py-12">
        <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
          <div className="mb-6 text-center">
            <h1 className="mb-3 text-foreground">
              {content.blog.pageTitle}
            </h1>
            <p className="mx-auto max-w-2xl text-lg text-muted-foreground">
              {content.blog.pageSubtitle
                .replace(//g, "")
                .trim()}
            </p>
          </div>

          <div className="relative mx-auto max-w-2xl">
            <Search className="absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground" />
            <Input
              type="text"
              placeholder={content.blog.searchPlaceholder}
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="h-12 rounded-xl bg-secondary/30 pl-12 pr-4"
            />
          </div>
        </div>
      </section>

      {/* Categories Filter */}
      <section className="border-b border-border bg-white py-6">
        <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
          <div className="flex flex-wrap items-center gap-4">
            <div className="flex items-center gap-2">
              <Filter className="h-4 w-4 text-muted-foreground" />
              <span className="text-muted-foreground">
                {content.blog.filterBy}
              </span>
            </div>
            <div className="flex flex-wrap gap-2">
              <Button
                variant={
                  selectedCategory === "all"
                    ? "default"
                    : "outline"
                }
                size="sm"
                onClick={() => setSelectedCategory("all")}
              >
                {content.blog.allArticles}
              </Button>
              {categories.map((category) => (
                <Button
                  key={category.id}
                  variant={
                    selectedCategory === category.slug
                      ? "default"
                      : "outline"
                  }
                  size="sm"
                  onClick={() =>
                    setSelectedCategory(category.slug)
                  }
                >
                  {getCategoryName(category.slug)}
                </Button>
              ))}
            </div>
          </div>
        </div>
      </section>

      {/* Articles Grid */}
      <section className="py-16 sm:py-20">
        <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
          {filteredArticles.length === 0 ? (
            <div className="py-20 text-center">
              <BookOpen className="mx-auto mb-4 h-12 w-12 text-muted-foreground" />
              <h3 className="mb-2 text-foreground">
                {content.blog.noArticlesFound}
              </h3>
              <p className="text-muted-foreground">
                {searchQuery
                  ? content.blog.tryDifferentSearch
                  : content.blog.noArticlesInCategory}
              </p>
            </div>
          ) : (
            <>
              <div className="mb-8 text-center">
                <Badge>
                  {filteredArticles.length}{" "}
                  {filteredArticles.length === 1
                    ? content.blog.article
                    : content.blog.articles}{" "}
                  {content.blog.articlesFound}
                </Badge>
              </div>

              <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                {filteredArticles.map((article, index) => (
                  <motion.div
                    key={article.id}
                    initial={{ opacity: 0, y: 20 }}
                    whileInView={{ opacity: 1, y: 0 }}
                    viewport={{ once: true }}
                    transition={{ delay: index * 0.1 }}
                  >
                    <Card
                      className="group h-full cursor-pointer overflow-hidden transition-all hover:shadow-xl"
                      onClick={() =>
                        handleArticleClick(article)
                      }
                    >
                      {(article.thumbnailImage ||
                        article.featuredImage) && (
                        <div className="relative aspect-video overflow-hidden">
                          <ImageWithFallback
                            src={
                              article.thumbnailImage ||
                              article.featuredImage ||
                              ""
                            }
                            alt={article.title}
                            className="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                          />
                          <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>

                          <Badge className="absolute left-4 top-4 bg-primary text-white">
                            {getCategoryName(article.category)}
                          </Badge>
                        </div>
                      )}

                      <div className="flex h-full flex-col p-6">
                        <div className="mb-3 flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
                          <div className="flex items-center gap-1">
                            <Calendar className="h-4 w-4" />
                            {formatDate(article.publishDate)}
                          </div>
                          <div className="flex items-center gap-1">
                            <Clock className="h-4 w-4" />
                            {article.readTimeMinutes}{" "}
                            {content.blog.minRead}
                          </div>
                        </div>

                        <h3 className="mb-3 text-foreground group-hover:text-primary">
                          {article.title}
                        </h3>

                        <p className="mb-4 flex-1 line-clamp-3 text-muted-foreground">
                          {article.excerpt}
                        </p>

                        {article.tags.length > 0 && (
                          <div className="mb-4 flex flex-wrap gap-2">
                            {article.tags
                              .slice(0, 3)
                              .map((tag) => (
                                <Badge
                                  key={tag}
                                  variant="outline"
                                  className="gap-1"
                                >
                                  <Tag className="h-3 w-3" />
                                  {tag}
                                </Badge>
                              ))}
                          </div>
                        )}

                        <div className="flex items-center gap-2 text-primary">
                          <span>{content.blog.readGuide}</span>
                          <ArrowRight className="h-4 w-4 transition-transform group-hover:translate-x-2" />
                        </div>
                      </div>
                    </Card>
                  </motion.div>
                ))}
              </div>
            </>
          )}
        </div>
      </section>

      {/* Categories Overview */}
      <section className="border-t border-border bg-secondary/30 py-16 sm:py-20">
        <div className="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
          <div className="mb-12 text-center">
            <Badge className="mb-4">
              {content.blog.browseTopics}
            </Badge>
            <h2 className="mb-4 text-foreground">
              {content.blog.exploreByCategory}
            </h2>
            <p className="text-muted-foreground">
              {content.blog.exploreCategoryDescription}
            </p>
          </div>

          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {categories.map((category, index) => {
              const categoryArticleCount = articles.filter(
                (a) => a.category === category.slug,
              ).length;

              return (
                <motion.div
                  key={category.id}
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  viewport={{ once: true }}
                  transition={{ delay: index * 0.1 }}
                >
                  <Card
                    className="group h-full cursor-pointer p-6 transition-all hover:shadow-lg"
                    onClick={() =>
                      setSelectedCategory(category.slug)
                    }
                  >
                    <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10">
                      <BookOpen className="h-6 w-6 text-primary" />
                    </div>
                    <h3 className="mb-2 text-foreground group-hover:text-primary">
                      {getCategoryName(category.slug)}
                    </h3>
                    <p className="mb-4 text-muted-foreground">
                      {content.blog.categoryDescriptions[
                        category.slug as keyof typeof content.blog.categoryDescriptions
                      ] || category.description}
                    </p>
                    <div className="flex items-center justify-between">
                      <span className="text-sm text-muted-foreground">
                        {categoryArticleCount}{" "}
                        {categoryArticleCount === 1
                          ? content.blog.guide
                          : content.blog.guides}
                      </span>
                      <ArrowRight className="h-4 w-4 text-primary transition-transform group-hover:translate-x-2" />
                    </div>
                  </Card>
                </motion.div>
              );
            })}
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="bg-accent py-20">
        <div className="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
          <div className="mb-6 flex justify-center">
            <div className="flex h-16 w-16 items-center justify-center rounded-2xl bg-white shadow-xl">
              <Compass className="h-8 w-8 text-accent" />
            </div>
          </div>

          <h2 className="mb-4 text-white">
            {content.blog.ctaTitle}
          </h2>
          <p className="mb-8 text-xl text-white/90">
            {content.blog.ctaSubtitle}
          </p>
          <Button
            size="lg"
            className="bg-white text-accent shadow-xl hover:bg-white/90"
            onClick={() => onNavigate("buy-ticket")}
          >
            {content.blog.ctaButton}
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </section>
    </div>
  );
}


--- START OF FILE BlogSEO.tsx ---

import { useEffect } from "react";
import { BlogArticle } from "../lib/blogManager";

interface BlogSEOProps {
  article: BlogArticle;
  categoryName: string;
}

export function BlogSEO({ article, categoryName }: BlogSEOProps) {
  useEffect(() => {
    // Update title
    document.title = article.seo.title || `${article.title} - Hop On Sintra Blog`;

    // Update or create meta tags
    const updateMetaTag = (name: string, content: string, property = false) => {
      const attribute = property ? "property" : "name";
      let element = document.querySelector(`meta[${attribute}="${name}"]`);
      
      if (!element) {
        element = document.createElement("meta");
        element.setAttribute(attribute, name);
        document.head.appendChild(element);
      }
      
      element.setAttribute("content", content);
    };

    // Standard meta tags
    updateMetaTag("description", article.seo.description || article.excerpt);
    updateMetaTag("keywords", article.seo.keywords || article.tags.join(", "));
    updateMetaTag("robots", "index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1");
    updateMetaTag("author", article.author);
    
    // Article specific tags
    updateMetaTag("article:published_time", new Date(article.publishDate).toISOString(), true);
    updateMetaTag("article:modified_time", new Date(article.lastModified).toISOString(), true);
    updateMetaTag("article:author", article.author, true);
    updateMetaTag("article:section", categoryName, true);
    
    // Add tags as article:tag
    article.tags.forEach(tag => {
      updateMetaTag(`article:tag`, tag, true);
    });
    
    // Open Graph tags for articles
    updateMetaTag("og:title", article.seo.title || article.title, true);
    updateMetaTag("og:description", article.seo.description || article.excerpt, true);
    updateMetaTag("og:type", "article", true);
    updateMetaTag("og:url", `https://www.hoponsintra.com/blog/${article.slug}`, true);
    updateMetaTag("og:site_name", "Hop On Sintra Travel Guide", true);
    updateMetaTag("og:locale", "en_US", true);
    
    if (article.featuredImage) {
      updateMetaTag("og:image", article.featuredImage, true);
      updateMetaTag("og:image:secure_url", article.featuredImage, true);
      updateMetaTag("og:image:width", "1200", true);
      updateMetaTag("og:image:height", "630", true);
      updateMetaTag("og:image:alt", article.title, true);
    }
    
    // Twitter Card tags
    updateMetaTag("twitter:card", "summary_large_image");
    updateMetaTag("twitter:title", article.seo.title || article.title);
    updateMetaTag("twitter:description", article.seo.description || article.excerpt);
    if (article.featuredImage) {
      updateMetaTag("twitter:image", article.featuredImage);
      updateMetaTag("twitter:image:alt", article.title);
    }
    updateMetaTag("twitter:creator", "@hoponsintra");
    updateMetaTag("twitter:site", "@hoponsintra");
    
    // Update canonical link
    let canonical = document.querySelector('link[rel="canonical"]') as HTMLLinkElement;
    if (!canonical) {
      canonical = document.createElement("link");
      canonical.rel = "canonical";
      document.head.appendChild(canonical);
    }
    canonical.href = `https://www.hoponsintra.com/blog/${article.slug}`;

    // Add JSON-LD structured data for Article
    let structuredData = document.querySelector('script[type="application/ld+json"]');
    if (!structuredData) {
      structuredData = document.createElement("script");
      structuredData.setAttribute("type", "application/ld+json");
      document.head.appendChild(structuredData);
    }

    // Create comprehensive Article schema
    const articleSchema = {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": article.title,
      "description": article.excerpt,
      "image": article.featuredImage ? {
        "@type": "ImageObject",
        "url": article.featuredImage,
        "width": 1200,
        "height": 630
      } : undefined,
      "datePublished": new Date(article.publishDate).toISOString(),
      "dateModified": new Date(article.lastModified).toISOString(),
      "author": {
        "@type": "Organization",
        "name": article.author,
        "url": "https://www.hoponsintra.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Hop On Sintra",
        "url": "https://www.hoponsintra.com",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.hoponsintra.com/icon-72x72.png"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": `https://www.hoponsintra.com/blog/${article.slug}`
      },
      "articleSection": categoryName,
      "keywords": article.tags.join(", "),
      "wordCount": article.content.split(/\s+/).length,
      "timeRequired": `PT${article.readTimeMinutes}M`,
      "inLanguage": "en-US",
      "about": {
        "@type": "Place",
        "name": "Sintra",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Sintra",
          "addressCountry": "PT"
        }
      }
    };

    // Add BreadcrumbList schema
    const breadcrumbSchema = {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://www.hoponsintra.com"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Travel Guide",
          "item": "https://www.hoponsintra.com/blog"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": categoryName,
          "item": `https://www.hoponsintra.com/blog?category=${article.category}`
        },
        {
          "@type": "ListItem",
          "position": 4,
          "name": article.title,
          "item": `https://www.hoponsintra.com/blog/${article.slug}`
        }
      ]
    };

    // Combine schemas using @graph
    const combinedSchema = {
      "@context": "https://schema.org",
      "@graph": [articleSchema, breadcrumbSchema]
    };

    structuredData.textContent = JSON.stringify(combinedSchema);
  }, [article, categoryName]);

  return null;
}


--- START OF FILE BookingConfirmationPage.tsx ---

import { useState, useEffect } from "react";
import { CheckCircle, Download, Mail, Calendar, Users, ArrowRight, Printer, AlertCircle, FileDown, Ticket, Home, Settings } from "lucide-react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { Alert, AlertDescription } from "./ui/alert";
import { projectId, publicAnonKey } from '../utils/supabase/info';
import { toast } from "sonner@2.0.3";
import { TicketCard } from "./TicketCard";
import { getTranslation } from "../lib/translations";

interface BookingConfirmationPageProps {
  onNavigate: (page: string) => void;
  booking: any;
  language?: string;
}

export function BookingConfirmationPage({ onNavigate, booking, language }: BookingConfirmationPageProps) {
  const [emailSent, setEmailSent] = useState(false);
  const [downloadingPdf, setDownloadingPdf] = useState(false);

  useEffect(() => {
    // Scroll to top
    window.scrollTo(0, 0);
    
    // Simulate email sent status
    setTimeout(() => setEmailSent(true), 1000);
  }, [booking]);

  const handleDownloadPDF = async () => {
    setDownloadingPdf(true);
    try {
      
      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings/${booking.id}/pdf`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
        console.error('PDF download error:', errorData);
        throw new Error(errorData.message || 'Failed to download PDF');
      }

      const blob = await response.blob();
      
      if (blob.size === 0) {
        throw new Error('PDF file is empty');
      }

      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      const bookingIdShort = booking.id.split('_')[1] || booking.id;
      link.download = `HopOnSintra_Tickets_${bookingIdShort}.pdf`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);
      
      toast.success('PDF downloaded successfully!');
    } catch (error) {
      console.error('Error downloading PDF:', error);
      toast.error(`Failed to download PDF: ${error instanceof Error ? error.message : 'Unknown error'}`);
    } finally {
      setDownloadingPdf(false);
    }
  };

  if (!booking) {
    return (
      <div className="min-h-screen bg-background py-20">
        <div className="container px-4 text-center">
          <p>No booking found. Please make a booking first.</p>
          <Button onClick={() => onNavigate("buy-ticket")} className="mt-4 bg-accent hover:bg-accent/90">
            <Ticket className="mr-2 h-5 w-5" />
            Book Now
          </Button>
        </div>
      </div>
    );
  }

  const formattedDate = new Date(booking.selectedDate).toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  const bookingIdShort = booking.id.split('_')[1] || booking.id;

  const handlePrint = () => {
    window.print();
  };

  const handleDownloadQR = (qrCode: string, passengerName: string) => {
    const link = document.createElement('a');
    link.download = `hoponsintra-qr-${passengerName.replace(/\s/g, '-')}.png`;
    link.href = qrCode;
    link.click();
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-secondary/30 to-background py-12">
      <div className="container max-w-4xl px-4">
        
        {/* Success Header */}
        <div className="mb-8 text-center">
          <div className="mb-4 inline-flex h-20 w-20 items-center justify-center rounded-full bg-green-100">
            <CheckCircle className="h-12 w-12 text-green-600" />
          </div>
          <h1 className="mb-2">Booking Confirmed!</h1>
          <p className="mb-4 text-muted-foreground">
            Your Hop On Sintra day pass is ready. Check your email for confirmation and QR codes.
          </p>
          
          {/* Booking ID Badge */}
          <div className="mx-auto inline-block rounded-lg bg-primary/10 px-6 py-3">
            <p className="text-sm text-muted-foreground">Booking ID</p>
            <p className="text-2xl font-mono font-bold text-primary">{booking.id}</p>
            <p className="mt-1 text-xs text-muted-foreground">Save this for managing your booking</p>
          </div>
        </div>

        {/* Email Status */}
        {emailSent && (
          <Card className="mb-6 border-green-200 bg-green-50 p-4">
            <div className="flex items-center gap-3">
              <Mail className="h-5 w-5 text-green-600" />
              <div className="flex-1">
                <p className="font-medium text-green-900">
                  Confirmation email sent to {booking.contactInfo.email}
                </p>
                <p className="text-green-700">
                  Your tickets PDF and booking details have been sent to your email.
                </p>
              </div>
            </div>
          </Card>
        )}

        {/* Booking Summary */}
        <Card className="mb-6 p-6">
          <div className="mb-4 flex items-center justify-between">
            <h2 className="text-primary">Booking Summary</h2>
            <Badge variant="secondary" className="bg-primary/10 text-primary">
              Booking #{bookingIdShort}
            </Badge>
          </div>

          <div className="grid gap-4 md:grid-cols-2">
            <div className="flex items-start gap-3">
              <Calendar className="mt-1 h-5 w-5 text-muted-foreground" />
              <div>
                <p className="font-medium">Date</p>
                <p className="text-muted-foreground">{formattedDate}</p>
                <p className="text-muted-foreground">9:00 AM - 7:00 PM</p>
              </div>
            </div>

            <div className="flex items-start gap-3">
              <Users className="mt-1 h-5 w-5 text-muted-foreground" />
              <div>
                <p className="font-medium">Passengers</p>
                <p className="text-muted-foreground">
                  {booking.passengers.length} {booking.passengers.length === 1 ? 'person' : 'people'}
                </p>
              </div>
            </div>
          </div>

          <div className="mt-4 border-t pt-4">
            <div className="flex items-center justify-between">
              <p className="font-medium">Total Paid</p>
              <p className="text-primary">{booking.totalPrice.toFixed(2)}</p>
            </div>
          </div>
        </Card>

        {/* Tickets */}
        <div className="mb-6">
          <div className="mb-4 flex items-center justify-between flex-wrap gap-2">
            <h2 className="text-primary">Your Day Pass Tickets</h2>
            <div className="flex gap-2">
              <Button 
                variant="default" 
                size="sm" 
                onClick={handleDownloadPDF}
                disabled={downloadingPdf}
                className="bg-primary hover:bg-primary/90"
              >
                {downloadingPdf ? (
                  <>
                    <Download className="mr-2 h-4 w-4 animate-spin" />
                    Downloading...
                  </>
                ) : (
                  <>
                    <FileDown className="mr-2 h-4 w-4" />
                    Download PDF
                  </>
                )}
              </Button>
              <Button variant="outline" size="sm" onClick={handlePrint}>
                <Printer className="mr-2 h-4 w-4" />
                Print All
              </Button>
            </div>
          </div>

          <Alert className="mb-4 border-blue-200 bg-blue-50">
            <FileDown className="h-4 w-4 text-blue-600" />
            <AlertDescription className="text-blue-900">
              <strong> PDF Tickets Attached</strong><br/>
              We've sent a PDF with all your tickets to your email. You can also download it here or save your tickets below.
            </AlertDescription>
          </Alert>

          <div className="mb-6 rounded-lg bg-accent/10 p-4">
            <p className="font-medium text-accent-foreground">
               Your Tickets Are Ready!
            </p>
            <p className="mt-1 text-muted-foreground">
              Show these tickets to the driver when boarding. Each passenger needs their own ticket with QR code.
            </p>
          </div>

          <div className="space-y-8">
            {booking.passengers.map((passenger: any, index: number) => (
              <TicketCard
                key={index}
                bookingId={booking.id}
                passengerName={passenger.name}
                passengerType={passenger.type}
                date={booking.selectedDate}
                timeSlot={booking.timeSlot}
                qrCode={booking.qrCodes?.[index] || ""}
                totalPrice={index === 0 ? booking.totalPrice : undefined}
                passengerNumber={index + 1}
                totalPassengers={booking.passengers.length}
              />
            ))}
          </div>
        </div>

        {/* How to Use */}
        <Card className="mb-6 p-6">
          <h3 className="mb-4 text-primary">How to Use Your Pass</h3>
          <div className="space-y-3">
            <div className="flex gap-3">
              <div className="flex h-6 w-6 items-center justify-center rounded-full bg-primary/10 text-primary">
                1
              </div>
              <p>
                <strong>Show QR Code:</strong> Present your QR code to the driver when boarding any vehicle
              </p>
            </div>
            <div className="flex gap-3">
              <div className="flex h-6 w-6 items-center justify-center rounded-full bg-primary/10 text-primary">
                2
              </div>
              <p>
                <strong>Unlimited Rides:</strong> Use your pass for unlimited hop-on/hop-off rides until 8:00 PM
              </p>
            </div>
            <div className="flex gap-3">
              <div className="flex h-6 w-6 items-center justify-center rounded-full bg-primary/10 text-primary">
                3
              </div>
              <p>
                <strong>Regular Service:</strong> New vehicles depart every 30 minutes from all major attractions
              </p>
            </div>
            <div className="flex gap-3">
              <div className="flex h-6 w-6 items-center justify-center rounded-full bg-primary/10 text-primary">
                4
              </div>
              <p>
                <strong>Flexible Schedule:</strong> Spend as much time as you want at each attraction
              </p>
            </div>
          </div>
        </Card>

        {/* Thank You & Navigation Actions */}
        <Card className="mb-8 bg-gradient-to-br from-primary/5 to-secondary/5 p-8 text-center border-primary/20">
          <div className="mb-6">
            <h2 className="mb-3 text-primary"> Thank You for Choosing Hop On Sintra!</h2>
            <p className="text-lg text-muted-foreground">
              We're excited to show you the magic of Sintra. Your adventure begins on {formattedDate}!
            </p>
            <p className="mt-3 text-muted-foreground">
              Your booking confirmation and tickets have been sent to <strong>{booking.contactInfo.email}</strong>
            </p>
          </div>

          {/* Action Buttons */}
          <div className="flex flex-col gap-3 sm:flex-row sm:justify-center">
            <Button
              size="lg"
              variant="default"
              onClick={() => onNavigate("home")}
              className="gap-2 bg-primary hover:bg-primary/90"
            >
              <Home className="h-5 w-5" />
              Back to Homepage
            </Button>
            
            <Button
              size="lg"
              variant="outline"
              onClick={() => onNavigate("manage-booking")}
              className="gap-2 border-primary text-primary hover:bg-primary/10"
            >
              <Settings className="h-5 w-5" />
              Manage Booking
            </Button>

            <Button
              size="lg"
              variant="outline"
              onClick={() => onNavigate("attractions")}
              className="gap-2"
            >
              <ArrowRight className="h-5 w-5" />
              View Attractions
            </Button>
          </div>

          <div className="mt-6 space-y-2 text-sm text-muted-foreground">
            <p> <strong>Tip:</strong> Use your Booking ID <span className="font-mono text-primary">{booking.id}</span> to manage your reservation</p>
            <p> View our <button onClick={() => onNavigate("route-map")} className="text-primary hover:underline">interactive route map</button> to plan your stops</p>
          </div>
        </Card>

        {/* Contact Support */}
        <div className="text-center text-sm text-muted-foreground">
          <p className="mb-2">Questions or need to make changes?</p>
          <p>
            Contact us via{" "}
            <a href="mailto:info@hoponsintra.com" className="text-primary hover:underline">
              info@hoponsintra.com
            </a>{" "}
            or{" "}
            <a href="https://wa.me/351932967279" className="text-primary hover:underline" target="_blank" rel="noopener noreferrer">
              WhatsApp (+351 932 967 279)
            </a>
          </p>
        </div>
      </div>
    </div>
  );
}


--- START OF FILE BookingDiagnostics.tsx ---

import { useState } from "react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { AlertCircle, CheckCircle2, RefreshCw, Search } from "lucide-react";
import { projectId, publicAnonKey } from "../utils/supabase/info";
import { toast } from "sonner@2.0.3";

export function BookingDiagnostics() {
  const [loading, setLoading] = useState(false);
  const [results, setResults] = useState<any>(null);
  const [searchId, setSearchId] = useState("");
  const [searchLoading, setSearchLoading] = useState(false);
  const [searchResult, setSearchResult] = useState<any>(null);

  const runDiagnostic = async () => {
    setLoading(true);
    setResults(null);

    try {
      // Step 1: Check what keys exist
      const keysResponse = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/debug-booking-keys`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );
      const keysData = await keysResponse.json();

      // Step 2: Try to fetch bookings normally
      const bookingsResponse = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );
      const bookingsData = await bookingsResponse.json();

      setResults({
        keys: keysData,
        bookings: bookingsData,
        diagnosis: diagnose(keysData, bookingsData),
      });
    } catch (error) {
      console.error("Diagnostic error:", error);
      setResults({
        error: error instanceof Error ? error.message : String(error),
      });
    } finally {
      setLoading(false);
    }
  };

  const diagnose = (keysData: any, bookingsData: any) => {
    if (!keysData.success || !bookingsData.success) {
      return {
        status: "error",
        message: "API calls failed",
        details: [keysData.error || bookingsData.error],
      };
    }

    const hasBookingKeys = keysData.totalBookingKeys > 0;
    const hasUsedPrefixes = keysData.usedPrefixes && keysData.usedPrefixes.length > 0;
    const adminSeesBookings = bookingsData.bookings && bookingsData.bookings.length > 0;

    if (!hasBookingKeys) {
      return {
        status: "error",
        message: " No bookings exist in database",
        details: [
          "No booking keys found in database",
          "Try creating a test booking to see if it saves properly",
        ],
      };
    }

    if (!hasUsedPrefixes) {
      return {
        status: "warning",
        message: " Bookings exist but prefix tracking is broken",
        details: [
          `Found ${keysData.totalBookingKeys} booking(s) in database`,
          "But 'booking_used_prefixes' key is empty or missing",
          "This is why the admin panel doesn't show bookings",
          "Solution: Re-save the bookings or manually populate the prefix list",
        ],
        bookingKeys: keysData.bookingKeys,
      };
    }

    if (!adminSeesBookings) {
      return {
        status: "warning",
        message: " Bookings exist but admin query returns empty",
        details: [
          `Found ${keysData.totalBookingKeys} booking(s) in database`,
          `Tracked prefixes: ${keysData.usedPrefixes.join(", ")}`,
          "But /bookings endpoint returns no results",
          "Possible issue with getByPrefix query",
        ],
        bookingKeys: keysData.bookingKeys,
        usedPrefixes: keysData.usedPrefixes,
      };
    }

    return {
      status: "success",
      message: " Everything working correctly!",
      details: [
        `Found ${keysData.totalBookingKeys} booking(s) in database`,
        `Admin sees ${bookingsData.bookings.length} booking(s)`,
        `Tracked prefixes: ${keysData.usedPrefixes.join(", ")}`,
      ],
    };
  };

  const searchBooking = async () => {
    setSearchLoading(true);
    setSearchResult(null);

    try {
      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings/direct-lookup/${searchId}`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );
      const data = await response.json();

      if (data.found) {
        setSearchResult(data.booking);
        toast.success(` Found booking: ${searchId}`);
      } else {
        setSearchResult({ error: data.message || "Booking not found" });
        toast.error(` ${data.message || "Booking not found"}`);
      }
    } catch (error) {
      console.error("Search error:", error);
      setSearchResult({ error: error instanceof Error ? error.message : String(error) });
      toast.error(" Search failed");
    } finally {
      setSearchLoading(false);
    }
  };

  return (
    <div className="space-y-4">
      <Card className="p-6">
        <div className="space-y-4">
          <div>
            <h3 className="text-lg font-semibold mb-2">
              Booking System Diagnostics
            </h3>
            <p className="text-sm text-muted-foreground">
              This tool checks why bookings aren't appearing in the admin panel.
            </p>
          </div>

          <Button
            onClick={runDiagnostic}
            disabled={loading}
            className="w-full"
          >
            {loading && <RefreshCw className="mr-2 h-4 w-4 animate-spin" />}
            {loading ? "Running Diagnostics..." : "Run Diagnostic Check"}
          </Button>

          {results && (
            <div className="mt-6 space-y-4">
              {results.error ? (
                <div className="flex items-start gap-3 p-4 bg-destructive/10 border border-destructive/20 rounded-lg">
                  <AlertCircle className="h-5 w-5 text-destructive mt-0.5" />
                  <div className="flex-1">
                    <p className="font-medium text-destructive">Error</p>
                    <p className="text-sm text-muted-foreground mt-1">
                      {results.error}
                    </p>
                  </div>
                </div>
              ) : (
                <>
                  {/* Diagnosis Result */}
                  <div
                    className={`flex items-start gap-3 p-4 rounded-lg border ${
                      results.diagnosis.status === "success"
                        ? "bg-green-50 border-green-200"
                        : results.diagnosis.status === "warning"
                        ? "bg-yellow-50 border-yellow-200"
                        : "bg-red-50 border-red-200"
                    }`}
                  >
                    {results.diagnosis.status === "success" ? (
                      <CheckCircle2 className="h-5 w-5 text-green-600 mt-0.5" />
                    ) : (
                      <AlertCircle
                        className={`h-5 w-5 mt-0.5 ${
                          results.diagnosis.status === "warning"
                            ? "text-yellow-600"
                            : "text-red-600"
                        }`}
                      />
                    )}
                    <div className="flex-1">
                      <p
                        className={`font-medium ${
                          results.diagnosis.status === "success"
                            ? "text-green-900"
                            : results.diagnosis.status === "warning"
                            ? "text-yellow-900"
                            : "text-red-900"
                        }`}
                      >
                        {results.diagnosis.message}
                      </p>
                      <ul className="text-sm mt-2 space-y-1 text-muted-foreground">
                        {results.diagnosis.details.map(
                          (detail: string, i: number) => (
                            <li key={i}> {detail}</li>
                          )
                        )}
                      </ul>
                    </div>
                  </div>

                  {/* Detailed Data */}
                  <details className="border rounded-lg p-4">
                    <summary className="font-medium cursor-pointer text-sm">
                      View Raw Data
                    </summary>
                    <div className="mt-4 space-y-4">
                      <div>
                        <h4 className="text-sm font-medium mb-2">
                          Database Keys ({results.keys.totalBookingKeys})
                        </h4>
                        <pre className="text-xs bg-muted p-3 rounded overflow-x-auto">
                          {JSON.stringify(results.keys.bookingKeys, null, 2)}
                        </pre>
                      </div>

                      <div>
                        <h4 className="text-sm font-medium mb-2">
                          Used Prefixes
                        </h4>
                        <pre className="text-xs bg-muted p-3 rounded overflow-x-auto">
                          {JSON.stringify(results.keys.usedPrefixes, null, 2)}
                        </pre>
                      </div>

                      <div>
                        <h4 className="text-sm font-medium mb-2">
                          Sample Bookings
                        </h4>
                        <pre className="text-xs bg-muted p-3 rounded overflow-x-auto">
                          {JSON.stringify(results.keys.sampleBookings, null, 2)}
                        </pre>
                      </div>

                      <div>
                        <h4 className="text-sm font-medium mb-2">
                          Admin Bookings Response (
                          {results.bookings.bookings?.length || 0})
                        </h4>
                        <pre className="text-xs bg-muted p-3 rounded overflow-x-auto max-h-64">
                          {JSON.stringify(
                            results.bookings.bookings?.slice(0, 3),
                            null,
                            2
                          )}
                        </pre>
                      </div>
                    </div>
                  </details>
                </>
              )}
            </div>
          )}

          <div className="mt-6">
            <Label htmlFor="searchId">Search Booking by ID</Label>
            <div className="flex items-center">
              <Input
                id="searchId"
                value={searchId}
                onChange={(e) => setSearchId(e.target.value)}
                className="w-full"
                placeholder="Enter booking ID"
              />
              <Button
                onClick={searchBooking}
                disabled={searchLoading}
                className="ml-2"
              >
                {searchLoading && <RefreshCw className="mr-2 h-4 w-4 animate-spin" />}
                {searchLoading ? "Searching..." : "Search"}
              </Button>
            </div>

            {searchResult && (
              <div className="mt-4">
                {searchResult.error ? (
                  <div className="flex items-start gap-3 p-4 bg-destructive/10 border border-destructive/20 rounded-lg">
                    <AlertCircle className="h-5 w-5 text-destructive mt-0.5" />
                    <div className="flex-1">
                      <p className="font-medium text-destructive">Error</p>
                      <p className="text-sm text-muted-foreground mt-1">
                        {searchResult.error}
                      </p>
                    </div>
                  </div>
                ) : (
                  <div className="flex items-start gap-3 p-4 bg-green-50 border-green-200 rounded-lg">
                    <CheckCircle2 className="h-5 w-5 text-green-600 mt-0.5" />
                    <div className="flex-1">
                      <p className="font-medium text-green-900">Booking Found</p>
                      <pre className="text-xs bg-muted p-3 rounded overflow-x-auto max-h-64">
                        {JSON.stringify(searchResult, null, 2)}
                      </pre>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </Card>
    </div>
  );
}


--- START OF FILE BookingFlowTest.tsx ---

import { useState } from "react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { CheckCircle, XCircle, Loader2, RefreshCw } from "lucide-react";
import { projectId, publicAnonKey } from '../utils/supabase/info';

export function BookingFlowTest() {
  const [testing, setTesting] = useState(false);
  const [results, setResults] = useState<any>(null);

  const runDiagnostics = async () => {
    setTesting(true);
    const diagnostics: any = {
      timestamp: new Date().toISOString(),
      tests: {}
    };

    try {
      // Test 1: Fetch all bookings
      console.log(" Test 1: Fetching all bookings...");
      const bookingsResponse = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );
      const bookingsData = await bookingsResponse.json();
      diagnostics.tests.fetchBookings = {
        success: bookingsResponse.ok && bookingsData.success,
        count: bookingsData.bookings?.length || 0,
        sample: bookingsData.bookings?.[0] || null,
      };
      console.log(" Test 1 complete:", diagnostics.tests.fetchBookings);

      // Test 2: Check if latest booking has QR codes
      if (bookingsData.bookings && bookingsData.bookings.length > 0) {
        const latestBooking = bookingsData.bookings[bookingsData.bookings.length - 1];
        diagnostics.tests.qrCodesPresent = {
          success: !!latestBooking.qrCodes && latestBooking.qrCodes.length > 0,
          bookingId: latestBooking.id,
          qrCodeCount: latestBooking.qrCodes?.length || 0,
          passengersCount: latestBooking.passengers?.length || 0,
        };
        console.log(" Test 2 complete:", diagnostics.tests.qrCodesPresent);

        // Test 3: Try to fetch specific booking
        const specificResponse = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/bookings/${latestBooking.id}`,
          {
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
            },
          }
        );
        const specificData = await specificResponse.json();
        diagnostics.tests.fetchSpecificBooking = {
          success: specificResponse.ok && specificData.success,
          found: !!specificData.booking,
        };
        console.log(" Test 3 complete:", diagnostics.tests.fetchSpecificBooking);
      }

      // Test 4: Check pricing endpoint
      const pricingResponse = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pricing`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );
      const pricingData = await pricingResponse.json();
      diagnostics.tests.pricing = {
        success: pricingResponse.ok && pricingData.success,
        configured: !!pricingData.pricing,
      };
      console.log(" Test 4 complete:", diagnostics.tests.pricing);

    } catch (error) {
      console.error(" Diagnostic error:", error);
      diagnostics.error = error instanceof Error ? error.message : String(error);
    }

    setResults(diagnostics);
    setTesting(false);
  };

  return (
    <Card className="p-6 max-w-3xl mx-auto">
      <div className="mb-4">
        <h2 className="text-xl mb-2">Booking System Diagnostics</h2>
        <p className="text-sm text-muted-foreground">
          Test if bookings are being created and displayed correctly
        </p>
      </div>

      <Button
        onClick={runDiagnostics}
        disabled={testing}
        className="mb-4"
      >
        {testing ? (
          <>
            <Loader2 className="mr-2 h-4 w-4 animate-spin" />
            Running Tests...
          </>
        ) : (
          <>
            <RefreshCw className="mr-2 h-4 w-4" />
            Run Diagnostics
          </>
        )}
      </Button>

      {results && (
        <div className="space-y-3">
          <div className="text-sm text-muted-foreground">
            Last run: {new Date(results.timestamp).toLocaleString()}
          </div>

          {Object.entries(results.tests || {}).map(([key, value]: [string, any]) => (
            <Card key={key} className="p-3">
              <div className="flex items-start gap-2">
                {value.success ? (
                  <CheckCircle className="h-5 w-5 text-green-600 mt-0.5" />
                ) : (
                  <XCircle className="h-5 w-5 text-red-600 mt-0.5" />
                )}
                <div className="flex-1">
                  <div className="text-sm mb-1">
                    {key.replace(/([A-Z])/g, ' $1').trim()}
                  </div>
                  <pre className="text-xs bg-secondary/50 p-2 rounded overflow-x-auto">
                    {JSON.stringify(value, null, 2)}
                  </pre>
                </div>
              </div>
            </Card>
          ))}

          {results.error && (
            <Card className="p-3 border-red-200 bg-red-50">
              <div className="flex items-start gap-2">
                <XCircle className="h-5 w-5 text-red-600 mt-0.5" />
                <div>
                  <div className="text-sm mb-1">Error</div>
                  <div className="text-xs text-red-900">{results.error}</div>
                </div>
              </div>
            </Card>
          )}
        </div>
      )}
    </Card>
  );
}


--- START OF FILE BookingSuccessTest.tsx ---

import { useState } from "react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { CheckCircle, AlertCircle, TestTube } from "lucide-react";

interface BookingSuccessTestProps {
  onNavigate: (page: string, booking?: any) => void;
}

export function BookingSuccessTest({ onNavigate }: BookingSuccessTestProps) {
  const [testResult, setTestResult] = useState<{
    success: boolean;
    message: string;
    details?: string[];
  } | null>(null);

  const runTest = () => {
    // Create a mock booking object that matches the structure from the backend
    const mockBooking = {
      id: "AA-1234",
      contactInfo: {
        name: "Test Customer",
        email: "test@example.com",
        phone: "+351912345678",
      },
      selectedDate: new Date().toISOString().split("T")[0],
      timeSlot: "10:00",
      pickupLocation: "sintra-train-station",
      passengers: [
        { name: "Test Customer", type: "Adult" },
        { name: "Passenger 2", type: "Adult" },
      ],
      guidedTour: null,
      selectedAttractions: [],
      totalPrice: 50,
      paymentIntentId: "pi_test_123456",
      qrCodes: [
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
      ],
      createdAt: new Date().toISOString(),
      status: "confirmed",
      paymentStatus: "paid",
    };

    // Validate booking structure
    const checks = [];
    let allPassed = true;

    // Check 1: Booking has ID
    if (mockBooking.id) {
      checks.push(" Booking ID exists");
    } else {
      checks.push(" Missing booking ID");
      allPassed = false;
    }

    // Check 2: Contact info exists
    if (mockBooking.contactInfo?.email) {
      checks.push(" Contact email exists");
    } else {
      checks.push(" Missing contact email");
      allPassed = false;
    }

    // Check 3: Passengers array exists
    if (mockBooking.passengers?.length > 0) {
      checks.push(
        ` Has ${mockBooking.passengers.length} passenger(s)`
      );
    } else {
      checks.push(" No passengers found");
      allPassed = false;
    }

    // Check 4: QR codes match passenger count
    if (
      mockBooking.qrCodes?.length === mockBooking.passengers?.length
    ) {
      checks.push(" QR codes match passenger count");
    } else {
      checks.push(
        ` QR code mismatch (${mockBooking.qrCodes?.length || 0} QR codes vs ${mockBooking.passengers?.length || 0} passengers)`
      );
      allPassed = false;
    }

    // Check 5: Date is valid
    if (mockBooking.selectedDate) {
      checks.push(" Booking date exists");
    } else {
      checks.push(" Missing booking date");
      allPassed = false;
    }

    // Check 6: Total price exists
    if (mockBooking.totalPrice > 0) {
      checks.push(` Total price: ${mockBooking.totalPrice}`);
    } else {
      checks.push(" Invalid total price");
      allPassed = false;
    }

    setTestResult({
      success: allPassed,
      message: allPassed
        ? "All checks passed! Ready to navigate to confirmation page."
        : "Some checks failed. Booking structure may be incomplete.",
      details: checks,
    });

    // If all checks pass, offer to navigate
    if (allPassed) {
      // Store the mock booking and navigate after a short delay
      setTimeout(() => {
        onNavigate("booking-confirmation", mockBooking);
      }, 2000);
    }
  };

  return (
    <Card className="p-6">
      <div className="space-y-4">
        <div className="flex items-center gap-2">
          <TestTube className="h-5 w-5 text-primary" />
          <h3 className="font-semibold">Booking Success Page Test</h3>
        </div>

        <p className="text-sm text-muted-foreground">
          This test simulates a successful booking and validates the booking
          object structure before navigating to the confirmation page.
        </p>

        <Button onClick={runTest} className="w-full">
          Run Test & Navigate to Success Page
        </Button>

        {testResult && (
          <div
            className={`mt-4 rounded-lg border p-4 ${
              testResult.success
                ? "border-green-200 bg-green-50"
                : "border-yellow-200 bg-yellow-50"
            }`}
          >
            <div className="flex items-start gap-3">
              {testResult.success ? (
                <CheckCircle className="h-5 w-5 text-green-600 mt-0.5" />
              ) : (
                <AlertCircle className="h-5 w-5 text-yellow-600 mt-0.5" />
              )}
              <div className="flex-1">
                <p
                  className={`font-medium ${
                    testResult.success ? "text-green-900" : "text-yellow-900"
                  }`}
                >
                  {testResult.message}
                </p>
                {testResult.success && (
                  <p className="text-sm text-green-700 mt-1">
                    Navigating to confirmation page in 2 seconds...
                  </p>
                )}
                <ul className="mt-3 space-y-1 text-sm text-muted-foreground">
                  {testResult.details?.map((detail, i) => (
                    <li key={i} className="font-mono text-xs">
                      {detail}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        )}

        <div className="mt-4 rounded-lg border border-border bg-muted/30 p-4">
          <h4 className="text-sm font-medium mb-2">What This Test Checks:</h4>
          <ul className="text-sm text-muted-foreground space-y-1">
            <li> Booking ID format (AA-1234)</li>
            <li> Contact information (email, name)</li>
            <li> Passenger data structure</li>
            <li> QR code generation (one per passenger)</li>
            <li> Date and pricing information</li>
            <li> Payment status</li>
          </ul>
        </div>
      </div>
    </Card>
  );
}


--- START OF FILE Breadcrumbs.tsx ---

import { ChevronRight, Home } from "lucide-react";

interface BreadcrumbItem {
  label: string;
  onClick?: () => void;
}

interface BreadcrumbsProps {
  items: BreadcrumbItem[];
}

export function Breadcrumbs({ items }: BreadcrumbsProps) {
  return (
    <nav aria-label="Breadcrumb" className="mb-6">
      <ol className="flex flex-wrap items-center gap-2 text-sm text-muted-foreground">
        {items.map((item, index) => (
          <li key={index} className="flex items-center gap-2">
            {index > 0 && <ChevronRight className="h-4 w-4" />}
            {item.onClick ? (
              <button
                onClick={item.onClick}
                className="transition-colors hover:text-primary"
              >
                {index === 0 && <Home className="mr-1 inline h-4 w-4" />}
                {item.label}
              </button>
            ) : (
              <span className="text-foreground">
                {index === 0 && <Home className="mr-1 inline h-4 w-4" />}
                {item.label}
              </span>
            )}
          </li>
        ))}
      </ol>
    </nav>
  );
}


--- START OF FILE BuyTicketPage.tsx ---

import { useState, useEffect } from "react";
import { toast } from "sonner@2.0.3";
import { createBooking, createPaymentIntent } from "../lib/api";
import {
  projectId,
  publicAnonKey,
} from "../utils/supabase/info";
import { getTranslation } from "../lib/translations";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "./ui/select";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "./ui/popover";
import { Calendar as CalendarComponent } from "./ui/calendar";
import { Badge } from "./ui/badge";
import {
  Calendar as CalendarIcon,
  Users,
  MapPin,
  Ticket,
  User,
  Mail,
  CreditCard,
  Check,
  ArrowRight,
  ChevronLeft,
  AlertCircle,
  Loader2,
  Car,
  Receipt,
  RefreshCw,
} from "lucide-react";
import { format } from "date-fns";
import { StripePaymentForm } from "./StripePaymentForm";
import { PickupLocationMap } from "./PickupLocationMap";

interface BuyTicketPageProps {
  onNavigate: (page: string) => void;
  onBookingComplete: (booking: any) => void;
  language: string;
}

interface PricingSettings {
  basePrice: number;
  guidedTourSurcharge: number;
  attractions: {
    [key: string]: { name: string; price: number };
  };
}

interface AvailabilitySettings {
  [date: string]: {
    [timeSlot: string]: number;
  };
}

const DEFAULT_PRICING: PricingSettings = {
  basePrice: 25,
  guidedTourSurcharge: 5,
  attractions: {
    "pena-palace-park": {
      name: "Pena Palace Park Only",
      price: 8,
    },
    "pena-palace-full": {
      name: "Pena Palace & Park",
      price: 14,
    },
    "quinta-regaleira": {
      name: "Quinta da Regaleira",
      price: 12,
    },
    "moorish-castle": { name: "Moorish Castle", price: 10 },
    "monserrate-palace": {
      name: "Monserrate Palace",
      price: 10,
    },
    "sintra-palace": {
      name: "Sintra National Palace",
      price: 10,
    },
    "convento-capuchos": {
      name: "Convento dos Capuchos",
      price: 8,
    },
    "cabo-da-roca": { name: "Cabo da Roca", price: 0 },
    "villa-sassetti": { name: "Villa Sassetti", price: 0 },
  },
};

const TIME_SLOTS = [
  { value: "9:00", label: "9:00 AM" },
  { value: "10:00", label: "10:00 AM", isGuided: true },
  { value: "11:00", label: "11:00 AM" },
  { value: "12:00", label: "12:00 PM" },
  { value: "13:00", label: "1:00 PM" },
  { value: "14:00", label: "2:00 PM", isGuided: true },
  { value: "15:00", label: "3:00 PM" },
  { value: "16:00", label: "4:00 PM" },
];

export function BuyTicketPage({
  onNavigate,
  onBookingComplete,
  language,
}: BuyTicketPageProps) {
  const t = getTranslation(language);

  const PICKUP_LOCATIONS = [
    {
      value: "sintra-train-station",
      label: t.buyTicket.pickupLocations.sintraTrainStation,
    },
    {
      value: "sintra-town-center",
      label: t.buyTicket.pickupLocations.sintraTownCenter,
    },
    {
      value: "pena-palace",
      label: t.buyTicket.pickupLocations.penaPalace,
    },
    {
      value: "quinta-regaleira",
      label: t.buyTicket.pickupLocations.quintaRegaleira,
    },
    {
      value: "moorish-castle",
      label: t.buyTicket.pickupLocations.moorishCastle,
    },
    {
      value: "monserrate-palace",
      label: t.buyTicket.pickupLocations.monserratePalace,
    },
    {
      value: "sintra-palace",
      label: t.buyTicket.pickupLocations.sintraPalace,
    },
    {
      value: "other",
      label: t.buyTicket.pickupLocations.other,
    },
  ];
  // Feature flag for monument tickets
  const [monumentTicketsEnabled, setMonumentTicketsEnabled] =
    useState(false);
  
  // Master toggle for ticket purchases
  const [ticketPurchasesEnabled, setTicketPurchasesEnabled] = useState(true);

  const [currentStep, setCurrentStep] = useState(1);
  const [bookingComplete, setBookingComplete] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [pricing, setPricing] =
    useState<PricingSettings>(DEFAULT_PRICING);
  const [availability, setAvailability] =
    useState<AvailabilitySettings>({});
  const [loadingAvailability, setLoadingAvailability] =
    useState(false);
  const [paymentClientSecret, setPaymentClientSecret] =
    useState<string | null>(null);
  const [paymentIntentId, setPaymentIntentId] = useState<
    string | null
  >(null);
  const [isCreatingPayment, setIsCreatingPayment] =
    useState(false);
  const [paymentInitError, setPaymentInitError] = useState<
    string | null
  >(null);
  const [formData, setFormData] = useState({
    fullName: "",
    email: "",
    confirmEmail: "",
    date: "",
    timeSlot: "",
    selectedAttractions: [] as string[],
    quantity: 1,
    pickupLocation: "sintra-train-station" as string,
  });

  // Load feature flag from localStorage
  useEffect(() => {
    const checkFlags = () => {
      try {
        const flags = localStorage.getItem("feature-flags");
        if (flags) {
          const parsed = JSON.parse(flags);
          setMonumentTicketsEnabled(
            parsed.monumentTicketsEnabled === true,
          );
        }
      } catch (e) {
        console.error("Failed to parse feature flags:", e);
      }
    };

    checkFlags();
    window.addEventListener("storage", checkFlags);
    return () =>
      window.removeEventListener("storage", checkFlags);
  }, []);

  // Load pricing from database and fallback to localStorage
  useEffect(() => {
    async function loadPricingFromDB() {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/pricing`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        if (response.ok) {
          const data = await response.json();
          if (data.pricing) {
            setPricing({
              ...DEFAULT_PRICING,
              ...data.pricing,
              attractions: {
                ...DEFAULT_PRICING.attractions,
                ...data.pricing.attractions,
              },
            });
            // Save to localStorage for offline use
            localStorage.setItem(
              "admin-pricing",
              JSON.stringify(data.pricing),
            );
            console.log(" Loaded pricing from database");
            return;
          }
        } else if (response.status === 404) {
          console.warn(
            " Backend not available (404). Using cached pricing.",
          );
          console.warn(
            " Bookings may not work. Check /diagnostics page for backend status.",
          );
        }
      } catch (error) {
        // Silently handle error - backend may not be available
        console.warn(
          " Backend connection failed. Using cached pricing.",
        );
      }

      // Fallback to localStorage if database fetch fails
      const savedPricing =
        localStorage.getItem("admin-pricing");
      if (savedPricing) {
        try {
          const parsed = JSON.parse(savedPricing);
          setPricing({
            ...DEFAULT_PRICING,
            ...parsed,
            attractions: {
              ...DEFAULT_PRICING.attractions,
              ...parsed.attractions,
            },
          });
          console.log(" Using saved pricing");
        } catch (e) {
          console.log(" Using default pricing");
        }
      }
    }

    loadPricingFromDB();

    // Load ticket purchases enabled setting
    async function loadTicketPurchasesSetting() {
      try {
        const response = await fetch(
          `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/settings/ticket-purchases-enabled`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${publicAnonKey}`,
              "Content-Type": "application/json",
            },
          },
        );

        if (response.ok) {
          const data = await response.json();
          setTicketPurchasesEnabled(data.enabled !== false);
          console.log(" Loaded ticket purchases setting:", data.enabled);
        }
      } catch (error) {
        console.error("Error loading ticket purchases setting:", error);
        setTicketPurchasesEnabled(true);
      }
    }
    loadTicketPurchasesSetting();
  }, []);

  // Load availability from backend when date is selected
  useEffect(() => {
    if (formData.date) {
      loadAvailabilityForDate(formData.date);
    }
  }, [formData.date]);

  // Create payment intent when reaching step 4
  useEffect(() => {
    if (
      currentStep === 4 &&
      !paymentClientSecret &&
      !isCreatingPayment
    ) {
      createStripePaymentIntent();
    }
  }, [currentStep]);

  const loadAvailabilityForDate = async (date: string) => {
    setLoadingAvailability(true);

    try {
      const response = await fetch(
        `https://${projectId}.supabase.co/functions/v1/make-server-3bd0ade8/availability/${date}`,
        {
          method: "GET",
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
            "Content-Type": "application/json",
          },
        },
      );

      if (response.ok) {
        const data = await response.json();
        if (data.availability) {
          setAvailability((prev) => ({
            ...prev,
            [date]: data.availability,
          }));
        }
      }
    } catch (error) {
      console.error("Error loading availability:", error);
    }

    setLoadingAvailability(false);
  };

  const attractions = Object.entries(pricing.attractions).map(
    ([id, data]) => ({
      id,
      name: data.name,
      price: data.price,
    }),
  );

  const handleInputChange = (
    field: string,
    value: string | boolean | number,
  ) => {
    setFormData((prev) => {
      // If changing pickup location to "other", clear timeSlot
      if (field === "pickupLocation" && value === "other") {
        return { ...prev, [field]: value, timeSlot: "" };
      }
      return { ...prev, [field]: value };
    });
  };

  const getAvailability = (
    date: string,
    timeSlot: string,
  ): number => {
    return availability[date]?.[timeSlot] ?? 50; // Default 50 seats
  };

  const guidedTourTimes = ["10:00", "14:00"];
  const isGuidedTourTime = guidedTourTimes.includes(
    formData.timeSlot,
  );
  const basePrice = pricing.basePrice;
  const guidedTourSurcharge = pricing.guidedTourSurcharge;
  const passTotal = basePrice * formData.quantity;
  const guidedTourTotal = isGuidedTourTime
    ? guidedTourSurcharge * formData.quantity
    : 0;
  const attractionsTotal = formData.selectedAttractions.reduce(
    (total, id) => {
      const attraction = attractions.find((a) => a.id === id);
      return (
        total + (attraction?.price || 0) * formData.quantity
      );
    },
    0,
  );
  const totalPrice =
    passTotal + guidedTourTotal + attractionsTotal;

  const toggleAttraction = (attractionId: string) => {
    setFormData((prev) => ({
      ...prev,
      selectedAttractions: prev.selectedAttractions.includes(
        attractionId,
      )
        ? prev.selectedAttractions.filter(
            (id) => id !== attractionId,
          )
        : [...prev.selectedAttractions, attractionId],
    }));
  };

  const createStripePaymentIntent = async () => {
    setIsCreatingPayment(true);
    setPaymentInitError(null);
    try {
      const response = await createPaymentIntent(totalPrice, {
        customerName: formData.fullName,
        customerEmail: formData.email,
        date: formData.date,
        timeSlot: formData.timeSlot,
        quantity: formData.quantity,
      });

      if (response.success && response.data) {
        setPaymentClientSecret(response.data.clientSecret);
        setPaymentIntentId(response.data.paymentIntentId);
        setPaymentInitError(null);
      } else {
        throw new Error(
          response.error || "Failed to create payment intent",
        );
      }
    } catch (error) {
      console.error("Error creating payment intent:", error);
      const errorMsg =
        error instanceof Error
          ? error.message
          : "Failed to initialize payment";
      setPaymentInitError(errorMsg);
      toast.error(
        "Failed to initialize payment. Please try again.",
      );
    } finally {
      setIsCreatingPayment(false);
    }
  };

  const handleNext = () => {
    if (currentStep < 4) {
      setCurrentStep(currentStep + 1);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  };

  const handleBack = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  };

  const handlePaymentSuccess = async (
    confirmedPaymentIntentId: string,
  ) => {
    console.log(
      ` Payment succeeded! Payment Intent ID: ${confirmedPaymentIntentId}`,
    );
    setIsSubmitting(true);

    try {
      // Create booking data
      const passengers = Array.from(
        { length: formData.quantity },
        (_, i) => ({
          name:
            i === 0 ? formData.fullName : `Passenger ${i + 1}`,
          type: "Adult",
        }),
      );

      const bookingData = {
        contactInfo: {
          name: formData.fullName,
          email: formData.email,
          phone: "",
        },
        selectedDate: formData.date,
        timeSlot: formData.timeSlot,
        pickupLocation: formData.pickupLocation,
        passengers,
        guidedTour: isGuidedTourTime
          ? {
              type: "Small Group",
              price: guidedTourTotal,
            }
          : null,
        selectedAttractions: formData.selectedAttractions.map(
          (id) => {
            const attraction = attractions.find(
              (a) => a.id === id,
            );
            return {
              id,
              name: attraction?.name || id,
              tickets: formData.quantity,
              price:
                (attraction?.price || 0) * formData.quantity,
            };
          },
        ),
        totalPrice,
        paymentIntentId: confirmedPaymentIntentId,
      };

      console.log(
        ` Attempting to create booking with payment intent: ${confirmedPaymentIntentId}`,
      );

      // Create booking via API with retry logic
      let response;
      let lastError;
      const maxRetries = 3;

      for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
          console.log(
            ` Booking creation attempt ${attempt}/${maxRetries}`,
          );
          response = await createBooking(bookingData);

          // If we get a response, break the retry loop
          if (response) break;
        } catch (retryError) {
          lastError = retryError;
          console.error(
            ` Booking attempt ${attempt} failed:`,
            retryError,
          );

          // Only retry if it's a network error and we haven't hit max retries
          if (attempt < maxRetries) {
            console.log(` Waiting 1 second before retry...`);
            await new Promise((resolve) =>
              setTimeout(resolve, 1000),
            );
          }
        }
      }

      // If no response after retries, throw the last error
      if (!response) {
        throw (
          lastError ||
          new Error(
            "Failed to create booking after multiple attempts",
          )
        );
      }

      console.log(" Full booking response:", response);
      console.log(" Response structure check:", {
        hasSuccess: !!response.success,
        hasData: !!response.data,
        dataSuccess: response.data?.success,
        hasBooking: !!response.data?.booking,
        bookingId: response.data?.booking?.id,
      });

      // Check both outer and inner success flags
      if (
        response.success &&
        response.data?.success &&
        response.data?.booking
      ) {
        // Show success toast immediately
        if (response.data.emailSent) {
          toast.success(
            "Booking confirmed! Check your email for QR codes.",
          );
        } else {
          toast.success(
            "Booking confirmed! QR codes are ready.",
          );

          // Check for specific email error details
          const emailError = response.data.emailError;

          if (emailError) {
            console.error("Email sending failed:", emailError);

            // Check if domain verification is needed
            if (
              emailError.includes(
                "Domain verification required",
              ) ||
              emailError.includes("verify") ||
              emailError.includes("only send testing emails")
            ) {
              toast.warning(
                " Email system requires domain verification. QR codes are available on this page.",
                {
                  duration: 7000,
                },
              );
            } else if (
              emailError.includes("No email address")
            ) {
              toast.warning(
                " No email address provided. Save your QR codes from this page.",
                {
                  duration: 6000,
                },
              );
            } else {
              // Show generic email error with details
              toast.warning(
                ` Email couldn't be sent: ${emailError}. Save your QR codes from this page.`,
                {
                  duration: 7000,
                },
              );
            }
          } else {
            // Email error without details
            toast.warning(
              "Email couldn't be sent. Save your QR codes from this page.",
              {
                duration: 6000,
              },
            );
          }
        }

        // Small delay to ensure toast is visible before navigation
        await new Promise((resolve) =>
          setTimeout(resolve, 500),
        );

        // Navigate to confirmation page with booking data
        console.log(
          " Navigating to confirmation page with booking:",
          response.data.booking.id,
        );
        onBookingComplete(response.data.booking);
      } else {
        // Check if inner response has error
        const errorMsg =
          response.data?.error ||
          response.error ||
          "Failed to create booking";
        console.error(" Booking creation failed:", errorMsg);
        throw new Error(errorMsg);
      }
    } catch (error) {
      console.error(" Booking error:", error);
      const errorMessage =
        error instanceof Error
          ? error.message
          : "Failed to complete booking. Please try again.";

      // Special handling for 404 errors
      if (
        errorMessage.includes("404") ||
        errorMessage.includes("not found") ||
        errorMessage.includes("endpoint")
      ) {
        toast.error(
          "Server connection issue. Your payment was processed. Please contact support with your payment confirmation.",
          {
            duration: 10000,
          },
        );
        console.error(
          " CRITICAL: Payment succeeded but booking creation failed with 404",
        );
        console.error(
          " Payment Intent ID:",
          confirmedPaymentIntentId,
        );
        console.error(" Customer Email:", formData.email);
      }
      // Check if it's an availability error
      else if (
        errorMessage.includes("Not enough seats") ||
        errorMessage.includes("available")
      ) {
        toast.error(errorMessage);
        // Refresh availability for selected date
        if (formData.date) {
          loadAvailabilityForDate(formData.date);
        }
      } else {
        toast.error(errorMessage);
      }
      setIsSubmitting(false);
    }
  };

  const handlePaymentError = (error: string) => {
    console.error("Payment error:", error);
    toast.error(error || "Payment failed. Please try again.");
    setIsSubmitting(false);
  };

  const canProceedStep1 =
    formData.date &&
    formData.pickupLocation &&
    formData.quantity >= 1 &&
    (formData.pickupLocation === "other" || formData.timeSlot) &&
    ticketPurchasesEnabled;
  const canProceedStep3 =
    formData.fullName &&
    formData.email &&
    formData.confirmEmail &&
    formData.email === formData.confirmEmail;

  return (
    <div className="flex-1 bg-secondary/30">
      {/* Hero Section */}
      <section className="relative overflow-hidden border-b border-border bg-gradient-to-br from-primary/5 via-white to-accent/5 py-12 sm:py-16">
        <div className="absolute -top-24 right-0 h-96 w-96 rounded-full bg-gradient-to-br from-accent/10 to-primary/10 blur-3xl" />
        <div className="absolute -bottom-24 left-0 h-96 w-96 rounded-full bg-gradient-to-tr from-primary/10 to-accent/10 blur-3xl" />

        <div className="relative mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
          <h1 className="mb-3 bg-gradient-to-r from-primary via-primary/90 to-accent bg-clip-text text-foreground">
            {t.buyTicket.hero.title}
          </h1>
          <div className="mx-auto mb-6 h-1 w-20 rounded-full bg-accent" />

          {/* Progress Steps */}
          <div className="mx-auto mt-8 flex max-w-2xl items-center justify-center gap-2">
            {[1, 2, 3, 4].map((step) => (
              <div key={step} className="flex items-center">
                <div
                  className={`flex h-10 w-10 items-center justify-center rounded-full transition-all ${
                    currentStep >= step
                      ? "bg-primary text-white"
                      : "bg-white text-muted-foreground border-2 border-border"
                  }`}
                >
                  {currentStep > step ? (
                    <Check className="h-5 w-5" />
                  ) : (
                    step
                  )}
                </div>
                {step < 4 && (
                  <div
                    className={`h-1 w-8 sm:w-16 transition-all ${
                      currentStep > step
                        ? "bg-primary"
                        : "bg-border"
                    }`}
                  />
                )}
              </div>
            ))}
          </div>

          <div className="mt-4">
            <p className="text-muted-foreground">
              {currentStep === 1 &&
                t.buyTicket.steps.step1Description}
              {currentStep === 2 &&
                t.buyTicket.steps.step2Description}
              {currentStep === 3 &&
                t.buyTicket.steps.step3Description}
              {currentStep === 4 &&
                t.buyTicket.steps.step4Description}
            </p>
          </div>
        </div>
      </section>

      {/* Form Section */}
      <section className="py-12 sm:py-16">
        <div className="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
          <div>
            {/* Step 1: Date & Group */}
            {currentStep === 1 && (
              <Card className="border-border p-8">
                <div className="mb-8">
                  <div className="mb-3 flex items-center gap-3">
                    <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                      <CalendarIcon className="h-5 w-5 text-primary" />
                    </div>
                    <h2 className="text-foreground">
                      {t.buyTicket.dateSelection.planYourVisit}
                    </h2>
                  </div>
                  <div className="h-1 w-16 rounded-full bg-accent" />
                  <p className="mt-4 text-muted-foreground whitespace-pre-line">
                    {
                      t.buyTicket.dateSelection
                        .planYourVisitDescription
                    }
                  </p>
                </div>

                <div className="space-y-6">
                  {/* Sold Out Warning when ticket purchases disabled */}
                  {!ticketPurchasesEnabled && (
                    <div className="rounded-lg border-2 border-red-200 bg-red-50 p-4">
                      <div className="flex items-start gap-3">
                        <AlertCircle className="h-5 w-5 text-red-600 flex-shrink-0 mt-0.5" />
                        <div>
                          <p className="font-medium text-red-900">
                            Temporarily Unavailable
                          </p>
                          <p className="text-sm text-red-700 mt-1">
                            All dates are currently sold out. Please check back later or contact us for availability.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="grid gap-6 sm:grid-cols-2">
                    <div>
                      <Label
                        htmlFor="date"
                        className="text-foreground"
                      >
                        {t.buyTicket.dateSelection.selectDate}
                      </Label>
                      <Popover>
                        <PopoverTrigger asChild>
                          <Button
                            variant="outline"
                            className={`mt-2 w-full justify-start text-left border-border ${
                              !formData.date &&
                              "text-muted-foreground"
                            }`}
                          >
                            <CalendarIcon className="mr-2 h-4 w-4" />
                            {formData.date
                              ? format(
                                  new Date(formData.date),
                                  "PPP",
                                )
                              : t.buyTicket.dateSelection
                                  .pickDate}
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent
                          className="w-auto p-0"
                          align="start"
                        >
                          <CalendarComponent
                            mode="single"
                            selected={
                              formData.date
                                ? new Date(formData.date)
                                : undefined
                            }
                            onSelect={(date) => {
                              if (date) {
                                handleInputChange(
                                  "date",
                                  format(date, "yyyy-MM-dd"),
                                );
                              }
                            }}
                            disabled={(date) =>
                              date <
                              new Date(
                                new Date().setHours(0, 0, 0, 0),
                              ) || !ticketPurchasesEnabled
                            }
                            initialFocus
                          />
                        </PopoverContent>
                      </Popover>
                    </div>

                    <div>
                      <Label
                        htmlFor="timeSlot"
                        className="text-foreground"
                      >
                        {
                          t.buyTicket.dateSelection
                            .preferredStartTime
                        }
                      </Label>
                      {loadingAvailability && (
                        <p className="mt-1 text-xs text-muted-foreground flex items-center gap-1">
                          <Loader2 className="h-3 w-3 animate-spin" />
                          {
                            t.buyTicket.dateSelection
                              .checkingAvailability
                          }
                        </p>
                      )}
                      {formData.pickupLocation !== "other" && (
                        <>
                          <Select
                            value={formData.timeSlot}
                            onValueChange={(value) => {
                              handleInputChange(
                                "timeSlot",
                                value,
                              );
                            }}
                            disabled={
                              !formData.date ||
                              loadingAvailability
                            }
                          >
                            <SelectTrigger className="mt-2 border-border">
                              <SelectValue
                                placeholder={
                                  t.buyTicket.dateSelection
                                    .selectTime
                                }
                              />
                            </SelectTrigger>
                            <SelectContent>
                              {TIME_SLOTS.map((slot) => {
                                const seats = formData.date
                                  ? getAvailability(
                                      formData.date,
                                      slot.value,
                                    )
                                  : 50;
                                const isLowAvailability =
                                  seats < 10 && seats > 0;
                                const isSoldOut = seats === 0;

                                return (
                                  <SelectItem
                                    key={slot.value}
                                    value={slot.value}
                                    disabled={isSoldOut}
                                  >
                                    <div className="flex items-center gap-2 w-full">
                                      <span>{slot.label}</span>
                                      {formData.date && (
                                        <span
                                          className={`text-xs ${
                                            isSoldOut
                                              ? "text-destructive"
                                              : isLowAvailability
                                                ? "text-accent"
                                                : "text-muted-foreground"
                                          }`}
                                        >
                                          {isSoldOut
                                            ? t.buyTicket
                                                .dateSelection
                                                .soldOut
                                            : isLowAvailability
                                              ? t.buyTicket
                                                  .dateSelection
                                                  .limited
                                              : t.buyTicket
                                                  .dateSelection
                                                  .available}
                                        </span>
                                      )}
                                      {slot.isGuided && (
                                        <span className="text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full font-medium">
                                          {
                                            t.buyTicket
                                              .timeSlots
                                              .guidedTourLabel
                                          }{" "}
                                          +
                                          {guidedTourSurcharge}
                                        </span>
                                      )}
                                    </div>
                                  </SelectItem>
                                );
                              })}
                            </SelectContent>
                          </Select>
                          <p className="mt-1 text-muted-foreground">
                            {
                              t.buyTicket.dateSelection
                                .passValidFullDay
                            }
                          </p>
                          {formData.date &&
                            formData.timeSlot && (
                              <p
                                className={`mt-1 ${
                                  getAvailability(
                                    formData.date,
                                    formData.timeSlot,
                                  ) === 0
                                    ? "text-destructive"
                                    : getAvailability(
                                          formData.date,
                                          formData.timeSlot,
                                        ) < 10
                                      ? "text-accent"
                                      : "text-primary"
                                }`}
                              >
                                {getAvailability(
                                  formData.date,
                                  formData.timeSlot,
                                ) === 0
                                  ? t.buyTicket.dateSelection
                                      .soldOutForTime
                                  : getAvailability(
                                        formData.date,
                                        formData.timeSlot,
                                      ) < 10
                                    ? t.buyTicket.dateSelection
                                        .limitedAvailability
                                    : t.buyTicket.dateSelection
                                        .goodAvailability}
                              </p>
                            )}
                        </>
                      )}
                      {formData.pickupLocation === "other" && (
                        <p className="mt-2 text-sm text-muted-foreground italic">
                          No specific time needed - hop on at
                          any time during operating hours (9 AM
                          - 7 PM)
                        </p>
                      )}
                    </div>
                  </div>

                  <div>
                    <Label
                      htmlFor="pickupLocation"
                      className="text-foreground"
                    >
                      {
                        t.buyTicket.dateSelection
                          .preferredPickupSpot
                      }
                    </Label>

                    {/* Interactive Map */}
                    <div className="mt-4 mb-4">
                      <PickupLocationMap
                        selectedLocation={
                          formData.pickupLocation
                        }
                        onLocationSelect={(location) =>
                          handleInputChange(
                            "pickupLocation",
                            location,
                          )
                        }
                      />
                    </div>

                    <Select
                      value={formData.pickupLocation}
                      onValueChange={(value) =>
                        handleInputChange(
                          "pickupLocation",
                          value,
                        )
                      }
                    >
                      <SelectTrigger className="mt-2 border-border">
                        <SelectValue
                          placeholder={
                            t.buyTicket.dateSelection
                              .pickupPlaceholder
                          }
                        />
                      </SelectTrigger>
                      <SelectContent>
                        {PICKUP_LOCATIONS.map((location) => (
                          <SelectItem
                            key={location.value}
                            value={location.value}
                          >
                            {location.label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    <p className="mt-1 text-muted-foreground">
                      {t.buyTicket.dateSelection.pickupHelpText}
                    </p>
                  </div>

                  <div className="space-y-2">
                    <Label
                      htmlFor="quantity"
                      className="text-foreground"
                    >
                      {t.buyTicket.dateSelection.numberOfGuests}
                    </Label>
                    <div className="flex items-center gap-3">
                      <Button
                        type="button"
                        variant="outline"
                        size="sm"
                        className="h-12 w-12 border-border"
                        onClick={() =>
                          handleInputChange(
                            "quantity",
                            Math.max(1, formData.quantity - 1),
                          )
                        }
                      >
                        -
                      </Button>
                      <Input
                        id="quantity"
                        type="number"
                        min="1"
                        max="50"
                        value={formData.quantity}
                        onChange={(e) =>
                          handleInputChange(
                            "quantity",
                            Math.max(
                              1,
                              parseInt(e.target.value) || 1,
                            ),
                          )
                        }
                        className="border-border text-center"
                      />
                      <Button
                        type="button"
                        variant="outline"
                        size="sm"
                        className="h-12 w-12 border-border"
                        onClick={() =>
                          handleInputChange(
                            "quantity",
                            Math.min(50, formData.quantity + 1),
                          )
                        }
                      >
                        +
                      </Button>
                    </div>
                    {formData.quantity <= 6 ? (
                      <div className="rounded-lg border border-primary/20 bg-primary/5 p-3">
                        <div className="flex items-start gap-2 text-muted-foreground">
                          <Car className="h-4 w-4 mt-0.5 flex-shrink-0 text-primary" />
                          <p>
                            {
                              t.buyTicket.dateSelection
                                .vehicleDispatchSmall
                            }{" "}
                            {formData.quantity}
                          </p>
                        </div>
                      </div>
                    ) : (
                      <div className="rounded-lg border border-accent/20 bg-accent/5 p-3">
                        <div className="flex items-start gap-2 text-muted-foreground">
                          <AlertCircle className="h-4 w-4 mt-0.5 flex-shrink-0 text-accent" />
                          <p>
                            {
                              t.buyTicket.dateSelection
                                .vehicleDispatchLarge
                            }{" "}
                            <strong className="text-foreground">
                              {Math.ceil(formData.quantity / 6)}{" "}
                              {
                                t.buyTicket.dateSelection
                                  .vehicles
                              }
                            </strong>{" "}
                            {
                              t.buyTicket.dateSelection
                                .coordinatedToArrive
                            }
                          </p>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Guided Tour Info */}
                  {isGuidedTourTime && (
                    <div className="rounded-lg border-2 border-primary/20 bg-primary/5 p-6">
                      <div className="flex items-start gap-3">
                        <Check className="h-5 w-5 mt-0.5 flex-shrink-0 text-primary" />
                        <div className="flex-1">
                          <p className="text-foreground">
                            {
                              t.buyTicket.dateSelection
                                .guidedCommentaryIncluded
                            }
                          </p>
                          <p className="mt-1 text-muted-foreground">
                            {
                              t.buyTicket.dateSelection
                                .guidedCommentaryDescription
                            }
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Price Summary for Step 1 */}
                  <div className="rounded-lg bg-secondary/50 p-6">
                    <div className="flex justify-between items-center">
                      <div>
                        <p className="text-muted-foreground">
                          {
                            t.buyTicket.dateSelection
                              .dayPassPriceSummary
                          }
                          {isGuidedTourTime
                            ? ` ${t.buyTicket.dateSelection.dayPassWithGuided}`
                            : ""}
                        </p>
                      </div>
                      <div className="text-right">
                        <p className="text-2xl text-primary">
                          {passTotal + guidedTourTotal}
                        </p>
                        <p className="text-muted-foreground">
                          {t.buyTicket.dateSelection.forGuests}{" "}
                          {formData.quantity}{" "}
                          {formData.quantity === 1
                            ? t.buyTicket.dateSelection.guest
                            : t.buyTicket.dateSelection.guests}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-8 flex justify-end">
                  <Button
                    type="button"
                    size="lg"
                    className="bg-primary hover:bg-primary/90"
                    onClick={handleNext}
                    disabled={!canProceedStep1}
                  >
                    {t.buyTicket.dateSelection.continueButton}
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </div>
              </Card>
            )}

            {/* Step 2: Attraction Tickets */}
            {currentStep === 2 && (
              <Card className="border-border p-8">
                <div className="mb-8">
                  <div className="mb-3 flex items-center gap-3">
                    <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                      <Ticket className="h-5 w-5 text-primary" />
                    </div>
                    <h2 className="text-foreground">
                      Add Attraction Tickets?
                    </h2>
                  </div>
                  <div className="h-1 w-16 rounded-full bg-accent" />
                  {monumentTicketsEnabled ? (
                    <p className="mt-4 text-muted-foreground">
                      Skip the ticket lines! Add entrance
                      tickets to popular attractions.{" "}
                      {formData.quantity > 1
                        ? `Prices shown for ${formData.quantity} guests.`
                        : ""}
                    </p>
                  ) : (
                    <p className="mt-4 text-muted-foreground">
                      Attraction tickets are not yet available
                      for online purchase. You can buy tickets
                      at each attraction entrance.
                    </p>
                  )}
                </div>

                {monumentTicketsEnabled ? (
                  <>
                    <div className="space-y-3">
                      {attractions.map((attraction) => (
                        <div
                          key={attraction.id}
                          className={`flex items-center gap-3 rounded-lg border-2 p-5 transition-all cursor-pointer ${
                            formData.selectedAttractions.includes(
                              attraction.id,
                            )
                              ? "border-primary bg-primary/5"
                              : "border-border bg-white hover:border-primary/30"
                          }`}
                          onClick={() =>
                            toggleAttraction(attraction.id)
                          }
                        >
                          <input
                            type="checkbox"
                            id={attraction.id}
                            checked={formData.selectedAttractions.includes(
                              attraction.id,
                            )}
                            onChange={() =>
                              toggleAttraction(attraction.id)
                            }
                            className="h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary"
                          />
                          <label
                            htmlFor={attraction.id}
                            className="flex flex-1 cursor-pointer items-center justify-between"
                          >
                            <span className="text-foreground">
                              {attraction.name}
                            </span>
                            <span className="text-primary">
                              +
                              {attraction.price *
                                formData.quantity}
                              {formData.quantity > 1 && (
                                <span className="ml-1 text-muted-foreground">
                                  ({attraction.price} each)
                                </span>
                              )}
                            </span>
                          </label>
                        </div>
                      ))}
                    </div>

                    {formData.selectedAttractions.length >
                      0 && (
                      <div className="mt-6 rounded-lg bg-accent/5 p-4">
                        <p className="text-muted-foreground">
                           <strong>Tip:</strong> You'll
                          receive digital tickets via email
                          along with your{" "}
                          {formData.quantity === 1
                            ? "day pass QR code"
                            : `${formData.quantity} day pass QR codes`}
                          .
                        </p>
                      </div>
                    )}

                    {/* Price Summary for Step 2 */}
                    <div className="mt-6 rounded-lg bg-secondary/50 p-6">
                      <div className="space-y-2">
                        <div className="flex justify-between text-muted-foreground">
                          <span>
                            Day Pass
                            {isGuidedTourTime
                              ? " (includes guided commentary)"
                              : ""}
                          </span>
                          <span>
                            {passTotal + guidedTourTotal}
                          </span>
                        </div>
                        {attractionsTotal > 0 && (
                          <div className="flex justify-between text-muted-foreground">
                            <span>Attraction Tickets</span>
                            <span>{attractionsTotal}</span>
                          </div>
                        )}
                        <div className="border-t border-border pt-2 flex justify-between items-center">
                          <p className="text-foreground">
                            Total
                          </p>
                          <p className="text-2xl text-primary">
                            {totalPrice}
                          </p>
                        </div>
                      </div>
                    </div>
                  </>
                ) : (
                  <>
                    {/* Coming Soon Message */}
                    <div className="rounded-lg border bg-secondary/30 p-8 text-center">
                      <Badge
                        variant="outline"
                        className="mb-4 text-muted-foreground"
                      >
                        Online Booking Coming Soon
                      </Badge>
                      <p className="mb-6 text-muted-foreground">
                        We're working on adding the ability to
                        purchase attraction tickets online. For
                        now, tickets can be purchased at each
                        attraction entrance.
                      </p>
                      <div className="rounded-lg bg-primary/5 p-4">
                        <p className="text-sm text-muted-foreground">
                           Your Hop On Sintra day pass gets
                          you unlimited transport to all
                          attractions. Tickets are available for
                          purchase when you arrive!
                        </p>
                      </div>
                    </div>

                    {/* Price Summary for Step 2 - Day Pass Only */}
                    <div className="mt-6 rounded-lg bg-secondary/50 p-6">
                      <div className="space-y-2">
                        <div className="flex justify-between text-muted-foreground">
                          <span>
                            Day Pass
                            {isGuidedTourTime
                              ? " (includes guided commentary)"
                              : ""}
                          </span>
                          <span>
                            {passTotal + guidedTourTotal}
                          </span>
                        </div>
                        <div className="border-t border-border pt-2 flex justify-between items-center">
                          <p className="text-foreground">
                            Total
                          </p>
                          <p className="text-2xl text-primary">
                            {totalPrice}
                          </p>
                        </div>
                      </div>
                    </div>
                  </>
                )}

                <div className="mt-8 flex justify-between">
                  <Button
                    type="button"
                    variant="outline"
                    size="lg"
                    onClick={handleBack}
                  >
                    <ChevronLeft className="mr-2 h-5 w-5" />
                    Back
                  </Button>
                  <Button
                    type="button"
                    size="lg"
                    className="bg-primary hover:bg-primary/90"
                    onClick={handleNext}
                  >
                    Continue
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </div>
              </Card>
            )}

            {/* Step 3: Your Information */}
            {currentStep === 3 && (
              <Card className="border-border p-8">
                <div className="mb-8">
                  <div className="mb-3 flex items-center gap-3">
                    <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                      <User className="h-5 w-5 text-primary" />
                    </div>
                    <h2 className="text-foreground">
                      Your Information
                    </h2>
                  </div>
                  <div className="h-1 w-16 rounded-full bg-accent" />
                </div>

                <div className="space-y-6">
                  <div>
                    <Label
                      htmlFor="fullName"
                      className="text-foreground"
                    >
                      Full Name
                    </Label>
                    <div className="relative mt-2">
                      <User className="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground" />
                      <Input
                        id="fullName"
                        type="text"
                        placeholder="John Doe"
                        className="border-border pl-10"
                        required
                        value={formData.fullName}
                        onChange={(e) =>
                          handleInputChange(
                            "fullName",
                            e.target.value,
                          )
                        }
                      />
                    </div>
                  </div>

                  <div>
                    <Label
                      htmlFor="email"
                      className="text-foreground"
                    >
                      Email Address
                    </Label>
                    <div className="relative mt-2">
                      <Mail className="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground" />
                      <Input
                        id="email"
                        type="email"
                        placeholder="john@example.com"
                        className="border-border pl-10"
                        required
                        value={formData.email}
                        onChange={(e) =>
                          handleInputChange(
                            "email",
                            e.target.value,
                          )
                        }
                      />
                    </div>
                    <p className="mt-1 text-muted-foreground">
                      Your QR code will be sent here
                    </p>
                  </div>

                  <div>
                    <Label
                      htmlFor="confirmEmail"
                      className="text-foreground"
                    >
                      Confirm Email
                    </Label>
                    <div className="relative mt-2">
                      <Mail className="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground" />
                      <Input
                        id="confirmEmail"
                        type="email"
                        placeholder="john@example.com"
                        className="border-border pl-10"
                        required
                        value={formData.confirmEmail}
                        onChange={(e) =>
                          handleInputChange(
                            "confirmEmail",
                            e.target.value,
                          )
                        }
                      />
                    </div>
                    {formData.confirmEmail &&
                      formData.email !==
                        formData.confirmEmail && (
                        <p className="mt-1 text-destructive">
                          Emails don't match
                        </p>
                      )}
                  </div>
                </div>

                <div className="mt-8 flex justify-between">
                  <Button
                    type="button"
                    variant="outline"
                    size="lg"
                    onClick={handleBack}
                  >
                    <ChevronLeft className="mr-2 h-5 w-5" />
                    Back
                  </Button>
                  <Button
                    type="button"
                    size="lg"
                    className="bg-primary hover:bg-primary/90"
                    onClick={handleNext}
                    disabled={!canProceedStep3}
                  >
                    Continue
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </div>
              </Card>
            )}

            {/* Step 4: Payment */}
            {currentStep === 4 && (
              <div className="grid gap-8 lg:grid-cols-3">
                {/* Order Summary */}
                <div className="order-2 lg:order-1 lg:col-span-1">
                  <Card className="lg:sticky lg:top-4 border-border p-6">
                    <div className="mb-4">
                      <div className="mb-2 flex items-center gap-2">
                        <Receipt className="h-5 w-5 text-primary" />
                        <h3 className="text-foreground">
                          Order Summary
                        </h3>
                      </div>
                      <div className="h-1 w-16 rounded-full bg-accent" />
                    </div>

                    <div className="space-y-3 text-muted-foreground">
                      <div className="flex items-center gap-2">
                        <CalendarIcon className="h-4 w-4 text-primary flex-shrink-0" />
                        <span className="break-words">
                          {formData.date} starting at{" "}
                          {formData.timeSlot}
                        </span>
                      </div>
                      <div className="flex items-center gap-2">
                        <MapPin className="h-4 w-4 text-primary flex-shrink-0" />
                        <span className="break-words">
                          {
                            PICKUP_LOCATIONS.find(
                              (loc) =>
                                loc.value ===
                                formData.pickupLocation,
                            )?.label
                          }
                        </span>
                      </div>
                      <div className="flex items-center gap-2">
                        <Users className="h-4 w-4 text-primary flex-shrink-0" />
                        <span>
                          {formData.quantity}{" "}
                          {formData.quantity === 1
                            ? "guest"
                            : "guests"}
                        </span>
                      </div>

                      <div className="border-t border-border pt-3 mt-3 space-y-2">
                        <div className="flex justify-between gap-2">
                          <span className="flex-shrink-0">
                            Day Pass ({formData.quantity})
                            {isGuidedTourTime
                              ? " + Guided"
                              : ""}
                          </span>
                          <span className="flex-shrink-0">
                            {passTotal + guidedTourTotal}
                          </span>
                        </div>
                        {formData.selectedAttractions.length >
                          0 && (
                          <div className="flex justify-between gap-2">
                            <span className="flex-shrink-0">
                              Attraction Tickets
                            </span>
                            <span className="flex-shrink-0">
                              {attractionsTotal}
                            </span>
                          </div>
                        )}
                      </div>

                      <div className="border-t border-border pt-3 mt-3 flex justify-between items-center gap-2">
                        <span className="text-foreground flex-shrink-0">
                          Total
                        </span>
                        <span className="text-2xl text-primary flex-shrink-0">
                          {totalPrice}
                        </span>
                      </div>
                    </div>

                    <div className="mt-6 space-y-2 rounded-lg bg-primary/5 p-4">
                      <p className="text-foreground">
                         Unlimited hop-on/hop-off until 8:00 PM
                      </p>
                      <p className="text-foreground">
                         Guaranteed seating in small vehicles
                      </p>
                      <p className="text-foreground">
                         Flexible - use anytime during
                        operating hours
                      </p>
                      <p className="text-foreground">
                        {" "}
                        {formData.quantity === 1
                          ? "QR code"
                          : `${formData.quantity} QR codes`}{" "}
                        sent via email
                      </p>
                      {isGuidedTourTime && (
                        <p className="text-foreground">
                           Guided commentary included
                        </p>
                      )}
                    </div>
                  </Card>
                </div>

                {/* Payment Form */}
                <div className="order-1 lg:order-2 lg:col-span-2">
                  <Card className="border-border p-8">
                    <div className="mb-8">
                      <div className="mb-3 flex items-center gap-3">
                        <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                          <CreditCard className="h-5 w-5 text-primary" />
                        </div>
                        <h2 className="text-foreground">
                          Payment Details
                        </h2>
                      </div>
                      <div className="h-1 w-16 rounded-full bg-accent" />
                    </div>

                    {paymentInitError ? (
                      <div className="flex flex-col items-center justify-center py-12 space-y-4">
                        <AlertCircle className="h-12 w-12 text-destructive" />
                        <div className="text-center space-y-2">
                          <p className="text-foreground">
                            Payment initialization failed
                          </p>
                          <p className="text-sm text-muted-foreground">
                            {paymentInitError}
                          </p>
                        </div>
                        <div className="flex gap-3">
                          <Button
                            type="button"
                            onClick={createStripePaymentIntent}
                            size="lg"
                            className="bg-primary hover:bg-primary/90"
                          >
                            <RefreshCw className="mr-2 h-5 w-5" />
                            Retry
                          </Button>
                          <Button
                            type="button"
                            variant="outline"
                            size="lg"
                            onClick={handleBack}
                          >
                            <ChevronLeft className="mr-2 h-5 w-5" />
                            Go Back
                          </Button>
                        </div>
                      </div>
                    ) : isCreatingPayment ||
                      !paymentClientSecret ? (
                      <div className="flex flex-col items-center justify-center py-12 space-y-4">
                        <Loader2 className="h-12 w-12 animate-spin text-primary" />
                        <p className="text-muted-foreground">
                          Preparing secure payment...
                        </p>
                      </div>
                    ) : (
                      <>
                        <StripePaymentForm
                          amount={totalPrice}
                          clientSecret={paymentClientSecret}
                          onSuccess={handlePaymentSuccess}
                          onError={handlePaymentError}
                          customerEmail={formData.email}
                        />

                        <div className="mt-6">
                          <Button
                            type="button"
                            variant="outline"
                            size="lg"
                            onClick={handleBack}
                            className="w-full sm:w-auto"
                            disabled={isSubmitting}
                          >
                            <ChevronLeft className="mr-2 h-5 w-5" />
                            Back
                          </Button>
                        </div>
                      </>
                    )}
                  </Card>
                </div>
              </div>
            )}
          </div>
        </div>
      </section>
    </div>
  );
}


--- START OF FILE ClearCacheButton.tsx ---

